<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-06-20 Thu 18:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Numerical methods</title>
<meta name="author" content="Jonathan Ulmer" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  pre.src-C\+\+:before { content: 'C++'; }
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Numerical methods
<br />
<span class="subtitle">on the Cahn-Hilliard Equation</span>
</h1>
<div class="abstract" id="org4dfbd6c">
<p>
This Thesis gives a short overview and derivation for the Cahn-Hilliard Equation. It uses a discretization by the authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) as baseline, and expands upon this dicretisation with an elliptical relaxation approach. It introduces evaluation metrics regarding stability in time, space and during sub-iteration. And compares the elliptical approach against the baseline. Furthermore, it shows a qualitative success of the elliptical solver, however it also highlights challenges in numerical stability.
</p>

</div>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3f13694">1. Introduction</a></li>
<li><a href="#orgbe13701">2. The Cahn-Hilliard equation</a>
<ul>
<li><a href="#org2b7b918">2.1. Physical derivation of the CH equation eqref:eq:CH</a>
<ul>
<li><a href="#orgbfa395c">2.1.1. The free energy</a></li>
<li><a href="#org452311a">2.1.2. Derivation of the CH equation from mass balance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org195ff80">3. Baseline multi-grid solver</a>
<ul>
<li><a href="#org3f9b15a">3.1. The discretization of the CH equation:</a></li>
<li><a href="#org3e146ec">3.2. Initial data</a></li>
<li><a href="#org53a96cd">3.3. Numerical ansatz</a></li>
<li><a href="#org7f97d80">3.4. The discrete system</a></li>
<li><a href="#orgfe71da0">3.5. SMOOTH operator</a></li>
<li><a href="#orgc361796">3.6. Multigrid method</a></li>
</ul>
</li>
<li><a href="#org1e75972">4. Numerical experiments</a>
<ul>
<li><a href="#orge7f32d9">4.1. Energy evaluations</a></li>
<li><a href="#org95b6b34">4.2. Numerical mass conservation</a></li>
<li><a href="#org1faf722">4.3. Stability of a multi-grid sub-iteration</a></li>
<li><a href="#org0787c7d">4.4. Stability in time</a></li>
<li><a href="#org203557b">4.5. Stability in space</a></li>
</ul>
</li>
<li><a href="#orge52ebdf">5. Relaxed problem</a>
<ul>
<li><a href="#org4ad0eaf">5.1. Elliptical PDE</a>
<ul>
<li><a href="#org98573b9">5.1.1. Discretization</a></li>
</ul>
</li>
<li><a href="#orge552695">5.2. Relaxed system</a></li>
<li><a href="#org832ea0f">5.3. The relaxed multigrid method</a></li>
<li><a href="#orga2845c9">5.4. SMOOTH operator</a></li>
</ul>
</li>
<li><a href="#org50a6697">6. Relaxed experiments</a>
<ul>
<li><a href="#org9c9a6c0">6.1. Relaxed energy evaluations</a></li>
<li><a href="#org113d354">6.2. Relaxed numerical mass balance</a></li>
<li><a href="#org440570d">6.3. Stability of a relaxed multigrid sub-iteration</a></li>
<li><a href="#orge49d665">6.4. Relaxed stability in time</a></li>
<li><a href="#org5307e6d">6.5. Relaxed stability in space</a></li>
</ul>
</li>
<li><a href="#org5b56ad2">7. Comparison</a>
<ul>
<li><a href="#org6777778">7.1. effect of alpha</a></li>
<li><a href="#orgd5d4728">7.2. direct comparison</a></li>
<li><a href="#org77b5761">7.3. optimizer for alpha</a></li>
</ul>
</li>
<li><a href="#org1632220">8. Conclusion</a>
<ul>
<li><a href="#orgd102737">8.1. Outlook</a></li>
</ul>
</li>
<li><a href="#org48883a4">9. Appendix</a>
<ul>
<li><a href="#orga4071a4">9.1. Operator implementation</a>
<ul>
<li><a href="#orga3aac28">9.1.1. baseline</a></li>
<li><a href="#org91eec94">9.1.2. relaxed</a></li>
</ul>
</li>
<li><a href="#orgdd83bd1">9.2. rng generation</a></li>
<li><a href="#orgfc4fbe7">9.3. Monte Carlo optimizer</a></li>
<li><a href="#org94e1a87">9.4. bulk energy and mass balance</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org3f13694" class="outline-2">
<h2 id="org3f13694"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
The Cahn-Hilliard (CH) equation is a well known fourth order PDE used in multi-phase flow. It is used to couple different phases with a diffuse-interface, as compared to a sharp interface, approach. Therefore, it has a smooth transition between phases.
The CH equation serves the same purpose, as the second order Allen-Cahn equation. However, the Allen-Cahn equation is not mass conservative. Hence, the Cahn-Hilliard equation is used if mass conservation  is required.
In this thesis we implement numerical solvers for the Cahn-Hilliard equation in the Julia programming language.
We begin by giving an overview and a derivation for the analytical CH equation in Chapter <a href="#orgbe13701">2</a>. We then show mass conservation and a decrease in total energy for it.
The Chapter <a href="#org195ff80">3</a> introduces our discretization and a finite difference based two grid method. We explain the necessary functions, describe the relevant steps of our numerical implementation, and give their implementation. Additionally we introduce the initial conditions we used in this thesis.
In Chapter <a href="#org1e75972">4</a> we evaluate this method&rsquo;s stability,discrete mass conservation and discrete energy decrease that we have shown continuously for the analytical CH equation.
Our thesis introduces a analytical relaxation approach to the classical CH equation, where instead of solving a fourth order PDE <sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>, we solver a second order relaxed PDE and an additional elliptical PDE. In the chapter <a href="#orge52ebdf">5</a> we introduce this approach, and then derive a numerical solver using the method described in chapter <a href="#org195ff80">3</a>. Hereupon we derive and implement the necessary functions for the discretized relaxed equation, and  we introduce a simple solver for the elliptical PDE.
Subsequently, in chapter <a href="#org50a6697">6</a>, we evaluate our relaxed method against the baseline with the same measures, as introduced in chapter <a href="#org1e75972">4</a>.
</p>

<p>
We began writing this thesis with a reproducible research philosophy in mind. Hence, we provide the explanation you  are reading, and the implementation in the same file. The original aim was to have the mathematical formulas and their implementation interleaved in a way, that leaves no room for interpretation. While we fall short of this goal, we still provide all relevant code in the relevant sections and the appendix. All shown code is therefore the code that is run on our machine. Since not all parts of the code are relevant for understanding, unimportant sections are implemented elsewhere. Didacticly they aer replaced with a comment of form <code>&lt;&lt;unumportant-code-section&gt;&gt;</code>. Their implementation can be found in <code>Thesis_jl.org</code> in a code block of the same name.
We did experiment with additional tools such as <a href="https:orgmode.org">org-mode</a> that allow for scientific note-taking and literate programming.
This file is available on our github repository at <a href="https://github.com/ProceduralTree/CahnHilliardJulia.git">https://github.com/ProceduralTree/CahnHilliardJulia.git</a>
as <code>Thesis_jl.org</code>.
</p>
</div>
</div>
<div id="outline-container-orgbe13701" class="outline-2">
<h2 id="orgbe13701"><span class="section-number-2">2.</span> The Cahn-Hilliard equation</h2>
<div class="outline-text-2" id="text-2">
<p>
The Cahn-Hilliard(CH) equation is a partial differential equation (PDE) that governs the dynamics of a two-phase fluid (<a href="#citeproc_bib_item_2">Wu 2022</a>). The form of the CH equation used in this thesis in the domain \( \Omega \times (0, T) \,, \Omega \subset \mathbb{R}^d \,, d \in \mathbb{N}  \,, T>0 \),
</p>
\begin{equation}
\label{org636045b}
\begin{aligned}
\partial_{t}\phi(x,t) &=  \nabla \cdot(M(\phi)\nabla\mu), \\
\mu &= - \varepsilon^2 \Delta\phi  + W'(\phi),
\end{aligned}
\end{equation}
<p>
where the variables \( \phi , \mu : \Omega \times (0,T) \to \mathbb{R}^d \) are phase-field variable and chemical potential,
\(\varepsilon\) is a positive constant correlated with interface thickness, \( W(\phi) \) is a double well potential and \(M(\phi) > 0\) is a mobility coefficient (<a href="#citeproc_bib_item_2">Wu 2022</a>).
 \( \phi\) is defined in an interval \(I=[-1,1] \) and  represent the different phases.
</p>
\begin{align*}
\phi &=
\begin{cases}
1 &\,, \phi \in \text{phase 1} \\
-1 &\,, \phi \in\text{phase 2}
\end{cases}
\end{align*}

<p>
In this thesis we assume \(M(\phi) \equiv 1 \), simplifying the CH equation.
</p>

<p>
The advantages of the CH approach, as compared to traditional boundary coupling, are for example: &ldquo;explicit tracking of the interface&rdquo; (<a href="#citeproc_bib_item_2">Wu 2022</a>), as well as &ldquo;evolution of complex geometries and topological changes [&#x2026;] in a natural way&rdquo; (<a href="#citeproc_bib_item_2">Wu 2022</a>).
In practice, it enables linear interpolation between different formulas on different phases.
</p>
</div>
<div id="outline-container-org2b7b918" class="outline-3">
<h3 id="org2b7b918"><span class="section-number-3">2.1.</span> Physical derivation of the CH equation <a href="eqref:eq:CH">eqref:eq:CH</a></h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgbfa395c" class="outline-4">
<h4 id="orgbfa395c"><span class="section-number-4">2.1.1.</span> The free energy</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
The authors in (<a href="#citeproc_bib_item_2">Wu 2022</a>) define the CH equation using the <b>Ginzburg-Landau</b> free energy equation:
</p>
\begin{align}
\label{org789eaa5}
E^{\text{bulk}}[\phi] &= \int_{\Omega} \frac{\varepsilon^2}{2} |\nabla \phi |^2 + W(\phi) \, dx ,
\end{align}
<p>
where \(W(\phi) \) denotes the Helmholtz free energy density of mixing (<a href="#citeproc_bib_item_2">Wu 2022</a>) that we approximate it in further calculations with \(W(\phi) = \frac{(1-\phi ^2)^2}{4}\) as in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) shown in Fig. <a href="#orgc874a52">1</a>.
</p>

<div id="orgc874a52" class="figure">
<p><img src="images/double-well.svg" alt="double-well.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 1: </span>Double well potential \( W(\phi) \)</p>
</div>




<p>
The chemical potential, \( \mu \), then follows as the variational derivation of the free energy in Eq.<a href="eqref:eq:energy">eqref:eq:energy</a>.
</p>
\begin{align}
\label{orga689045}
 \mu &= \frac{\delta E_{bulk}(\phi)}{\delta \phi} = -\varepsilon^2 \Delta \phi + W'(\phi)
\end{align}
</div>
</div>
<div id="outline-container-org452311a" class="outline-4">
<h4 id="org452311a"><span class="section-number-4">2.1.2.</span> Derivation of the CH equation from mass balance</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
The paper (<a href="#citeproc_bib_item_2">Wu 2022</a>) states that the observable phase separation is driven by a diffusion resulting from the gradient in chemical potential \( \mu \). The emergent conservative dynamics motivate the following diffusion equation
</p>
\begin{equation}
\label{org21b126c}
    \partial_t \phi + \nabla \cdot \mathbf{J} = 0,
\end{equation}
<p>
where \( \mathbf{J} = -\nabla \mu \) represents mass-flux.
We follow the authors (<a href="#citeproc_bib_item_2">Wu 2022</a>) in deriving the CH equation by combining Eq.<a href="eqref:eq:chemical-potential">eqref:eq:chemical-potential</a> and Eq.<a href="eqref:eq:massbal">eqref:eq:massbal</a>.
</p>
\begin{equation}
\begin{aligned}
\implies \partial_t \phi   &=- \nabla \cdot \mathbf{J} = \Delta\mu , \\
\mu &=  -\varepsilon^2 \Delta \phi + W'(\phi) \,,
\end{aligned}
\end{equation}
<p>
Furthermore the CH equation is mass conservative under homogeneous Neumann boundary conditions, defined as:
</p>
\begin{equation}
\label{org160fb89}
\begin{aligned}
\mathbf{J} \cdot \mathbf{n} &= 0 & \text{on} \, \partial\Omega &\times (0,T),\\
\partial_n\phi &= 0 & \text{on} \, \partial\Omega &\times (0,T),
\end{aligned}
\end{equation}
<p>
where \( \mathbf{n}  \) is the outward normal on \( \partial \Omega \).
To show the conservation of mass we analyze the change in total mass in the domain \( \Omega \) over time.
</p>
\begin{equation}
\label{orge70e1c8}
\begin{aligned}
\frac{d}{dt}\int_{\Omega}\phi \ d \mathbf{x} &=\int_{\Omega}\frac{\partial \phi}{\partial t} \ d\mathbf{x} \\
&= - \int_{\Omega} \nabla \cdot \mathbf{J} \ d\mathbf{x}\\
&=  \int_{\partial\Omega}  \mathbf{J} \cdot \mathbf{n}  \ d\mathbf{s} \\
&= 0 & \forall t\in(0,T)\,,
\end{aligned}
\end{equation}

<p>
In order to show thermodynamic consistency of the CH equation, we take the time derivation of the free energy functional Eq.<a href="eqref:eq:energy">eqref:eq:energy</a>.
</p>
\begin{align*}
\frac{d}{dt}E^{bulk}[\phi(t)] &= \int_{\Omega} ( \varepsilon^2 \nabla \phi \cdot \nabla \partial_t \phi + W'(\phi) \partial_t \phi) \ d \mathbf{x} \\
&=\int_{\Omega} (\varepsilon^2\nabla\phi + W'(\phi))\partial_t\phi \ d\mathbf{x}\\
&=\int_{\Omega} \mu \partial_t \phi \ d\mathbf{x}\\
&= \int_{\Omega} \mu \cdot \Delta\mu \ d\mathbf{x} \\
&= -\int_{\Omega} \nabla\mu \cdot \nabla\mu \ dx + \int_{\partial\Omega} \mu \nabla\phi_t \cdot \mathbf{n} \ dS \\
&\stackrel{\partial_n\phi = 0}{=} - \int_{ \Omega } |\nabla \mu|^2 \ d \mathbf{x}, & \forall t \in (0,T)
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-org195ff80" class="outline-2">
<h2 id="org195ff80"><span class="section-number-2">3.</span> Baseline multi-grid solver</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org3f9b15a" class="outline-3">
<h3 id="org3f9b15a"><span class="section-number-3">3.1.</span> The discretization of the CH equation:</h3>
<div class="outline-text-3" id="text-3-1">
<p>
As baseline for numerical experiments we use a two-grid method based on the finite difference method defined in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
Our discretization follows the one taken by the authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
We discretize our domain \( \Omega \) to be a Cartesian-grid \( \Omega_d \) on a square with side-length \( N\cdot h \), where N is the number of grid-points in one direction, and \( h \) is the distance between grid-points. In all our initial data \( h \) is \( 3\cdot10^{-3}\) and \( N=64 \). However, for stability tests we change \( h \) and \( N \).
</p>
\begin{equation}
\Omega_d = \left\{ i,j \mid i,j \in \mathbb{N} \,, i,j \in [2,N+1] \right\}
\end{equation}
<p>
where \( \Omega_{d} \) is the discrete version or our domain as shown in <a href="#org90ca9cb">2</a>.
</p>

<div id="org90ca9cb" class="figure">
<p><img src="images/domain.svg" alt="domain.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 2: </span>Discrete Domain used for most of the experiments in this Thesis</p>
</div>


<p>
We discretize the phase-field ,\( \phi \), and chemical potential ,\( \mu \), into grid-wise functions \(\phi_{ij}, \mu_{ij} \)
</p>
\begin{equation}
\begin{aligned}
\phi_{ij}^n: \Omega_d \times \left\{ 0, \dots  \right\} &\to \mathbb{R}\\
\mu_{ij}^n: \Omega_d \times \left\{ 0, \dots \right\} &\to \mathbb{R}
\end{aligned}
\end{equation}
<p>
Here \( n \) denotes the nth time-step, and \( (i,j) \) are Cartesian indices on the discrete domain \( \Omega_d \).
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) then use the characteristic function \( G \) of the  domain \( \Omega \) to enforce no-flux boundary conditions <a href="eqref:eq:boundary-conditions">eqref:eq:boundary-conditions</a>.
</p>

\begin{align*}
G(x,y) &=
\begin{cases}
1, & (x,y) \in  \Omega \\
0, & (x,y) \not\in  \Omega
\end{cases}
\end{align*}
<p>
We implement the discrete version of \( G \) on \( \Omega_d \) as follows:
</p>
\begin{align*}
G_{ij} &=
\begin{cases}
1, & i,j \in [2,N+1]  \\
0, & \text{else}
\end{cases}
\end{align*}
<p>
The definition of \( G_{ij} \) with \( i,j \in [2,N+1] \) enables us to evaluate \( G_{ij} \) of-grid.
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">if</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">i</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">len</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">1</span> <span style="color: #fabd2f;">&amp;&amp;</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">width</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">1</span>
        <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">1.0</span>
    <span style="color: #fb4934;">else</span>
        <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">0.0</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
We then define the discrete derivatives \( D_x\phi_{ij}, \ D_y\phi_{ij} \) using centered differences:
</p>
\begin{align}
D_x\phi^{n+1,m}_{i+\frac{1}{2} j} &= \frac{\phi^{n+1,m}_{i+1j} - \phi^{n+1,m}_{ij}}{h} & D_y\phi^{n+1,m}_{ij+\frac{1}{2}} &= \frac{\phi^{n+1,m}_{ij+1} - \phi^{n+1,m}_{ij}}{h}
\end{align}
<p>
We define \( D_x\mu_{ij}^{n+\frac{1}{2},m} , D_y\mu_{ij}^{n+\frac{1}{2},m} \) in the same way.
Next we define the discrete gradient \( \nabla_d \phi^{n+1,m}_{ij}\), as well as a modified Laplacian \( \nabla_d \cdot (G_{ij} \nabla_d \phi^{n+1,m}_{ij} )\):
</p>



\begin{equation}
\label{org8e3fb8d}
\begin{aligned}
\nabla_d \phi^{n+1,m}_{ij} &= \left(D_x \phi^{n+1,m}_{i+1j} , \ D_y \phi^{n+1,m}_{ij+1}\right) \,,\\
 \nabla_d \cdot (G_{ij} \nabla_d \phi^{n+1,m}_{ij}) &= \frac{G_{i+\frac{1}{2}j}D_x \phi^{n+1,m}_{i+\frac{1}{2}j} -  G_{i-\frac{1}{2}}D_x \phi^{n+1,m}_{i-\frac{1}{2}j} + D_y \phi^{n+1,m}_{ij+\frac{1}{2}} - D_y \phi^{n+1,m}_{ij-\frac{1}{2}}}{h} \\
  &= \frac{ G_{i+\frac{1}{2}j} \phi^{n + 1,m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n +,m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n +,m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n +,m}_{ij-1}    }{h^2}\\
& \, - \frac{\left(   G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \cdot \phi_{ij} \right)}{h^2} \,,
\end{aligned}
\end{equation}
<p>
The discretization for \(  \nabla_d\mu_{ij}^{n+\frac{1}{2},m} ,  \nabla_d \cdot (G_{ij} \nabla_d \mu^{n+\frac{1}{2},m}_{ij}) \) are done the same as for \( \phi_{ij}^{n+1} \)
 We define \(   \nabla_d \cdot (G_{ij} \nabla_d \phi_{ij} )\) instead of a discrete Laplacian \( \Delta_d \) to ensure a discrete version of boundary conditions <a href="eqref:eq:boundary-conditions">eqref:eq:boundary-conditions</a>.
 The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) show this to be the case by expanding \( \nabla_d \cdot (G_{ij} \nabla_d\phi_{ij}) \).
Notably, when one point lies outside the domain, e.g. \( G_{i + \frac{1}{2}} = 0 \)  then the corresponding discrete gradient \( \frac{\phi_{i+1}^{n+1} - \phi_i}{h}  \) is weighted by 0. This corresponds the discrete version of \( \partial_n\phi = 0 \).
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)
</p>

<p>
To simplify the notation for discretized derivatives we use the following abbreviations:
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \phi_{ij} = G_{i+\frac{1}{2}j} \phi^{n + 1,m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n +1,m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n +1,m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n +1,m}_{ij-1}  \)</li>
<li>\(  \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \)</li>
</ul>
<p>
Code:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">(</span>
        <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">)</span>

<span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">function</span> <span style="color: #83a598;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">(</span>
        <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
We can then write the modified Laplacian \( \nabla_d (G \nabla_d\phi_{ij}^{n+1}) \) as:
</p>
\begin{align*}
\nabla_{d} \cdot(G \nabla_d\phi_{ij}^{n+1}) &= \frac{\Sigma_G\phi_{ij}^{n+1} - \Sigma_{Gij}\cdot \phi_{ij}^{n+1}}{h^2}
\end{align*}
<p>
We use this modified Laplacian to deal with boundary conditions. Our abbreviations simplify separating implicit and explicit terms in the discretization.
</p>
</div>
</div>
<div id="outline-container-org3e146ec" class="outline-3">
<h3 id="org3e146ec"><span class="section-number-3">3.2.</span> Initial data</h3>
<div class="outline-text-3" id="text-3-2">
<p>
For testing we use initial phase-fields defined by the following equations:
</p>

\begin{equation}
\begin{aligned}
\phi_{ij} &=
\begin{cases}
1 &\,, \|(i,j) - (\frac{N}{2} , \frac{N}{2})\|_p < \frac{N}{3}\\
-1 &\,,else
\end{cases}
&
\text{where    }  p \in \{2,\infty\}
\\
\phi_{ij} &=
\begin{cases}
1 &\,,  i < \frac{N}{2} \\
-1 &\,,else
\end{cases}
\\
\phi_{ij} &=
\begin{cases}
1 &\,, \|(i,j) - (\frac{N}{2} , 2)\|_2 < \frac{N}{3} \\
-1 &\,,else
\end{cases}
\\
\phi_{ij} &=
\begin{cases}
1 &\,, \| (i,j) - q_k \|_p < \frac{N}{5}  \\
-1 &\,,else
\end{cases}
& p \in \{1,2, \infty\} , q_k \in Q
\end{aligned}
\end{equation}
<p>
where \( q_k \) are random points inside my domain. Those we generate those using the following RNG setup in Julia
</p>



<div id="org36f5fc0" class="figure">
<p><img src="images/testdata.svg" alt="testdata.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 3: </span>Examples of different phase-fields used as the initial condition in this work.</p>
</div>
</div>
</div>
<div id="outline-container-org53a96cd" class="outline-3">
<h3 id="org53a96cd"><span class="section-number-3">3.3.</span> Numerical ansatz</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) then define the discrete CH equation adapted for the domain as:
</p>
\begin{equation}
\label{orgc771f38}
\begin{aligned}
\frac{\phi_{ij}^{n+1} - \phi_{ij}^n}{\Delta t}  &=  \nabla _d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2}} )  \,, \\
 \mu_{ij}^{n+\frac{1}{2}} &= 2\phi_{ij}^{n+1} - \varepsilon^2  \nabla_d \cdot  (G_{ij} \nabla _d \phi_{ij}^{n+1} ) + W'(\phi_{ij}^n) - 2\phi _{ij}^n \,,
\end{aligned}
\end{equation}
<p>
and derive a numerical scheme from this implicit equation.
</p>
</div>
</div>
<div id="outline-container-org7f97d80" class="outline-3">
<h3 id="org7f97d80"><span class="section-number-3">3.4.</span> The discrete system</h3>
<div class="outline-text-3" id="text-3-4">
<p>
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) derive their method by separating <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> into implicit and linear terms, and explicit non-linear terms. We write the implicit terms in form of a function \( L: \RR^2 \to \RR^2  \) and the explicit terms in \( (\zeta^n_{ij} , \psi^n_{ij})^T \).
</p>
\begin{align*}
L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi^{n+1}_{ij}}{\Delta t} - \nabla _d \cdot  ( G_{ij} \nabla _d \mu^{n+\frac{1}{2}}_{ij} ) \\
\varepsilon^2 \nabla _d \cdot  (G \nabla_d \phi_{ij}^{n+1}) - 2\phi_{ij}^{n+1} + \mu_{ij}^{n+\frac{1}{2}}
\end{pmatrix}
\end{align*}
<p>
This operator follows from <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> by separating implicit and explicit terms \( L \) and   \( (\zeta^n_{ij} , \psi^n_{ij})^T \), respectively.
</p>
\begin{align*}
\begin{pmatrix}
\zeta^n_{ij}
 \\
\psi^n_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi_{ij}^{n}}{\Delta t}\\
W'(\phi_{ij}^n) - 2\phi_{ij}^n
\end{pmatrix}
\end{align*}
<p>
Due to being explicit, we know everything needed to calculate \( (\zeta^n_{ij} , \psi^n_{ij})^T \) at the beginning of each time step. We compute those values once and store them in the solver.
</p>

<p>
Furthermore, as it is needed later on, we derive its Jacobian with respect to the current grid point \( (\phi^{n+1}_{ij} , \mu^{n+\frac{1}{2}}_{ij})^{T} \):
</p>

\begin{align*}
DL\begin{pmatrix}
\phi_{ij} \\
\mu_{ij}
\end{pmatrix} &= \begin{pmatrix}
\frac{1}{\Delta t} & \frac{1}{h^2}\Sigma_{Gij}  \\
-\frac{\varepsilon^2}{h^2}\Sigma_{Gij} - 2 & 1
\end{pmatrix}
\end{align*}
<p>
Implementation details can be found in the Appendix under  <a href="#orga3aac28">baseline</a>.
</p>
</div>
</div>
<div id="outline-container-orgfe71da0" class="outline-3">
<h3 id="orgfe71da0"><span class="section-number-3">3.5.</span> SMOOTH operator</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)derived Gauss-Seidel Smoothing from:
</p>
\begin{align}
\label{org40b5888}
L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\zeta^n_{ij} \\
\psi^n_{ij}
\end{pmatrix}
.
\end{align}
<p>
SMOOTH consists of point-wise Gauss-Seidel relaxation, by solving Eq.<a href="eqref:eq:smooth">eqref:eq:smooth</a> for all \( i,j \) with the initial guess for \( \zeta^n_{ij} , \psi^n_{ij} \). Since \( L \) is linear we can write Eq.<a href="eqref:eq:smooth">eqref:eq:smooth</a> as
</p>
 \begin{equation}
\label{org9af5aa9}
\begin{aligned}
\begin{pmatrix}
  \zeta_{ij}^n\\
\psi_{ij}^n
\end{pmatrix}
&=
DL\begin{pmatrix}
\phi_{ij}^{n+1} \\
\mu_{ij}^{n+\frac{1}{2}}
\end{pmatrix}
\cdot
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
+
\begin{pmatrix}
 - \frac{1}{h^2} \Sigma_{Gij}\mu_{ij}^{n+\frac{1}{2}} \\
+ \frac{\varepsilon^2}{h^2} \Sigma_{Gij}\phi_{ij}^{n+1} \\
\end{pmatrix}
,\\
\begin{pmatrix}
  \zeta_{ij}^n\\
\psi_{ij}^n
\end{pmatrix}
-
\begin{pmatrix}
 - \frac{1}{h^2} \Sigma_{Gij}\mu_{ij}^{n+\frac{1}{2}} \\
+ \frac{\varepsilon^2}{h^2} \Sigma_{Gij}\phi_{ij}^{n+1} \\
\end{pmatrix}
&=
DL\begin{pmatrix}
\phi_{ij}^{n+1} \\
\mu_{ij}^{n+\frac{1}{2}}
\end{pmatrix}
\cdot
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
\,,
\end{aligned}
\end{equation}
<p>
where
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \phi_{ij}^{n+1} = G_{i+\frac{1}{2}j} \phi^{n + 1,m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n + 1,m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n + 1,m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n + 1,m}_{ij-1}  \),</li>
<li>\(  \Sigma_G \mu_{ij} = G_{i+\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i+1j} +  G_{i-\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i-1j} + G_{ij+\frac{1}{2}}  \mu^{n + \frac{1}{2},m}_{ij+1} + G_{ij-\frac{1}{2}} \mu^{n + \frac{1}{2},m}_{ij-1}  \),</li>
</ul>
<p>
In order to compute \( \left(   \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij}  \right) \) we have to evaluate those grid-wise functions on at neighboring indices \( k,l \) e.g. \( k=i+1 , l=j-1 \).
Since values for \( \phi_{kl}^{n+1,m} , \mu_{kl}^{n+\frac{1}{2},m} \) are unknown, if \( k > i , l > j \), the authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) and we use initial approximations, and the values of the current smooth iteration else. As initial approximation we use the values of \(  \phi_{kl}^{n+1,m} , \mu_{kl}^{n+\frac{1}{2},m}  \) from the last smoothing iteration.
The equation Eq.<a href="eqref:eq:explicit-smooth">eqref:eq:explicit-smooth</a> is of form \(b = Ax\)
We then and solve Eq.<a href="eqref:eq:explicit-smooth">eqref:eq:explicit-smooth</a> for \( \left( \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij}  \right)  \).
</p>
<div class="org-src-container">
<pre class="src src-julia" id="orgae8148c"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">iterations</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">adaptive</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">gradient_boundary_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">iterations</span>
        <span style="color: #928374;"># old_phase = copy(solver.phase)</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>

            <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">calculate</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">left</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">hand</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">side</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">b</span><span style="color: #fabd2f;">&gt;&gt;</span>

            <span style="color: #83a598;">res</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">\</span> <span style="color: #83a598;">b</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
We denote the approximations for \( \left( \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij}  \right)  \) after smoothing, as  \( \left( \bar{\phi}_{ij}^{n+1} , \bar{\mu}^{n+\frac{1}{2}}_{ij}  \right)  \)
In Fig.<a href="#orge0881a9">4</a> we show 4 of the 7 initial data after one 200 iterations of smoothing. It is apparent that the sharp interface from the initial Data has diffused.
</p>

<div id="orge0881a9" class="figure">
<p><img src="images/smooth.svg" alt="smooth.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 4: </span>Inputs from <a href="#org3e146ec">3.2</a> after SMOOTH.</p>
</div>
</div>
</div>
<div id="outline-container-orgc361796" class="outline-3">
<h3 id="orgc361796"><span class="section-number-3">3.6.</span> Multigrid method</h3>
<div class="outline-text-3" id="text-3-6">
<p>
The numerical method proposed in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) consists of a V-cycle multi-grid method derived from previously stated operators. Specifically we use a two-grid implementation consisting of.
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">timesteps</span>

    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>

    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">subiterations</span>

        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
where the V-cycle is a
</p>
<ol class="org-ol">
<li>A Gauss-Seidel relaxation for smoothing, as described in Chapter <a href="#orga2845c9">5.4</a>.</li>
<li>calculate the residual error  \( \left(d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m} \right) = L\left( \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij}  \right) - (\zeta^n_{ij} , \psi^n_{ij}  )  \).</li>
<li>restriction and between grids \(  h \to H  \).</li>
<li>a Newton iteration to solve \( L(\hat{\phi}_{ij,H}^{n+1,m}, \hat{\mu}_{ij,H}^{n+\frac{1}{2},m})_H = L(\bar{\phi}_{ij,H}^{n+1,m} , \bar{\mu}_{ij,H}^{n+\frac{1}{2},m}) + (d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m}) \).</li>
</ol>
<p>
We solve for \( \left( \hat{\phi}_{ij,H}^{n+1,m}, \hat{\mu}_{ij,H}^{n+\frac{1}{2},m} \right) \) using the same iteration as in Chapter <a href="#orga2845c9">5.4</a> however we replace \( (\zeta_{ij}^{n} , \psi_{ij}^n) \) with  \(  L(\bar{\phi}_{ij,H}^{n+1,m} , \bar{\mu}_{ij,H}^{n+\frac{1}{2},m}) + (d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m}) \).  In the iteration, where \( \bar{\phi}_{ij,H}^{n+1,m} , \bar{\mu}_{ij,H}^{n+\frac{1}{2},m} \) are the values after the smooth restricted to the coarser grid and \( d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m} \) is the residual from the smooth  iteration on the fine grid restricted onto the coarse grid.
</p>
<ol class="org-ol">
<li>prolongation from \( H\to h \)</li>
<li>post smoothing</li>
</ol>

<p>
The V-cycle of a two-grid method using pre- and post-smoothing is then stated by:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Array</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">}</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">solver</span>
    <span style="color: #83a598;">solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #928374;">#pre SMOOTHing:</span>
    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">400</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">d</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598;">r</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #928374;"># calculate error between L and expected values</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">d</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">restrict</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">to</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">coarse</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">grid</span><span style="color: #fabd2f;">&gt;&gt;</span>

    <span style="color: #928374;">#Newton Iteration for solving smallgrid</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">300</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>

            <span style="color: #83a598;">diffrence</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
                        <span style="color: #fb4934;">.-</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span>
                        <span style="color: #fb4934;">.-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>

            <span style="color: #83a598;">local</span> <span style="color: #83a598;">ret</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">\</span> <span style="color: #83a598;">diffrence</span>

            <span style="color: #83a598;">u_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">ret</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">v_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">ret</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fb4934;">end</span>
        <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-=</span> <span style="color: #83a598;">u_large</span>
        <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">-=</span> <span style="color: #83a598;">v_large</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">prolong</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">to</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">fine</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">grid</span><span style="color: #fabd2f;">&gt;&gt;</span>

    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">800</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>


<p>
After a few iterations, V-cycle exhibits the following behavior:
</p>

<div class="org-src-container">
<pre class="src src-julia-vterm" id="org54049f2"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">init</span><span style="color: #fabd2f;">&gt;&gt;</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">DataFrames</span>
<span style="color: #83a598;">results</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">jldopen</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"experiments/iteration.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #b8bb26;">"result"</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">anim</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">animate</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">res</span> in <span style="color: #83a598; font-weight: bold;">eachrow</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"phase field"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">legend</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">aspectratio</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">equal</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">showaxis</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">false</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">grid</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">false</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">size</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">400</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">400</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">gif</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">anim</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/iteration.gif"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">fps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>


<div id="org7bc8ab0" class="figure">
<p><img src="images/iteration.gif" alt="iteration.gif" />
</p>
<p><span class="figure-number">Figure 5: </span>A few time steps of the solver for different initial conditions as shown in <a href="#org3e146ec">3.2</a></p>
</div>
</div>
</div>
</div>
<div id="outline-container-org1e75972" class="outline-2">
<h2 id="org1e75972"><span class="section-number-2">4.</span> Numerical experiments</h2>
<div class="outline-text-2" id="text-4">
<p>
In the previous Chapter we discretized the CH equation based on the multigrid method described by the authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) and we obtained a numerical scheme for \( \phi , \mu \). In this chapter we analyse the change in mass, change in total energy \( E^{bulk} \), stability in time , space and during sub-iterations.
</p>
</div>
<div id="outline-container-orge7f32d9" class="outline-3">
<h3 id="orge7f32d9"><span class="section-number-3">4.1.</span> Energy evaluations</h3>
<div class="outline-text-3" id="text-4-1">
<p>
As discrete energy measure we use:
</p>
\begin{equation}
\label{org099c04a}
\begin{aligned}
E^{\text{bulk}}_d(\phi_{ij}) &= \sum_{i,j \in \Omega} \frac{\varepsilon^2}{2} |G\nabla_d \phi_{ij} |^2 + W\left(\phi_{ij}\right)  \\
&= \sum_{i,j \in \Omega} \frac{\varepsilon^2}{2} G_{i+\frac{1}{2}j}(D_x\phi_{i+\frac{1}{2}j}) ^2 + G_{ij+\frac{1}{2}}(D_y\phi_{ij+\frac{1}{2}})^2  + W\left(\phi_{ij}\right)  .\\
\end{aligned}
\end{equation}
<p>
Since the continous total energy Eq.<a href="eqref:eq:energy">eqref:eq:energy</a> decreases over time, we expect it&rsquo;s discrete couterpart to exhibit the same behaviour. Them numerical implementation for the bulk energy can be found in the Appendix <a href="#org94e1a87">9.4</a>.
In Fig.<a href="#orga28fbbd">6</a> we observe the discrete total energy going down with increasing number of time-steps, as we expect from a  CH based solver. Visually we observe the energy decrease as reduced surface curvature.
</p>

<div id="orga28fbbd" class="figure">
<p><img src="images/energy_balance.svg" alt="energy_balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 6: </span>Behaviour of energy \( E_{bulk} \) over time for one initial condition \( \phi_0 \).</p>
</div>
</div>
</div>
<div id="outline-container-org95b6b34" class="outline-3">
<h3 id="org95b6b34"><span class="section-number-3">4.2.</span> Numerical mass conservation</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The analytical CH equation in Eq.<a href="eqref:eq:CH">eqref:eq:CH</a>  is mass conservative as shown in Eq.<a href="eqref:eq:mass-conservation">eqref:eq:mass-conservation</a>.
Instead of a physical mass we use the average of \(\phi\) over the domain \(\Omega\).
This yields a balance between both phases.  Since our implementation uses no-flow boundary conditions the balance between <i>phase 1</i> and <i>phase 2</i> stays the same. We therefore calculate a balanace
</p>
\begin{align*}
b &= \frac{\sum_{i,j \in \Omega} \phi_{ij}}{N^2}
\end{align*}
<p>
such that \( b = 1 \) means there is only phase 1, \( \phi \equiv 1 \), and \( b = -1 \) means there is only phase 2, \( \phi \equiv -1 \).
Ideally this value stays constant over time for numerical mass conservation.
In practice we observe slight fluctuations in Figure <a href="#orgc2bcfd4">7</a>. Those however are close to machine precision and can therefore be ignored. The numerical impolementation is  in appendix <a href="#org94e1a87">9.4</a>.
</p>


<div id="orgc2bcfd4" class="figure">
<p><img src="images/mass_balance.svg" alt="mass_balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 7: </span>Behaviour of phase change over time for one initial condition \( \phi_0 \).</p>
</div>
</div>
</div>
<div id="outline-container-org1faf722" class="outline-3">
<h3 id="org1faf722"><span class="section-number-3">4.3.</span> Stability of a multi-grid sub-iteration</h3>
<div class="outline-text-3" id="text-4-3">
<p>
We expect our solver to stay stable when increasing the number of multigrid sub-iterations. To validate this assumption we compare the phase-field of the current sub-iteration \( \phi^{n+1,m}_{ij} \) with the phse-field of the previous sub-iteration \( \phi_{ij}^{n+1,m-1} \).
</p>
\begin{equation}
\| \phi^{n+1,m-1} - \phi^{n+1,m} \|_{Fr}= \sqrt{ \sum_{i,j \in \Omega_d} \left|   \phi^{n+1,m-1}_{ij} - \phi^{n+1,m}_{ij} \right|^2 }
\end{equation}
<p>
As sub-iterations increase , \( m\to\infty \),  we expect the difference between both phase-fields to go to zero \( \|\phi^{n+1,m} - \phi^{n+1,m-1}\|_{Fr} \to 0 \). We observe this behaviour in Figure <a href="#org5ab6ed5">8</a>
</p>

<div id="org5ab6ed5" class="figure">
<p><img src="images/convergence.svg" alt="convergence.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 8: </span>Stability of the original CH solver for increasing sub-iterations</p>
</div>

<p>
in practise we observe the behaviour we expect, where an increasing number of sub-iterations leads to decreasing change compared to the previous sub-iteration.
</p>
</div>
</div>
<div id="outline-container-org0787c7d" class="outline-3">
<h3 id="org0787c7d"><span class="section-number-3">4.4.</span> Stability in time</h3>
<div class="outline-text-3" id="text-4-4">
<p>
We expect our numerical error to decrease when calculating with smaller time steps. To test this, we  successively subdivide the original time interval \( [0,T] \) in finer parts. We fix \( \Delta t \cdot n = T \) for \( T=10^{-2} \) and test different values of \( n \). In Figure <a href="#org43fd888">9</a> we compare the phase-field \( \phi^{n}_{ij} \) and \( \phi^{n-1}_{ij}  \) at \( T=10^{-2} \). and observe the decrease we expect.
</p>

<div id="org43fd888" class="figure">
<p><img src="images/time-stability.svg" alt="time-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 9: </span>Behavior of the baseline solver while solving the time interval \( T = \left[ 0 , 10^{-2} \right] \) with increasing number of time-steps.</p>
</div>
</div>
</div>
<div id="outline-container-org203557b" class="outline-3">
<h3 id="org203557b"><span class="section-number-3">4.5.</span> Stability in space</h3>
<div class="outline-text-3" id="text-4-5">
<p>
We expect our methods to be stable under different grid-sizes \( h \) and grid-points \( N \). Therefore we expect the difference after one time-step between eg. a \( 512 \times 512 \) grid and a \( 1024 \times 1024 \) grid to be smaller than the difference between a \( 64 \times 64 \) grid and a \( 128 \times 128 \) grid. In order to keep the problem the same , we fix \( Nh = 10^{-3} \cdot 1024 \) and test for \( N \in \left\{ 1024 , 512 , 256 , 128 , 64 , 32 \right\} \)
</p>

<div id="orgba5d370" class="figure">
<p><img src="images/space-stability.svg" alt="space-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 10: </span>Behavior of the baseline solver while solving on successively finer grids</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orge52ebdf" class="outline-2">
<h2 id="orge52ebdf"><span class="section-number-2">5.</span> Relaxed problem</h2>
<div class="outline-text-2" id="text-5">
<p>
In effort to decrease the order of complexity, from fourth order derivative to second order, we propose an elliptical relaxation approach, where the relaxation variable \( c \) is the solution of the following elliptical PDE:
</p>
\begin{align}
\label{orgc931ad2}
- \Delta c^\alpha  + \alpha c^a &= \alpha \phi ^\alpha,
\end{align}
<p>
where \( \alpha \) is a relaxation parameter. We expect to approach the original solution of the CH equation Eq.<a href="eqref:eq:CH">eqref:eq:CH</a> as  \( \alpha \to \infty \).
This results in the following relaxation for the classical CH equation Eq.<a href="eqref:eq:CH">eqref:eq:CH</a>:
</p>
\begin{equation}
\label{org947f030}
\begin{aligned}
\partial_t \phi^\alpha  &= \Delta \mu \,,\\
\mu &= \varepsilon ^2 \alpha(c^\alpha - \phi^\alpha) + W'(\phi) .
\end{aligned}
\end{equation}
<p>
It requires solving the elliptical PDE each time-step to calculate \(c\).
</p>

<p>
As ansatz for the numerical solver we propose:
</p>
\begin{equation}
\label{orgca8d8d1}
\begin{aligned}
\frac{\phi_{ij}^{n+1,\alpha} - \phi_{ij}^{n,\alpha}}{\Delta t}  &=  \nabla _d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2},\alpha} )  \,,\\
 \mu_{ij}^{n+\frac{1}{2},\alpha} &= 2\phi_{ij}^{n+1,\alpha} - \varepsilon^2 a(c_{ij}^{n+1,\alpha} - \phi_{ij}^{n+1,\alpha})  + W'(\phi_{ij}^{n,\alpha}) - 2\phi _{ij}^{n,\alpha} \,.
\end{aligned}
\end{equation}
<p>
This approach is inspired by Eq.<a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> and adapted to the relaxed CH equation in Eq.<a href="eqref:eq:discrete-relaxed-cahn-hilliard">eqref:eq:discrete-relaxed-cahn-hilliard</a>.
We then apply the multi-grid method proposed in <a href="#org195ff80">3</a> to the relaxed problem by replacing the differential operators with their discrete counterparts, as defined in Eq.<a href="eqref:eq:discretization">eqref:eq:discretization</a>,
and expand them.
</p>
</div>
<div id="outline-container-org4ad0eaf" class="outline-3">
<h3 id="org4ad0eaf"><span class="section-number-3">5.1.</span> Elliptical PDE</h3>
<div class="outline-text-3" id="text-5-1">
<p>
In order to solve the relaxed CH equation we solve the following PDE in each  time step:
</p>
\begin{align*}
- \nabla \cdot  (G \nabla c^\alpha) + \alpha c^\alpha  = \alpha \phi ^\alpha \,.
\end{align*}
<p>
Similarly to the first solver we solve this PDE  with a finite difference scheme using the same discretization as before.
</p>
</div>
<div id="outline-container-org98573b9" class="outline-4">
<h4 id="org98573b9"><span class="section-number-4">5.1.1.</span> Discretization</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
The discretization of the PDE expands the differential operators in the same way and proposes an equivalent scheme for solving the elliptical equation Eq.<a href="eqref:eq:elliptical-equation">eqref:eq:elliptical-equation</a>.
</p>
\begin{align*}
- \nabla_d \cdot  (G_{ij} \nabla_d c_{ij}^\alpha) + \alpha  c_{ij}^\alpha &= \alpha \phi_{ij}^\alpha
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
- (\frac{1}{h}(G_{i+\frac{1}{2}j} \nabla c^\alpha_{i+\frac{1}{2}j} + G_{ij+\frac{1}{2}} \nabla c^\alpha_{ij+\frac{1}{2}}) &  \\
- (G_{i-\frac{1}{2}j} \nabla c^\alpha_{i-\frac{1}{2}j} + G_{ij-\frac{1}{2}} \nabla c^\alpha_{ij-\frac{1}{2}})) + \alpha  c_{ij}^\alpha   &= \alpha  \phi_{ij}^\alpha
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
- \frac{1}{h^2} ( G_{i+\frac{1}{2}j}(c_{i+1j}^\alpha - c_{ij}^\alpha) & \\
+G_{ij+\frac{1}{2}}(c_{ij+1}^\alpha - c_{ij}^\alpha) & \\
+G_{i-\frac{1}{2}j}(c_{i-1j}^\alpha - c_{ij}^\alpha)& \\
+G_{ij-\frac{1}{2}}(c_{ij-1}^\alpha - c_{ij}^\alpha)) + \alpha  c_{ij}^\alpha &=\alpha  \phi_{ij}^\alpha
\end{align*}


<p>
As before we abbreviate \(  \Sigma_G c^\alpha_{ij} = G_{i+\frac{1}{2}j} c^\alpha_{i+1j} +  G_{i-\frac{1}{2}j} c^\alpha_{i-1j} + G_{ij+\frac{1}{2}}  c^\alpha_{ij+1} + G_{ij-\frac{1}{2}} c^\alpha_{ij-1}  \) and \(  \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \). Then the discrete elliptical PDE can be stated as:
</p>
\begin{align}
\label{org74d26af}
-\frac{ \Sigma_G c^\alpha_{ij}}{h^2} + \frac{\Sigma_G}{h^2} c^\alpha_{ij} + \alpha c^\alpha_{ij} &= \alpha\phi^\alpha_{ij} \,.
\end{align}
<p>
Solving Eq.<a href="eqref:eq:discrete_elyps">eqref:eq:discrete_elyps</a> for \(c_{ij}^\alpha \) then results in.
</p>
\begin{align*}
\left( \frac{\Sigma_{Gij}}{h^2} + \alpha \right)c_{ij}^{\alpha} = \alpha\phi^{\alpha}_{ij} + \frac{\Sigma_G c_{ij}^{\alpha}}{h^2}\\
c_{ij}^{\alpha} = \frac{\alpha\phi^{\alpha}_{ij} + \frac{\Sigma_G c_{ij}^{\alpha}}{h^2}}{\frac{\Sigma_{G}}{h^2} + \alpha}\\
c_{ij}^{\alpha} = \frac{\alpha h^2 \phi^{\alpha}_{ij}}{\Sigma_{Gij} + \alpha h^2} + \frac{\Sigma_G c_{ij}^{\alpha}}{\Sigma_{Gij} + \alpha h^{2}}
\end{align*}
<p>
and can be translated to code as follows
</p>
<div class="org-src-container">
<pre class="src src-julia" id="org023cc20"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">n</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span>  <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">n</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
            <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #83a598;">bordernumber</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span>
                    <span style="color: #ebdbb2; background-color: #282828;">(</span>
                        <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">+</span>
                        <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
                    <span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">bordernumber</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

            <span style="color: #fb4934;">end</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orge552695" class="outline-3">
<h3 id="orge552695"><span class="section-number-3">5.2.</span> Relaxed system</h3>
<div class="outline-text-3" id="text-5-2">
<p>
We reformulate the discretization in Eq.<a href="eqref:eq:discrete-relaxed-cahn-hilliard">eqref:eq:discrete-relaxed-cahn-hilliard</a> in terms of the relaxed function \(L\) as follows:
</p>
\begin{align*}
L_r
\begin{pmatrix}
\phi ^{n+1,\alpha}_{ij} \\
\mu^{n+\frac{1}{2},\alpha}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi^{n+1,m,\alpha}_{ij}}{\Delta t} - \nabla _d \cdot (G_{ji} \nabla _d \mu^{n + \frac{1}{2},m,\alpha}_{ji}) \\
\varepsilon ^2 \alpha (c^\alpha_{ij} - \phi^{n+1,m,\alpha}_{ij}) - 2\phi ^{n+1,m,\alpha}_{ij} -\mu^{n + \frac{1}{2},m,\alpha}_{ji}
\end{pmatrix}
\end{align*}

<p>
and its Jacobian:
</p>
\begin{align*}
DL_r\begin{pmatrix}
\phi^{n+1,\alpha, m}_{ij} \\
\mu^{n+\frac{1}{2},m,\alpha}_{ij}
\end{pmatrix} &= \begin{pmatrix}
\frac{1}{\Delta t} & \frac{1}{h^2}\Sigma_{G}  \\
- \varepsilon^2 \alpha  - 2 & 1
\end{pmatrix}
\end{align*}
</div>
</div>
<div id="outline-container-org832ea0f" class="outline-3">
<h3 id="org832ea0f"><span class="section-number-3">5.3.</span> The relaxed multigrid method</h3>
<div class="outline-text-3" id="text-5-3">
<p>
As the difference between both methods is abstracted away in the operators, the relaxed V-cycle the replaces the original operators with their relaxed counterparts. Due to julias multiple dispatch features this changes nothing in the implementation Therefore we reuse the original V-cycle in the <a href="#orgc361796">3.6</a>.
In the executions for each time step, we add the elliptic solver in the subiteration.
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">timesteps</span>

    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>

    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">subiterations</span>

        <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

[[file:images/relaxed-anim.gif]]
</div>
</div>
<div id="outline-container-orga2845c9" class="outline-3">
<h3 id="orga2845c9"><span class="section-number-3">5.4.</span> SMOOTH operator</h3>
<div class="outline-text-3" id="text-5-4">
<p>
The relaxed solver uses the same approach as the original solver, where we solve \( L_r(\phi^{n+1,m,\alpha}_{ij}, \mu^{n+\frac{1}{2},m,\alpha}_{ij}) = (\zeta_{ij}^n , \psi_{ij}^n)^T \) for each grid-point \( \phi_{ij}^{n+1,m,\alpha} \). Notably \((\zeta_{ij}^n , \psi_{ij}^n)^T  \) is the same as in the original part. As in the original smoothing, evalations of \( \mu^{n+\frac{1}{2},m,\alpha}_{kl} \) for \( k,l > i,j \) are replaced with their values from the previous SMOOTH iteration.
</p>

<p>
Correspondingly the SMOOTH operation expands to:
</p>
\begin{equation}
\label{org1b9f5f0}
\begin{aligned}
  -\frac{\Sigma_{Gij}}{h^2}\overline{\mu^{n + \frac{1}{2},m,\alpha}_{ji}} &= \frac{\phi ^{n+1,m,\alpha}_{ij}}{\Delta t} - \zeta^{n,\alpha}_{ij} - \frac{\Sigma_G\mu_{ij}}{h^2} \,,\\
 \varepsilon ^2 \alpha \overline{\phi ^{n+1,m,\alpha}_{ij}} + 2 \phi ^{n+1,m,\alpha}_{ij} &= \varepsilon ^2 \alpha c^{n,\alpha}_{ij}  -\overline{\mu^{n + \frac{1}{2},m,\alpha}_{ji}}  - \psi_{ij}^{n,\alpha} \,,
\end{aligned}
\end{equation}
<p>
where
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \mu_{ij} = G_{i+\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i+1j} +  G_{i-\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i-1j} + G_{ij+\frac{1}{2}}  \mu^{n + \frac{1}{2},m}_{ij+1} + G_{ij-\frac{1}{2}} \mu^{n + \frac{1}{2},m}_{ij-1}  \),</li>
</ul>
<p>
We then solve directly for the smoothed variables, \( \overline{\mu_{ij}^{n+1,m,\alpha}} \) and \( \overline{\phi_{ij}^{n+1,m,\alpha}} \). This was not done in the original paper (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) because the required system of linear equations in the paper (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)  was solved numerically.
</p>
\begin{align*}
\varepsilon^2 \alpha(\phi_{ij}^{n+1,m,\alpha}) + 2\phi_{ij}^{n+1,m,\alpha} &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G} (\frac{\phi_{ij}^{n+1,m,\alpha}}{\Delta t} - \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij}) - \psi_{ij}
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
\varepsilon^2\alpha (\phi_{ij}^{n+1,m,\alpha}) + 2\phi_{ij}^{n+1,m,\alpha} + \frac{h^2}{\Sigma_{Gij}}\frac{\phi_{ij}^{n+1,m,\alpha}}{\Delta t} &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G} (- \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij}) - \psi_{ij}
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
(\varepsilon^2 \alpha + 2 + \frac{h^2}{\Sigma_G \Delta t}) \phi_{ij}^{n+1,m,\alpha} &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G}(- \zeta^n_{ij} - \frac{\Sigma_G \mu_{ij}}{h^2} ) -\psi_{ij}
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
 \phi_{ij}^{n+1,m,\alpha} &= \left(\varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G}(- \zeta^n_{ij} - \frac{\Sigma_G \mu_{ij}}{h^2} ) -\psi_{ij}\right)\left(\varepsilon^2 \alpha + 2 + \frac{h^2}{\Sigma_G \Delta t}\right)^{-1}
\end{align*}
<div class="org-src-container">
<pre class="src src-julia" id="org29ea354"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">iterations</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">adaptive</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">iterations</span>
        <span style="color: #928374;"># old_phase = copy(solver.phase)</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
            <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">solve</span><span style="color: #fabd2f;">-</span>for<span style="color: #fabd2f;">-</span><span style="color: #83a598;">phi</span><span style="color: #fabd2f;">&gt;&gt;</span>
            <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">update</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">potential</span><span style="color: #fabd2f;">&gt;&gt;</span>
        <span style="color: #fb4934;">end</span>

        <span style="color: #928374;">#if adaptive &amp;&amp; LinearAlgebra.norm(old_phase - solver.phase) &lt; 1e-10</span>
            <span style="color: #928374;">##println("SMOOTH terminated at $(k) succesfully")</span>
            <span style="color: #928374;">#break</span>
        <span style="color: #928374;">#end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>


<div id="org6fc4985" class="figure">
<p><img src="images/smooth_relaxed.svg" alt="smooth_relaxed.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 11: </span>Effect of the relaxed SMOOTH operator, and additional solving of the elliptical problem, for different values of alpha</p>
</div>

<p>
Furthermore, experimentation shows that alpha alone is insufficient to get a relaxed method consistent with the original solver, since alpha had an effect similar to epsilon, where it changed the boundary thickness in the phase-field \( \phi \). Therefore epsilon and alpha cannot be chosen independently. Hence we use a simple MCMC optimizer for \( \alpha,\varepsilon \) in order to give the relaxed solver the best chance we can. The implementation thereof is given in Appendix <a href="#orgfc4fbe7">9.3</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-org50a6697" class="outline-2">
<h2 id="org50a6697"><span class="section-number-2">6.</span> Relaxed experiments</h2>
<div class="outline-text-2" id="text-6">
<p>
We expect the relaxed solver to behave the same as the baseline method for all test cases that we have introduced in Chapter <a href="#org1e75972">4</a>. Therefore we run the same experiments for our relaxed solver.
</p>
</div>
<div id="outline-container-org9c9a6c0" class="outline-3">
<h3 id="org9c9a6c0"><span class="section-number-3">6.1.</span> Relaxed energy evaluations</h3>
<div class="outline-text-3" id="text-6-1">
<p>
we do evaluate our relaxed method using the discrete Helmoltz energy defined in Eq.<a href="eqref:eq:discrete-energy">eqref:eq:discrete-energy</a>. On the same initial data, and with the same values for \( \varepsilon , h , dt \) as in the Chapter.<a href="#orge7f32d9">4.1</a>. In Figure.<a href="#org1d5c713">12</a> we then observe the energy decay we expected. Our relaxed approach closely follows the baseline, although it consistently decayed slightly faster. This is within our expectations.
</p>

<div id="org1d5c713" class="figure">
<p><img src="images/relaxed-energy-balance.svg" alt="relaxed-energy-balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 12: </span>Energy decay of the relaxed solver compared to the original solver.</p>
</div>


<p>
We observe the discrete Helmoltz energy decrease is the same manner as with the original solver.
</p>
</div>
</div>
<div id="outline-container-org113d354" class="outline-3">
<h3 id="org113d354"><span class="section-number-3">6.2.</span> Relaxed numerical mass balance</h3>
<div class="outline-text-3" id="text-6-2">
<p>
since both the CH equation Eq.<a href="eqref:eq:CH">eqref:eq:CH</a> and the baseline solver from Fig.<a href="#orgc2bcfd4">7</a> are mass conservative, the relaxed solver should be as well, to be competitive with the baseline approach. Our relaxed solver shows  mass loss around 2% as seen in Fig.<a href="#org16ca78e">13</a>. This is nowhere near the machine precision, we reached in Fig.<a href="#orgc2bcfd4">7</a>. However it is still tolerable.
</p>

<div id="org16ca78e" class="figure">
<p><img src="images/relaxed-mass-balance.svg" alt="relaxed-mass-balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 13: </span>Mass los in the relaxed solver</p>
</div>
</div>
</div>
<div id="outline-container-org440570d" class="outline-3">
<h3 id="org440570d"><span class="section-number-3">6.3.</span> Stability of a relaxed multigrid sub-iteration</h3>
<div class="outline-text-3" id="text-6-3">
<p>
We also compare the subiteration behaviour of the relaxed solver to the original we therefore plot \( \|\phi_{ij}^{n+1,m} - \phi_{ij}^{n+2,m-1} \|_{Fr} \) against \( \| \phi_{ij}^{n+1,m,\alpha} - \phi_{ij}^{n+1,m-1,\alpha} \| \) for \( m \in \{2, \dots , 64\} \). Here we observe instablility at about 60 sub-iterations in Fig.<a href="#orgb28f82b">No description for this link</a>. We are uncertain, as to why.
</p>

<div id="orgb28f82b" class="figure">
<p><img src="images/relaxed-convergence.svg" alt="relaxed-convergence.svg" class="org-svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-orge49d665" class="outline-3">
<h3 id="orge49d665"><span class="section-number-3">6.4.</span> Relaxed stability in time</h3>
<div class="outline-text-3" id="text-6-4">
<p>
we test the behaviour under refinement in time by succesivly subdividing the original time interval \( [0,T] \) in finer parts. We use the same meassure as in Chaper.<a href="#org0787c7d">4.4</a> and directly compare. We observe simmilar behaviour to the original solver in Fig.<a href="#orge11d662">14</a>. The relaxed solver has consisten lower difference than the original solver. This might suggest a more consistent method over time. However since the sub-iteration showed problematic behaviour, this micht also be a side-effect of this.
</p>

<div id="orge11d662" class="figure">
<p><img src="images/relaxed-time-stability.svg" alt="relaxed-time-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 14: </span>Behavior of the relaxed and baseline solvers while solving the time interval \( t \in \left[ 0 , 10^{-2} \right] \) with increasing number of time-steps.</p>
</div>
</div>
</div>
<div id="outline-container-org5307e6d" class="outline-3">
<h3 id="org5307e6d"><span class="section-number-3">6.5.</span> Relaxed stability in space</h3>
<div class="outline-text-3" id="text-6-5">
<p>
we test convergence in space by succesivly subdividing our grid into finer meshes
</p>



<div id="org7b031d4" class="figure">
<p><img src="images/relaxed-space-stability.svg" alt="relaxed-space-stability.svg" class="org-svg" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org5b56ad2" class="outline-2">
<h2 id="org5b56ad2"><span class="section-number-2">7.</span> Comparison</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org6777778" class="outline-3">
<h3 id="org6777778"><span class="section-number-3">7.1.</span> effect of alpha</h3>
<div class="outline-text-3" id="text-7-1">
<p>
In the previous chapter we have shown stability compared to the original solver. However we have not yet show a direct comparison between both methods. Since the relaxed solver is dependant on the relaxation variable \( \alpha \) We are interested in finding an optimal value for it.
Furthemore to see the effect \( \alpha \) has on our solver, we evaluate both solvers after one time-step , and then calculate the difference between \( \phi_{ij}^{n+1} \) and \( \phi_{ij}^{n+1,\alpha} \), for various values of \( \alpha \).
Should the relaxed solver approach the original, we would expect
</p>
\begin{equation}
||\phi_{ij}^{n+1} - \phi_{ij}^{n+1,\alpha}||_{Fr} \to 0
\end{equation}
<p>
In Fig.<a href="#orgbc65269">15</a> we observe the following behaviour where in all cases the difference to the original solver is apparent. Furthermore we observe a optimal value of \( \alpha \) at approximately \( 7.5 * 10^5 \) we explain this with our observations done for the Smoothing operator, where for small and large values of \( \alpha \) the relaxed approach ironically results in restricted behaviour. Empirical this is to be expected as. for large values of alpha the elliptical equation approaches \( \phi \)  and for small values the elliptical solver from chapter <a href="#org4ad0eaf">5.1</a> does not converge. 
</p>

<div id="orgbc65269" class="figure">
<p><img src="images/alpha-error.svg" alt="alpha-error.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 15: </span>Difference between the original solver \( \phi^1_{ij} \) and the relaxed solver \( \phi^{1,\alpha}_{ij} \)</p>
</div>
</div>
</div>
<div id="outline-container-orgd5d4728" class="outline-3">
<h3 id="orgd5d4728"><span class="section-number-3">7.2.</span> direct comparison</h3>
<div class="outline-text-3" id="text-7-2">
[[file:images/relaxed-comp.gif]]

<p>
although we can observe slight differences between the original solver and the relaxed approach they are barely noticeable by eye. Therefore we run our solver for a fixed value of \( \alpha=7700 \) , as this was one of the best values from Fig.<a href="#orgbc65269">15</a>, We then  show the numerical difference between \( \phi_{ij}^n \) and \( \phi_{ij}^{n,\alpha} \) in Fig.<a href="#org09a5529">16</a>. We observe a a small difference between both methods, especially in areas with high curvature and inclusions of small segments of one phase in the other.
</p>
[[file:images/relaxed-comparison.gif]]



<div id="org09a5529" class="figure">
<p><img src="images/relaxed-comparison.svg" alt="relaxed-comparison.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 16: </span>Comparison between the original and the relaxed CH solvers.</p>
</div>
</div>
</div>
<div id="outline-container-org77b5761" class="outline-3">
<h3 id="org77b5761"><span class="section-number-3">7.3.</span> optimizer for alpha</h3>
<div class="outline-text-3" id="text-7-3">
<p>
In addition to the experiments in Fig.<a href="#orgbc65269">15</a> we have experimented with a Monte Carlo Optimizer to optimize \( \alpha \) in conjunction with \( \varepsilon \), to best approximate the baseline solver after one time-step. This resulted in a optimal \( \varepsilon \) found that was very close to the actual \( \varepsilon \) used. (9e-3 compared to 8e-3). This gives us confidence that the relaxed method solves the same problem, as the baseline. Optimal values for \( \alpha \) varied , however stayed fairly large around \( 10^5 \to 10^{6} \).
</p>
</div>
</div>
</div>
<div id="outline-container-org1632220" class="outline-2">
<h2 id="org1632220"><span class="section-number-2">8.</span> Conclusion</h2>
<div class="outline-text-2" id="text-8">
<p>
In this thesis we have presented a simple introduction to the CH equation and have shown two numerical solvers for it.
We have presented a baseline method implemented from the authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>), and have Shown how to derive it from their initial approach.
We have done the derivations in a way, that enables a simple adaptation to a modified version of the discrete CH equation Eq.<a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a>, as introduced in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
We have introduced measures to evaluate both solvers in space , time and mass conservation as well as their sub-iteration behaviour.
We have shown the baseline to be mass conservative, in a numerical sense, and we have shown it to be stable in all tested measures.
We have shown our relaxed solver to approach the baseline, however we have also highlighted instability with subiterations, and mass-loss.
We intentionally didn&rsquo;t evaluate runtime since numerical experiments have shown both solvers to be dependant on the amount of sub-iterations, hyperparameters such as \( \varepsilon \) as well as the number off smoothing iterations.
It would therefore be unfair to evaluate one solver on a set of parameters tweaked for the other.
As example for this dilemma we recall runs where the relaxed solver was around 10x faster than the baseline with the same parameters.
The baseline solver was able to run with 10x less smoothing iterations than the relaxed one.
A fair comparison would hence require to find the optimal number of smoothing for each solver.
</p>


<p>
For the sake of completeness we include runtime benchmarks Of both methods. Those should be taken with a pinch of salt because of the reasons above. Both examples are run with the same parameters and  the results are in the Appendix.
</p>
</div>
<div id="outline-container-orgd102737" class="outline-3">
<h3 id="orgd102737"><span class="section-number-3">8.1.</span> Outlook</h3>
<div class="outline-text-3" id="text-8-1">
<p>
This thesis leaves a lot of room for further research. We have already mentioned runtime evaluations, which require more optimizations, and additional experiments to test the number of smoothing iterations. Here it would be beneficial if both solvers are made adaptive, to ensure fair evaluations.
Furthermore, we initially considered a machine learning approach to replace the elliptical system. We didn&rsquo;t follow this idea mostly due to time constraints, as we had already collected trainings data during our numerical experiments. Our choice of programming language would have been of benefit here, as it would enable more advanced technices, such as integrating the numerical solver in the trainings loop since julia offers automatic diccerentiation of arbitrary functions, and therefore enables back-propagation (gradient descent) through the entire solver. Interessting would alo have been different discretizations of the relaxed CH equation, and different method for solving it, such as a finite volume or finite element method. Those bring the chalange of beeing harder to compare to our baseline.
</p>
</div>
</div>
</div>
<div id="outline-container-org48883a4" class="outline-2">
<h2 id="org48883a4"><span class="section-number-2">9.</span> Appendix</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orga4071a4" class="outline-3">
<h3 id="orga4071a4"><span class="section-number-3">9.1.</span> Operator implementation</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #83a598; font-weight: bold;">xi_init</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">x</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span>
    <span style="color: #83a598; font-weight: bold;">psi_init</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598; font-weight: bold;">W_prime</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">x</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">xi_init</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">psi_init</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">return</span> <span style="color: #83a598;">nothing</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
<div id="outline-container-orga3aac28" class="outline-4">
<h4 id="orga3aac28"><span class="section-number-4">9.1.1.</span> baseline</h4>
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">phi</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">mu</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">xi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span>
         <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
          <span style="color: #fabd2f;">-</span>
          <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">mu</span> <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #83a598;">psi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span>
          <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
           <span style="color: #fabd2f;">-</span>
           <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">phi</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">phi</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">mu</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">*</span><span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">;</span>
             <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org91eec94" class="outline-4">
<h4 id="org91eec94"><span class="section-number-4">9.1.2.</span> relaxed</h4>
<div class="outline-text-4" id="text-9-1-2">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">phi</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">mu</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">xi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span>
         <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
          <span style="color: #fabd2f;">-</span>
          <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">mu</span> <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #83a598;">psi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #fabd2f;">*</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">phi</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">*</span><span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">;</span>
             <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span>  <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdd83bd1" class="outline-3">
<h3 id="orgdd83bd1"><span class="section-number-3">9.2.</span> rng generation</h3>
<div class="outline-text-3" id="text-9-2">
<p>
for random point generation we use the folowing Function and seed.
</p>
<div class="org-src-container">
<pre class="src src-julia-vterm"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Random</span>
<span style="color: #83a598;">rng</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">MersenneTwister</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">42</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">gridsize</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">64</span>
<span style="color: #83a598;">radius</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">gridsize</span> <span style="color: #fabd2f;">/</span><span style="color: #d3869b;">5</span>
<span style="color: #83a598;">blobs</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">gridsize</span> &#247; <span style="color: #d3869b;">5</span>
<span style="color: #83a598;">rngpoints</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">rng</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">gridsize</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">blobs</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Executing&#x2026; dfbbbf0c</td>
</tr>
</tbody>
</table>


<p>
the random testdata is then generated as follows
</p>
</div>
</div>
<div id="outline-container-orgfc4fbe7" class="outline-3">
<h3 id="orgfc4fbe7"><span class="section-number-3">9.3.</span> Monte Carlo optimizer</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Distributions</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">DataFrames</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/solvers.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/adapted_solvers.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/utils.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/multisolver.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/multi_relaxed.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/testgrids.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/elypssolver.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">Plots</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">LaTeXStrings</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">LinearAlgebra</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">Printf</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">ProgressBars</span>
<span style="color: #83a598; font-weight: bold;">default</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">fontfamily</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"computer modern"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">titlefontsize</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">32</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">guidefontsize</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">22</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">tickfontsize</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">22</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">legendfontsize</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">22</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">pgfplotsx</span><span style="color: #ebdbb2; background-color: #282828;">()</span>
<span style="color: #83a598;">layout2x2</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">grid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">layout3x1</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">layout</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #83a598;">b</span>  <span style="color: #83a598;">c</span> <span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">a</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">size3x1</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1600</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1600</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">SIZE</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">64</span>
<span style="color: #83a598;">M</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testdata</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">SIZE</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">SIZE</span> &#247; <span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">SIZE</span> <span style="color: #fabd2f;">/</span><span style="color: #d3869b;">5</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>


<span style="color: #fb4934;">function</span> <span style="color: #83a598;">test_values</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha_distribution</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon_distribution</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">alpha</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha_distribution</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">eps</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">max</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">epsilon_distribution</span><span style="color: #ebdbb2; background-color: #282828;">)</span>  <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1e-10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">relaxed_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testgrid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">eps</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #928374;">#SMOOTH!(relaxed_solver[1], 100, false)</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">64</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
    <span style="color: #83a598;">error</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">original_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #fb4934;">*</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #ebdbb2; background-color: #282828;">;</span><span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">alpha</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">eps</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">error</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">error</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>

<span style="color: #83a598;">original_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testgrid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">64</span>
<span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #928374;">#SMOOTH!(original_solver[1], 100, false);</span>
<span style="color: #83a598;">eps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">3e-3</span>
<span style="color: #928374;">#M = testdata(64, div(64,3), 64/5 , 2)</span>
<span style="color: #83a598;">alpha0</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10000</span>
<span style="color: #83a598;">epsilon0</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1e-2</span>
<span style="color: #83a598;">best_alpha</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">alpha0</span> <span style="color: #fabd2f;">/</span> <span style="color: #d3869b;">10</span>
<span style="color: #83a598;">best_epsilon</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">epsilon0</span> <span style="color: #fabd2f;">/</span> <span style="color: #d3869b;">10</span>
<span style="color: #83a598;">best_error</span>  <span style="color: #fb4934;">=</span> <span style="color: #83a598;">Inf</span>
<span style="color: #83a598;">results</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">DataFrame</span><span style="color: #ebdbb2; background-color: #282828;">()</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">n</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">1000</span>
    <span style="color: #83a598;">searchradius</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span>
    <span style="color: #83a598;">alpha_distribution</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">Normal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">best_alpha</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">searchradius</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">alpha0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">epsilon_distribution</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">Normal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">best_epsilon</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">searchradius</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">epsilon0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">result</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">test_values</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha_distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon_distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">if</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">error</span> <span style="color: #fabd2f;">&lt;</span> <span style="color: #83a598;">best_error</span>
        <span style="color: #83a598;">global</span> <span style="color: #83a598;">best_error</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">error</span>
        <span style="color: #83a598;">global</span> <span style="color: #83a598;">best_alpha</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span>
        <span style="color: #83a598;">global</span> <span style="color: #83a598;">best_epsilon</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span>
        <span style="color: #83a598; font-weight: bold;">println</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">push!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">jldsave</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"experiments/alpha-epsilon.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">result</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">println</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"Best alpha: $best_alpha , Best epsilon: $best_epsilon"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org94e1a87" class="outline-3">
<h3 id="org94e1a87"><span class="section-number-3">9.4.</span> bulk energy and mass balance</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">bulk_energy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #83a598;">energy</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">0</span>
    <span style="color: #83a598;">dx</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndex</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">dy</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndex</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">W</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #d3869b;">4</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">x</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
        <span style="color: #83a598;">energy</span> <span style="color: #fabd2f;">+=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">/</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">dx</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">dy</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">W</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
        <span style="color: #fb4934;">end</span>
   <span style="color: #fb4934;">return</span> <span style="color: #83a598;">energy</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">massbal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">num_cells</span><span style="color: #fb4934;">=</span> <span style="color: #fb4934;">*</span><span style="color: #ebdbb2; background-color: #282828;">((</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">)</span>.<span style="color: #fabd2f;">-</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #83a598; font-weight: bold;">sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">num_cells</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
</div>
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Shin, Jaemin, Darae Jeong, and Junseok Kim. 2011. A Conservative Numerical Method for the CahnHilliard Equation in Complex Domains. <i>Journal of Computational Physics</i> 230 (19): 744155. <a href="https://doi.org/https://doi.org/10.1016/j.jcp.2011.06.009">https://doi.org/https://doi.org/10.1016/j.jcp.2011.06.009</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Wu, Hao. 2022. A Review on the Cahnhilliard Equation: Classical Results and Recent Advances in Dynamic Boundary Conditions. <i>Electronic Research Archive</i> 30 (8): 27882832. <a href="https://doi.org/10.3934/era.2022143">https://doi.org/10.3934/era.2022143</a>.</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
This solver uses a two dimensional version with 2 second order terms instead of the full fourth order  equation.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Jonathan Ulmer</p>
<p class="date">Created: 2024-06-20 Thu 18:39</p>
</div>
</body>
</html>
