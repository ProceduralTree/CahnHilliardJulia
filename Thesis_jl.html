<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-08-16 Fri 13:07 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A Multi-grid method</title>
<meta name="author" content="Jonathan Ulmer" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  pre.src-C\+\+:before { content: 'C++'; }
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">A Multi-grid method
<br />
<span class="subtitle">on the Cahn-Hilliard equation  and its relaxed variation.</span>
</h1>
<div class="abstract" id="org8a566bc">
<p>
This Thesis gives a short overview and derivation for the Cahn-Hilliard Equation. It uses a discretization by the authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) as baseline, and expands upon this dicretisation with an elliptical relaxation approach. It introduces evaluation metrics regarding stability in time, space and during sub-iteration. And compares the elliptical approach against the baseline. Furthermore, it shows a qualitative success of the elliptical solver, however it also highlights challenges in numerical stability.
</p>

</div>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org799c12c">1. Introduction</a></li>
<li><a href="#orgfdd729c">2. The Cahn-Hilliard equation</a>
<ul>
<li><a href="#org2e6a11f">2.1. Physical derivation of the CH equation eqref:eq:CH</a>
<ul>
<li><a href="#orgc42522b">2.1.1. The free energy</a></li>
<li><a href="#org77e6867">2.1.2. Derivation of the CH equation from mass balance</a></li>
</ul>
</li>
<li><a href="#orgb2b6bc3">2.2. initial value problem</a></li>
</ul>
</li>
<li><a href="#org1db22d3">3. Discretization of the CH equation</a>
<ul>
<li><a href="#org5317ffb">3.1. The discretization of functions and derivative operators</a></li>
<li><a href="#org38420e4">3.2. Initial data</a></li>
<li><a href="#orgb9542a1">3.3. Discretization into a linear system</a></li>
</ul>
</li>
<li><a href="#orgb738c04">4. Numerical solver</a>
<ul>
<li><a href="#org952aca7">4.1. Gauss-Seidel  smoothing</a></li>
<li><a href="#orgfc468b0">4.2. Two-grid method</a>
<ul>
<li><a href="#org14525d6">4.2.1. Pre Smoothing</a></li>
<li><a href="#org188f5ed">4.2.2. Restriction</a></li>
<li><a href="#org7f1cd56">4.2.3. Course grid solution</a></li>
<li><a href="#orgde4db96">4.2.4. Prolongation</a></li>
<li><a href="#org7c6e32c">4.2.5. Post Smoothing</a></li>
<li><a href="#org1da4a9f">4.2.6. additional considerations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org13c5b27">5. Numerical experiments</a>
<ul>
<li><a href="#org6c3c4d9">5.1. Energy evaluations</a></li>
<li><a href="#orgbcaee81">5.2. Numerical mass conservation</a></li>
<li><a href="#orgb81b0c3">5.3. Stability of a two-grid sub-iteration</a></li>
<li><a href="#org71ff987">5.4. Stability in time</a></li>
</ul>
</li>
<li><a href="#org00d912d">6. Relaxed Cahn-Hilliard equation</a>
<ul>
<li><a href="#org8fe4682">6.1. Relaxed initial value problem</a></li>
<li><a href="#org5a4988c">6.2. Relaxed energy functional</a></li>
<li><a href="#org4b8832a">6.3. Relaxed mass conservation</a></li>
</ul>
</li>
<li><a href="#orgcf7126c">7. Discretization of the relaxed problem</a>
<ul>
<li><a href="#orgb275d32">7.1. Elliptical PDE</a></li>
<li><a href="#org5962109">7.2. Gauss Seidel solver for the elliptical system</a></li>
<li><a href="#org603d9d9">7.3. Relaxed system</a></li>
<li><a href="#org392054a">7.4. Relaxed Gauss-Seidel iteration</a></li>
<li><a href="#orgab9d306">7.5. The relaxed two-grid method</a></li>
</ul>
</li>
<li><a href="#org5c7f2ab">8. Discrete mass conservation</a></li>
<li><a href="#org01022bb">9. Numerical experiments for the relaxed system</a>
<ul>
<li><a href="#org2d9ee89">9.1. explicit and implicit solution of the elliptical problem</a></li>
<li><a href="#org19bac6d">9.2. optimizer for alpha</a></li>
<li><a href="#orgdf485be">9.3. effect of \( \alpha  \) on the Gauss-Seidel iteration</a></li>
<li><a href="#orgceaae5b">9.4. Direct comparison of the baseline solver with the relaxed solver</a></li>
<li><a href="#orgb6e48c6">9.5. Relaxed energy evaluations</a></li>
<li><a href="#org3e732ab">9.6. Stability of a relaxed multigrid sub-iteration</a></li>
<li><a href="#org444954e">9.7. Relaxed numerical mass balance</a></li>
<li><a href="#orgfb9b397">9.8. Relaxed stability in time</a></li>
<li><a href="#orgb1f1e86">9.9. additional considerations</a></li>
</ul>
</li>
<li><a href="#org9e25bd2">10. Conclusion</a>
<ul>
<li><a href="#orgc926d98">10.1. Outlook</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org799c12c" class="outline-2">
<h2 id="org799c12c"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
The Cahn-Hilliard (CH) equation is a well known fourth order partial differential equation (PDE) used in multi-phase flow. It is used to couple different phases with a diffuse-interface. It does this using a continuous transition between two phases.
The CH equation, beeing fourth order, is difficult to solve numerically. Howewer it is still used since it is able to guarantee conservation of mass.
In this thesis we implement numerical solvers for the Cahn-Hilliard equation in the Julia programming language.
We begin by giving an overview and a derivation for the analytical CH equation in Chapter <a href="#orgfdd729c">2</a>. We then show mass conservation and a decrease of total energy in time.
The Chapter <a href="#org1db22d3">3</a> introduces our finite difference discretization. We explain the necessary functions, and give their implementation. Additionally we introduce the initial conditions we used in this thesis.
 Chapter <a href="#orgb738c04">4</a> describes the relevant steps of our numerical implementation in the two-grid method we used.
In Chapter <a href="#org13c5b27">5</a> we evaluate this method&rsquo;s stability,discrete mass conservation and discrete energy decrease that we have shown continuously for the analytical CH equation.
Our thesis introduces a elliptical relaxation approach to the classical CH equation, where instead of solving a fourth order PDE <sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>, we solver a second order relaxed PDE and an additional elliptical PDE. In the chapter <a href="#org00d912d">6</a> we introduce this approach, and then derive a numerical solver using the method described in chapter <a href="#orgfc468b0">4.2</a>. Hereupon we derive and implement the necessary functions for the discretized relaxed equation, and  we introduce a simple solver for the elliptical PDE.
Subsequently, in chapter <a href="#org01022bb">9</a>, we evaluate our relaxed method against the baseline with the same measures, as introduced in chapter <a href="#org13c5b27">5</a>.
</p>

<p>
We began writing this thesis with a reproducible research philosophy in mind. Hence, we provide the explanation and the implementation in the same file. The original aim was to have the mathematical formulas and their implementation interleaved. While we fall short of this goal, we still provide all relevant code in the relevant sections and the appendix. All shown code is therefore the code that is run on our machine. Since not all parts of the code are relevant for understanding, unimportant sections are implemented elsewhere. Didactically they are replaced with a comment of form <code>&lt;&lt;unimportant-code-section&gt;&gt;</code>. Their implementation can be found in <code>Thesis_jl.org</code> in a code block of the same name.
We did experiment with additional tools such as <a href="https:orgmode.org">org-mode</a> that allow for scientific note-taking and literate programming.
This file is available on our github repository at <a href="https://github.com/ProceduralTree/CahnHilliardJulia.git">https://github.com/ProceduralTree/CahnHilliardJulia.git</a>
as <code>Thesis_jl.org</code>. The code to our numerical experiments we provide in the appendix as well as under <code>experiments/src/</code> in the repository. We provide the code for the plots next to them in <code>Thesis_jl.org</code>. The code for the numerical solvers themselves is in both the PDF and the ORG Document, and gets exported into the <code>src/</code> directory of the github repository.
</p>
</div>
</div>
<div id="outline-container-orgfdd729c" class="outline-2">
<h2 id="orgfdd729c"><span class="section-number-2">2.</span> The Cahn-Hilliard equation</h2>
<div class="outline-text-2" id="text-2">
<p>
The Cahn-Hilliard (CH) equation is a partial differential equation (PDE) that governs the dynamics of a two-phase fluid (<a href="#citeproc_bib_item_2">Wu 2022</a>). The form of the CH equation used in this thesis in the domain \( \Omega \times (0, T) \,, \Omega \subset \mathbb{R}^d \,, d \in \mathbb{N}  \,, T>0 \),
</p>
\begin{equation}
\label{org907ff05}
\begin{aligned}
\partial_{t}\phi(x,t) &=  \nabla \cdot(M(\phi)\nabla\mu), \\
\mu &= - \varepsilon^2 \Delta\phi  + W'(\phi),
\end{aligned}
\end{equation}
<p>
where respectively, the variables \( \phi , \mu : \Omega \times (0,T) \to \mathbb{R}^d \) are phase-field variable and chemical potential,
\(\varepsilon\) is a positive constant correlated with interface thickness, \( W(\phi) \) is a double well potential and \(M(\phi) > 0\) is a mobility coefficient (<a href="#citeproc_bib_item_2">Wu 2022</a>).
 \( \phi\) is defined in an interval \(I=[-1,1] \) and  represent the different phases.
</p>
\begin{align*}
\phi &=
\begin{cases}
1 &\,, \phi \in \text{phase 1} \\
-1 &\,, \phi \in\text{phase 2}
\end{cases}
\end{align*}

<p>
In this thesis we assume \(M(\phi) \equiv 1 \), simplifying the CH equation.
</p>

<p>
The advantages of the CH approach, as compared to traditional boundary coupling, are for example: &ldquo;explicit tracking of the interface&rdquo; (<a href="#citeproc_bib_item_2">Wu 2022</a>), as well as &ldquo;evolution of complex geometries and topological changes [&#x2026;] in a natural way&rdquo; (<a href="#citeproc_bib_item_2">Wu 2022</a>).
In practice, it enables linear interpolation between different formulas on different phases.
</p>
</div>
<div id="outline-container-org2e6a11f" class="outline-3">
<h3 id="org2e6a11f"><span class="section-number-3">2.1.</span> Physical derivation of the CH equation <a href="eqref:eq:CH">eqref:eq:CH</a></h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgc42522b" class="outline-4">
<h4 id="orgc42522b"><span class="section-number-4">2.1.1.</span> The free energy</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
The authors in (<a href="#citeproc_bib_item_2">Wu 2022</a>) define the CH equation using the <b>Ginzburg-Landau</b> free energy equation:
</p>
\begin{align}
\label{org9fb0b6a}
E^{\text{bulk}}[\phi] &= \int_{\Omega} \frac{\varepsilon^2}{2} |\nabla \phi |^2 + W(\phi) \, dx ,
\end{align}
<p>
where \(W(\phi) \) denotes the Helmholtz free energy density of mixing (<a href="#citeproc_bib_item_2">Wu 2022</a>) that we approximate it in further calculations with \(W(\phi) = \frac{(1-\phi ^2)^2}{4}\) as in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) shown in Fig. <a href="#org2782dae">1</a>.
</p>

<div id="org2782dae" class="figure">
<p><img src="images/double-well.svg" alt="double-well.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 1: </span>Double well potential \( W(\phi) \)</p>
</div>




<p>
The chemical potential, \( \mu \), then follows as the variational derivation of the free energy in <a href="eqref:eq:energy">eqref:eq:energy</a>.
</p>
\begin{align}
\label{orgd4210ef}
 \mu &= \frac{\delta E_{bulk}(\phi)}{\delta \phi} = -\varepsilon^2 \Delta \phi + W'(\phi)
\end{align}
</div>
</div>
<div id="outline-container-org77e6867" class="outline-4">
<h4 id="org77e6867"><span class="section-number-4">2.1.2.</span> Derivation of the CH equation from mass balance</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
The paper (<a href="#citeproc_bib_item_2">Wu 2022</a>) states that the observable phase separation is driven by a diffusion resulting from the gradient in chemical potential \( \mu \). The emergent conservative dynamics motivate the following diffusion equation
</p>
\begin{equation}
\label{org4d0755c}
    \partial_t \phi + \nabla \cdot \mathbf{J} = 0,
\end{equation}
<p>
where \( \mathbf{J} = -\nabla \mu \) represents mass-flux.
We follow the authors (<a href="#citeproc_bib_item_2">Wu 2022</a>) in deriving the CH equation by combining <a href="eqref:eq:chemical-potential">eqref:eq:chemical-potential</a> and <a href="eqref:eq:massbal">eqref:eq:massbal</a>.
</p>
\begin{equation}
\begin{aligned}
\implies \partial_t \phi   &=- \nabla \cdot \mathbf{J} = \Delta\mu , \\
\mu &=  -\varepsilon^2 \Delta \phi + W'(\phi) \,,
\end{aligned}
\end{equation}
<p>
Furthermore the CH equation is mass conservative under homogeneous Neumann boundary conditions, defined as:
</p>
\begin{equation}
\label{orgfb20555}
\begin{aligned}
\mathbf{J} \cdot \mathbf{n} &= 0 & \text{on} \, \partial\Omega &\times (0,T),\\
\partial_n\phi &= 0 & \text{on} \, \partial\Omega &\times (0,T),
\end{aligned}
\end{equation}
<p>
where \( \mathbf{n}  \) is the outward normal on \( \partial \Omega \).
To show the conservation of mass we analyze the change in total mass in the domain \( \Omega \) over time.
</p>
\begin{equation}
\label{org677ec9f}
\begin{aligned}
\frac{d}{dt}\int_{\Omega}\phi \ d \mathbf{x} &=\int_{\Omega}\frac{\partial \phi}{\partial t} \ d\mathbf{x} \\
&= - \int_{\Omega} \nabla \cdot \mathbf{J} \ d\mathbf{x}\\
&=  \int_{\partial\Omega}  \mathbf{J} \cdot \mathbf{n}  \ d\mathbf{s} \\
&= 0 & \forall t\in(0,T)\,,
\end{aligned}
\end{equation}

<p>
In order to show thermodynamic consistency of the CH equation, we take the time derivation of the free energy functional <a href="eqref:eq:energy">eqref:eq:energy</a>.
</p>
\begin{align*}
\frac{d}{dt}E^{bulk}[\phi(t)] &= \int_{\Omega} ( \varepsilon^2 \nabla \phi \cdot \nabla \partial_t \phi + W'(\phi) \partial_t \phi) \ d \mathbf{x} \\
&=\int_{\Omega} (\varepsilon^2\nabla\phi + W'(\phi))\partial_t\phi \ d\mathbf{x}\\
&=\int_{\Omega} \mu \partial_t \phi \ d\mathbf{x}\\
&= \int_{\Omega} \mu \cdot \Delta\mu \ d\mathbf{x} \\
&= -\int_{\Omega} \nabla\mu \cdot \nabla\mu \ dx + \int_{\partial\Omega} \mu \nabla\phi_t \cdot \mathbf{n} \ dS \\
&\stackrel{\partial_n\phi = 0}{=} - \int_{ \Omega } |\nabla \mu|^2 \ d \mathbf{x}, & \forall t \in (0,T)
\end{align*}
<p>
This a bounded \( L_2 \) norm  on of \( \nabla \mu \).
</p>
</div>
</div>
</div>
<div id="outline-container-orgb2b6bc3" class="outline-3">
<h3 id="orgb2b6bc3"><span class="section-number-3">2.2.</span> initial value problem</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Our Thesis then concerns it self with the initial value problem on the domain \( \Omega \subset \RR^2 \)
</p>
\begin{equation}
\label{orgd942730}
\begin{aligned}
\partial_{t}\phi(x,t) &=  \nabla \cdot(M(\phi)\nabla\mu), \text{in} \, \Omega &\times (0,T),\\
\mu &= - \varepsilon^2 \Delta\phi  + W'(\phi),  \text{in} \, \Omega &\times (0,T),\\
-\nabla\mu \cdot \mathbf{n} &= 0 & \text{on} \, \partial\Omega &\times (0,T),\\
\nabla\phi \cdot \mathbf{n} &= 0 & \text{on} \, \partial\Omega &\times (0,T), \\
\phi(x,0) &= \phi^0(x) \,,
\end{aligned}
\end{equation}
</div>
</div>
</div>
<div id="outline-container-org1db22d3" class="outline-2">
<h2 id="org1db22d3"><span class="section-number-2">3.</span> Discretization of the CH equation</h2>
<div class="outline-text-2" id="text-3">
<p>
This thesis used a finite difference discretization of the CH equation in space and time , that is implicit in time.
</p>
</div>
<div id="outline-container-org5317ffb" class="outline-3">
<h3 id="org5317ffb"><span class="section-number-3">3.1.</span> The discretization of functions and derivative operators</h3>
<div class="outline-text-3" id="text-3-1">
<p>
As baseline for numerical experiments we use a two-grid method based on the finite difference method defined in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
Our discretization follows the one taken by the authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
We discretize our domain \( \Omega \) to be a Cartesian-grid \( \Omega_d \) on a square with side-length \( N\cdot h \), where N is the number of grid-points in one direction, and \( h \) is the distance between grid-points. In all our initial data \( h \) is \( 3\cdot10^{-3}\) and \( N=64 \). However, for stability tests we change \( h \) and \( N \).
 The discrete version or our domain is
</p>
\begin{equation}
\Omega_d = \left\{ i,j \mid i,j \in \mathbb{N} \,, i,j \in [2,N+1] \right\},
\end{equation}
<p>
as shown in <a href="ref:fig:discrete-domain">ref:fig:discrete-domain</a>
</p>

<div id="org0fa9d5e" class="figure">
<p><img src="images/domain.svg" alt="domain.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 2: </span>Discrete Domain used in this Thesis. 1 is inside and 0 outside of the Domain.</p>
</div>


<p>
We discretize the phase-field ,\( \phi \), and chemical potential ,\( \mu \), into grid-wise functions \(\phi_{ij}, \mu_{ij} \) such that
</p>
\begin{equation}
\begin{aligned}
\phi_{ij}^n: \Omega_d \times \left\{ 0, \dots  \right\} &\to \mathbb{R} \,,\\
\mu_{ij}^n: \Omega_d \times \left\{ 0, \dots \right\} &\to \mathbb{R} \,,
\end{aligned}
\end{equation}
<p>
Here \( n \) denotes the nth time-step, and \( (i,j) \) are Cartesian indices on the discrete domain \( \Omega_d \).
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) then use the characteristic function \( G \) of the  domain \( \Omega \) to enforce no-flux boundary conditions <a href="eqref:eq:boundary-conditions">eqref:eq:boundary-conditions</a>.
</p>

\begin{align*}
G(x,y) &=
\begin{cases}
1, & (x,y) \in  \Omega \\
0, & (x,y) \not\in  \Omega
\end{cases}
\end{align*}
<p>
We implement the discrete version of \( G \) on \( \Omega_d \) as follows:
</p>
\begin{align*}
G_{ij} &=
\begin{cases}
1, & i,j \in [2,N+1]  \\
0, & \text{else}
\end{cases}
\end{align*}
<p>
The definition of \( G_{ij} \) with \( i,j \in [2,N+1] \) enables us to evaluate \( G_{ij} \) of-grid.
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">if</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">i</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">len</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">1</span> <span style="color: #fabd2f;">&amp;&amp;</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">width</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">1</span>
        <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">1.0</span>
    <span style="color: #fb4934;">else</span>
        <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">0.0</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
We then define the discrete derivatives \( D_x\phi_{ij}, \ D_y\phi_{ij} \) using finite differences:
</p>
\begin{align}
D_x\phi^{n+1,m}_{i+\frac{1}{2} j} &= \frac{\phi^{n+1,m}_{i+1j} - \phi^{n+1,m}_{ij}}{h} & D_y\phi^{n+1,m}_{ij+\frac{1}{2}} &= \frac{\phi^{n+1,m}_{ij+1} - \phi^{n+1,m}_{ij}}{h}
\end{align}
<p>
We define \( D_x\mu_{ij}^{n+\frac{1}{2},m} , D_y\mu_{ij}^{n+\frac{1}{2},m} \) in the same way.
Next we define the discrete gradient \( \nabla_d \phi^{n+1,m}_{ij}\), as well as a modified Laplacian \( \nabla_d \cdot (G_{ij} \nabla_d \phi^{n+1,m}_{ij} )\):
</p>



\begin{equation}
\label{org582998b}
\begin{aligned}
\nabla_d \phi^{n+1,m}_{ij} &= \left(D_x \phi^{n+1,m}_{i+1j} , \ D_y \phi^{n+1,m}_{ij+1}\right) \,,\\
 \nabla_d \cdot (G_{ij} \nabla_d \phi^{n+1,m}_{ij}) &= \frac{G_{i+\frac{1}{2}j}D_x \phi^{n+1,m}_{i+\frac{1}{2}j} -  G_{i-\frac{1}{2}}D_x \phi^{n+1,m}_{i-\frac{1}{2}j} + D_y \phi^{n+1,m}_{ij+\frac{1}{2}} - D_y \phi^{n+1,m}_{ij-\frac{1}{2}}}{h} \\
  &= \frac{ G_{i+\frac{1}{2}j} \phi^{n + 1,m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n +,m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n +,m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n +,m}_{ij-1}    }{h^2}\\
& \, - \frac{\left(   G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}} \right) \cdot \phi_{ij} }{h^2} \,,
\end{aligned}
\end{equation}
<p>
The discretization for \(  \nabla_d\mu_{ij}^{n+\frac{1}{2},m} ,  \nabla_d \cdot (G_{ij} \nabla_d \mu^{n+\frac{1}{2},m}_{ij}) \) are done the same as for \( \phi_{ij}^{n+1} \).
 We define \(   \nabla_d \cdot (G_{ij} \nabla_d \phi_{ij} )\) instead of a discrete Laplacian \( \Delta_d \) to ensure a discrete version of boundary conditions <a href="eqref:eq:boundary-conditions">eqref:eq:boundary-conditions</a>.
 The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) show this to be the case by expanding \( \nabla_d \cdot (G_{ij} \nabla_d\phi_{ij}) \).
Notably, when one point lies outside the domain, e.g. \( G_{i + \frac{1}{2}} = 0 \)  then the corresponding discrete gradient \( \frac{\phi_{i+1}^{n+1} - \phi_i}{h}  \) is weighted by 0. This corresponds the discrete version of \( \partial_n\phi = 0 \) (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
</p>

<p>
To simplify the notation for discretized derivatives we use the following abbreviations:
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \phi_{ij} = G_{i+\frac{1}{2}j} \phi^{n + 1,m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n +1,m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n +1,m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n +1,m}_{ij-1}  \)</li>
<li>\(  \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \)</li>
</ul>
<p>
The Code for those abreviations is:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">(</span>
        <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">)</span>

<span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">function</span> <span style="color: #83a598;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">(</span>
        <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
We can then write the modified Laplacian \( \nabla_d \cdot (G \nabla_d\phi_{ij}^{n+1}) \) as:
</p>
\begin{align}
\label{org086a59d}
\nabla_{d} \cdot(G \nabla_d\phi_{ij}^{n+1}) &= \frac{\Sigma_G\phi_{ij}^{n+1} - \Sigma_{Gij}\cdot \phi_{ij}^{n+1}}{h^2}
\end{align}
<p>
We use this modified Laplacian to deal with boundary conditions. Our abbreviations simplify separating implicit and explicit terms in the discretization.
</p>
</div>
</div>
<div id="outline-container-org38420e4" class="outline-3">
<h3 id="org38420e4"><span class="section-number-3">3.2.</span> Initial data</h3>
<div class="outline-text-3" id="text-3-2">
<p>
For testing of our numerical solver for <a href="eqref:eq:initial-value-problem">eqref:eq:initial-value-problem</a>  we use initial discrete phase-fields defined by the following equations:
</p>

\begin{equation}
\begin{aligned}
\phi_{ij}^{0} &=
\begin{cases}
1 &\,, \|(i,j) - (\frac{N}{2} , \frac{N}{2})\|_p < \frac{N}{3}\\
-1 &\,,else
\end{cases}
&
\text{where    }  p \in \{2,\infty\}
\\
\phi_{ij}^0 &=
\begin{cases}
1 &\,,  i < \frac{N}{2} \\
-1 &\,,else
\end{cases}
\\
\phi_{ij}^0 &=
\begin{cases}
1 &\,, \|(i,j) - (\frac{N}{2} , 2)\|_2 < \frac{N}{3} \\
-1 &\,,else
\end{cases}
\\
\phi_{ij}^0 &=
\begin{cases}
1 &\,, \| (i,j) - q_k \|_p < \frac{N}{5}  \\
-1 &\,,else
\end{cases}
& p \in \{1,2, \infty\} , q_k \in Q
\end{aligned}
\end{equation}
<p>
where \( q_k \) are random points inside my domain. We generate those using the following RNG setup in Julia
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Random</span>
<span style="color: #83a598;">rng</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">MersenneTwister</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">42</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">gridsize</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">64</span>
<span style="color: #83a598;">radius</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">gridsize</span> <span style="color: #fabd2f;">/</span><span style="color: #d3869b;">5</span>
<span style="color: #83a598;">blobs</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">gridsize</span> &#247; <span style="color: #d3869b;">5</span>
<span style="color: #83a598;">rngpoints</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">rng</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">gridsize</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">blobs</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>

<pre class="example">
MersenneTwister(42)
64
12.8
12
2Ã—12 Matrix{Int64}:
 48  40  20   1  63  49   8  60  26  58  26  11
 17  13  56  52  15   9  30  14  40   9  40  25
</pre>






<div id="org262120f" class="figure">
<p><img src="images/testdata.svg" alt="testdata.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 3: </span>Examples of different phase-fields used as the initial condition.</p>
</div>
</div>
</div>
<div id="outline-container-orgb9542a1" class="outline-3">
<h3 id="orgb9542a1"><span class="section-number-3">3.3.</span> Discretization into a linear system</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) then define the discrete CH equation adapted for the domain as:
</p>
\begin{equation}
\label{org716d91a}
\begin{aligned}
\frac{\phi_{ij}^{n+1} - \phi_{ij}^n}{\Delta t}  &=  \nabla _d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2}} )  \,, \\
 \mu_{ij}^{n+\frac{1}{2}} &= 2\phi_{ij}^{n+1} - \varepsilon^2  \nabla_d \cdot  (G_{ij} \nabla _d \phi_{ij}^{n+1} ) + W'(\phi_{ij}^n) - 2\phi _{ij}^n \,,
\end{aligned}
\end{equation}
<p>
and derive a numerical scheme from this equation.
This method is semi-implicit in time, and consists of a centered difference in space.
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) derive their method by separating <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> into implicit and linear terms, and explicit non-linear terms. We write the implicit terms in form of a function \( L: \RR^2 \to \RR^2  \) and the explicit terms in \( (\zeta^n_{ij} , \psi^n_{ij})^T \). We define \( L \) as:
</p>
\begin{align*}
L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
&:=
\begin{pmatrix}
\frac{\phi^{n+1}_{ij}}{\Delta t} - \nabla _d \cdot  ( G_{ij} \nabla _d \mu^{n+\frac{1}{2}}_{ij} ) \\
\varepsilon^2 \nabla _d \cdot  (G \nabla_d \phi_{ij}^{n+1}) - 2\phi_{ij}^{n+1} + \mu_{ij}^{n+\frac{1}{2}}
\end{pmatrix}
& \forall i,j&\in\{2, \dots , N+1\}.
\end{align*}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">phi</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">mu</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">xi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span>
         <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
          <span style="color: #fabd2f;">-</span>
          <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">mu</span> <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #83a598;">psi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span>
          <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
           <span style="color: #fabd2f;">-</span>
           <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">phi</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">phi</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">mu</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
This function follows from <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> and is linear in the unknowns \( \left(\phi^{n+1}_{ij} , \mu^{n+\frac{1}{2}}_{ij} \right) \). The non-linear terms of <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> are collected in \( \left(\zeta^n_{ij}, \psi^n_{ij} \right) \). Which we define as
</p>
\begin{align}
\begin{pmatrix}
\zeta^n_{ij}
 \\
\psi^n_{ij}
\end{pmatrix}
&:=
\begin{pmatrix}
\frac{\phi_{ij}^{n}}{\Delta t}\\
W'(\phi_{ij}^n) - 2\phi_{ij}^n
\end{pmatrix}
& \forall i,j&\in\{2, \dots , N+1\}.
\end{align}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #83a598; font-weight: bold;">xi_init</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">x</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span>
    <span style="color: #83a598; font-weight: bold;">psi_init</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598; font-weight: bold;">W_prime</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">x</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">xi_init</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">psi_init</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">return</span> <span style="color: #83a598;">nothing</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
The authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) defined a numerical method where all non linear terms are evaluated explicitly. Therefore , we know everything needed to calculate \( (\zeta^n_{ij} , \psi^n_{ij})^T \) at the beginning of each time step. We compute those values once and store them in the solver.
Using \(  \left(\zeta^n_{ij}, \psi^n_{ij} \right)  \) and  \(   L\left(\phi^{n+1}_{ij} , \mu^{n+\frac{1}{2}}_{ij} \right) \) , we can rewrite <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> as
</p>
\begin{equation}
\label{org68a2cea}
\begin{aligned}
L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\zeta^n_{ij} \\
\psi^n_{ij}
\end{pmatrix}
.
& \forall i,j \in \{1, \dots , N\}
\end{aligned}
\end{equation}

<p>
This Linear system consists of NxN, 2 dimensional linear equations.
Each equation in the linear system  <a href="eqref:eq:LES">eqref:eq:LES</a> can be rewriten in the form \(\operatorname{\mathbf{DL}}_{ij} \cdot \left( \phi^{n+1}_{ij} , \mu^{n+\frac{1}{2}}_{ij} \right)^T = b_{ij}\):
Where \( \operatorname{\mathbf{DL}}_{ij} \) is
</p>
\begin{align*}
 \operatorname{\mathbf{DL}}_{ij} &=
\begin{pmatrix}
\frac{1}{\Delta t} & \frac{1}{h^2}\Sigma_{Gij}  \\
-\frac{\varepsilon^2}{h^2}\Sigma_{Gij} - 2 & 1
\end{pmatrix}
\end{align*}
<p>
and where \( \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}} \)
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">*</span><span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">;</span>
             <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
\( \operatorname{\mathbf{DL}}_{ij} \) is invertible, since its determinant is positive. Therefore the system <a href="eqref:eq:LES">eqref:eq:LES</a> is solvable
</p>
\begin{equation}
\operatorname{det}(\operatorname{\mathbf{DL}}_{ij}) = \frac{1}{\Delta t} + \frac{1}{h^2}\Sigma_{Gij}  \left( + \frac{\varepsilon^2}{h^2}\Sigma_{Gij} +2 \right) > 0
\end{equation}
<p>
as \( \Sigma_{Gij} \in \{0,1,2,3,4\} \)
Using The abbreviation for \( \nabla_d \cdot(G_{ij}\nabla_d \mu_{ij}^{n+\frac{1}{2}}) \) introduced in <a href="eqref:eq:modified-laplacian">eqref:eq:modified-laplacian</a> , and we rewrite <a href="eqref:eq:LES">eqref:eq:LES</a> in terms of \( \operatorname{\mathbf{DL}}_{ij} \)
</p>
 \begin{equation}
\label{org598a8a0}
\begin{aligned}
&L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
=
\begin{pmatrix}
\zeta^n_{ij} \\
\psi^n_{ij}
\end{pmatrix}
\\
\implies \quad
&\operatorname{\mathbf{DL}}_{ij}\cdot
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
+
\begin{pmatrix}
 - \frac{1}{h^2} \Sigma_{Gij}\mu_{ij}^{n+\frac{1}{2}} \\
+ \frac{\varepsilon^2}{h^2} \Sigma_{Gij}\phi_{ij}^{n+1} \\
\end{pmatrix}
=
\begin{pmatrix}
  \zeta_{ij}^n\\
\psi_{ij}^n
\end{pmatrix}
,\\
\implies \quad
&
\operatorname{\mathbf{DL}}_{ij}\cdot
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
=
\begin{pmatrix}
  \zeta_{ij}^n\\
\psi_{ij}^n
\end{pmatrix}
-
\begin{pmatrix}
 - \frac{1}{h^2} \Sigma_{Gij}\mu_{ij}^{n+\frac{1}{2}} \\
+ \frac{\varepsilon^2}{h^2} \Sigma_{Gij}\phi_{ij}^{n+1} \\
\end{pmatrix}
\,,
\end{aligned}
\end{equation}
<p>
where
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \phi_{ij}^{n+1} = G_{i+\frac{1}{2}j} \phi^{n + 1,m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n + 1,m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n + 1,m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n + 1,m}_{ij-1}  \),
\(  \Sigma_G \mu_{ij}^{n+\frac{1}{2}} = G_{i+\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i+1j} +  G_{i-\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i-1j} + G_{ij+\frac{1}{2}}  \mu^{n + \frac{1}{2},m}_{ij+1} + G_{ij-\frac{1}{2}} \mu^{n + \frac{1}{2},m}_{ij-1}  \),</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgb738c04" class="outline-2">
<h2 id="orgb738c04"><span class="section-number-2">4.</span> Numerical solver</h2>
<div class="outline-text-2" id="text-4">
<p>
The multi-grid method consists of a linear Gauss-Seidel solver, restriction and prolongation methods, to move course and fine grids.
</p>
</div>
<div id="outline-container-org952aca7" class="outline-3">
<h3 id="org952aca7"><span class="section-number-3">4.1.</span> Gauss-Seidel  smoothing</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)derived Gauss-Seidel Smoothing from <a href="eqref:eq:LES">eqref:eq:LES</a> :
 Smoothing denoted as a SMOOTH operator consists of a Gauss-Seidel method, by solving <a href="eqref:eq:explicit-smooth">eqref:eq:explicit-smooth</a> for all \( i,j \) with the initial guess for \( \zeta^n_{ij} , \psi^n_{ij} \).
We define an iterative Gaus Seidel method. After having solved equation <a href="eqref:eq:LES">eqref:eq:LES</a> for \( \left( i-1,j \right) , \left( i , j-1\right)\) we define the Gaus-Seidel iteration in \( s \) for \( \left( i,j \right) \) as follows:
</p>
\begin{equation}
\label{orgd38680e}
\operatorname{\mathbf{DL}}_{ij} \cdot
\begin{pmatrix}
\phi^{n+1 , s+1}_{ij} \\
\mu^{n+\frac{1}{2} , s+1}_{ij}
\end{pmatrix}
=
\begin{pmatrix}
  \zeta_{ij}^n\\
\psi_{ij}^n
\end{pmatrix}
-
\begin{pmatrix}
 - \frac{1}{h^2} \Sigma_{Gij}\mu_{ij}^{n+\frac{1}{2} , s + \frac{1}{2}} \\
+ \frac{\varepsilon^2}{h^2} \Sigma_{Gij}\phi_{ij}^{n+1 , s+\frac{1}{2}} \\
\end{pmatrix}
\,,
\end{equation}
<p>
where
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \phi_{ij}^{n+1  , s+\frac{1}{2}} = G_{i+\frac{1}{2}j} \phi^{n + 1,s}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n + 1,s+1}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n + 1,s}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n + 1,s+1}_{ij-1}  \),</li>
<li>\(  \Sigma_G \mu_{ij}^{n+\frac{1}{2},s+\frac{1}{2}} = G_{i+\frac{1}{2}j} \mu^{n + \frac{1}{2},s}_{i+1j} +  G_{i-\frac{1}{2}j} \mu^{n + \frac{1}{2},s+1}_{i-1j} + G_{ij+\frac{1}{2}}  \mu^{n + \frac{1}{2},s}_{ij+1} + G_{ij-\frac{1}{2}} \mu^{n + \frac{1}{2},s+1}_{ij-1}  \),</li>
</ul>
<p>
This constitutes a Gaus-Seidel method in its element based formula.
</p>
<div class="org-src-container">
<pre class="src src-julia" id="org7d9aba9"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">iterations</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">adaptive</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">gradient_boundary_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">s</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">iterations</span>
        <span style="color: #928374;"># old_phase = copy(solver.phase)</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>

            <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">calculate</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">left</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">hand</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">side</span><span style="color: #fabd2f;">&gt;&gt;</span>

            <span style="color: #83a598;">res</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">\</span> <span style="color: #83a598;">b</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
We denote the approximations for \( \left( \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij}  \right)  \) after smoothing, as  \( \left( \bar{\phi}_{ij}^{n+1} , \bar{\mu}^{n+\frac{1}{2}}_{ij}  \right)  \).
In Fig.<a href="#org484d123">4</a> we show 4 of the 7 initial data after one 200 iterations of smoothing. It is apparent that the sharp interface from the initial Data has diffused.
</p>

<div id="org484d123" class="figure">
<p><img src="images/smooth.svg" alt="smooth.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 4: </span>Inputs from <a href="#org38420e4">3.2</a> after SMOOTH.</p>
</div>
</div>
</div>
<div id="outline-container-orgfc468b0" class="outline-3">
<h3 id="orgfc468b0"><span class="section-number-3">4.2.</span> Two-grid method</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The numerical method proposed in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) consists of repeated sub-iterations of a multi-grid V-cycle.  Specifically we use a two-grid implementation with a fixed number of sub-iterations. Defined as:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">timesteps</span>

    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>

    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">subiterations</span>

        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
The approximations for \( \phi_{ij}^{n+1} , \mu_{ij}^{n+\frac{1}{2}} \) after the m-th V-cycle sub-iteration are denoted with \(  \phi_{ij}^{n+1,m+1} , \mu_{ij}^{n+\frac{1}{2},m+1}  \) where \( m \) denotes the current sub-iteration Furthermore the V-cycle consists of the following setps:
</p>
</div>
<div id="outline-container-org14525d6" class="outline-4">
<h4 id="org14525d6"><span class="section-number-4">4.2.1.</span> Pre Smoothing</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
Pre smoothing consists of a fixed number of Gauss-Seidel iterations, in our case <b>40</b>,  on the fine grid \( h \), as described in Chapter <a href="#org952aca7">4.1</a>. Afterwards we calculate the residual error \( \left(d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m} \right) := L\left( \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij}  \right) - (\zeta^n_{ij} , \psi^n_{ij}  )  \) for the course grid \( H \) correction.
</p>
</div>
</div>
<div id="outline-container-org188f5ed" class="outline-4">
<h4 id="org188f5ed"><span class="section-number-4">4.2.2.</span> Restriction</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
Restriction from the fine grid to the course grid \(  h \to H  \) for a variable eg. \( \phi_{ij} \) is done as follows:
</p>
\begin{equation}
\phi^{H}_{ij} = \frac{1}{\Sigma_{Gij}} \left(G_{2i,2j}\phi^{h}_{2i,2j} + G_{2i-1,2j} \phi^{h}_{2i-1,2j} + G_{2i,2j-1}  \phi^{h}_{2i,2j-1} +G_{2i-1,2j-1} \phi^{h}_{2i-1,2j-1} \right)
\end{equation}
</div>
</div>
<div id="outline-container-org7f1cd56" class="outline-4">
<h4 id="org7f1cd56"><span class="section-number-4">4.2.3.</span> Course grid solution</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
On the course grid we use a Gauss-Seidel iteration to solve \( L(\hat{\phi}_{ij,H}^{n+1,m}, \hat{\mu}_{ij,H}^{n+\frac{1}{2},m})_H = L(\bar{\phi}_{ij,H}^{n+1,m} , \bar{\mu}_{ij,H}^{n+\frac{1}{2},m}) + (d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m}) \).
    We solve for \( \left( \hat{\phi}_{ij,H}^{n+1,m}, \hat{\mu}_{ij,H}^{n+\frac{1}{2},m} \right) \) using the same iteration as in Chapter <a href="#org952aca7">4.1</a> however we replace \( (\zeta_{ij}^{n} , \psi_{ij}^n) \) with  \(  L(\bar{\phi}_{ij,H}^{n+1,m} , \bar{\mu}_{ij,H}^{n+\frac{1}{2},m}) + (d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m}) \).  In the iteration, where \( \left( \bar{\phi}_{ij,H}^{n+1,m} , \bar{\mu}_{ij,H}^{n+\frac{1}{2},m} \right) \) are the values after the smooth restricted to the coarser grid and \( \left( d_{ij,H}^{n+1,m} , r_{ij,H}^{n+1,m} \right) \) is the residual from the smooth  iteration on the fine grid restricted onto the coarse grid.
</p>
</div>
</div>
<div id="outline-container-orgde4db96" class="outline-4">
<h4 id="orgde4db96"><span class="section-number-4">4.2.4.</span> Prolongation</h4>
<div class="outline-text-4" id="text-4-2-4">
<p>
We prolong the solution from the course grid. Prolongation of a variable eg. \( \phi_{ij} \) from the course grid to the fine grid \( H\to h \) we do by using the nearest neighbour weighed by  \( G \).
</p>
\begin{equation}
\begin{pmatrix}
\phi^h_{2i,2j} \\
\phi^h_{2i-1,2j} \\
\phi^h_{2i,2j-1} \\
\phi^h_{2i-1,2j-1}
\end{pmatrix}
=
\begin{pmatrix}
G^{h}_{2i,2j}    \phi_{ij}^{H}       \\
G^{h}_{2i-1,2j}  \phi_{ij}^{H}       \\
G^{h}_{2i,2j-1}  \phi_{ij}^{H}       \\
G^{h}_{2i-1,2j-1}\phi_{ij}^{H}
\end{pmatrix}
\end{equation}
</div>
</div>
<div id="outline-container-org7c6e32c" class="outline-4">
<h4 id="org7c6e32c"><span class="section-number-4">4.2.5.</span> Post Smoothing</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
After prolongation of the course grid solution we perform a post smoothing step using <b>80</b> Gauss-Seidel steps. Post smoothing is otherwise identical to pre smoothing
</p>
</div>
</div>
<div id="outline-container-org1da4a9f" class="outline-4">
<h4 id="org1da4a9f"><span class="section-number-4">4.2.6.</span> additional considerations</h4>
<div class="outline-text-4" id="text-4-2-6">
<p>
We Do Gauss-Seidel smoothing with fixed iterations. As well as a fixed number of sub-iterations.
</p>

<p>
The V-cycle of a two-grid method using pre- and post-smoothing is then stated by:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">alt_v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Array</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">}</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">solver</span>
    <span style="color: #83a598;">finegrid_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #928374;">#pre SMOOTHing</span>
    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">40</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">d</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598;">r</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #928374;"># calculate error between L and expected values</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">d</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span>
        <span style="color: #fb4934;">.-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #83a598; font-weight: bold;">restrict_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598;">coursegrid_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #83a598;">solution</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">deepcopy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">d_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">restrict</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">d</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">r_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">restrict</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">r</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>


    <span style="color: #83a598;">u_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598;">v_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span>  <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">coursegrid_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">)</span> .<span style="color: #fabd2f;">+</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">r_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">40</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">u_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span>
    <span style="color: #83a598;">v_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">coursegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span>

    <span style="color: #83a598;">finegrid_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">+=</span> <span style="color: #83a598; font-weight: bold;">prolong</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">u_large</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">+=</span> <span style="color: #83a598; font-weight: bold;">prolong</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">v_large</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>


    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">finegrid_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">80</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Array</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">}</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">solver</span>
    <span style="color: #83a598;">solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #928374;">#pre SMOOTHing:</span>
    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">400</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">d</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598;">r</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #928374;"># calculate error between L and expected values</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">d</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">restrict</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">to</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">coarse</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">grid</span><span style="color: #fabd2f;">&gt;&gt;</span>

    <span style="color: #928374;">#Newton Iteration for solving smallgrid</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">300</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>

            <span style="color: #83a598;">diffrence</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
                        <span style="color: #fb4934;">.-</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span>
                        <span style="color: #fb4934;">.-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>

            <span style="color: #83a598;">local</span> <span style="color: #83a598;">ret</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">\</span> <span style="color: #83a598;">diffrence</span>

            <span style="color: #83a598;">u_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">ret</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">v_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">ret</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fb4934;">end</span>
        <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-=</span> <span style="color: #83a598;">u_large</span>
        <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">-=</span> <span style="color: #83a598;">v_large</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">prolong</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">to</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">fine</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">grid</span><span style="color: #fabd2f;">&gt;&gt;</span>

    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">800</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">false</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>


<p>
After a few iterations, V-cycle exhibits the following behavior:
</p>

<div class="org-src-container">
<pre class="src src-julia-vterm" id="orgd3a32ac"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">init</span><span style="color: #fabd2f;">&gt;&gt;</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">DataFrames</span>
<span style="color: #83a598;">results</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">jldopen</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"experiments/iteration.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #b8bb26;">"result"</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">anim</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">animate</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">res</span> in <span style="color: #83a598; font-weight: bold;">eachrow</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"phase field"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">legend</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">aspectratio</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">equal</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">showaxis</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">false</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">grid</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">false</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">size</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">400</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">400</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">gif</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">anim</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/iteration.gif"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">fps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>


<div id="org6f2a34a" class="figure">
<p><img src="images/iteration.gif" alt="iteration.gif" />
</p>
<p><span class="figure-number">Figure 5: </span>A few time steps of the solver for different initial conditions as shown in <a href="#org38420e4">3.2</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org13c5b27" class="outline-2">
<h2 id="org13c5b27"><span class="section-number-2">5.</span> Numerical experiments</h2>
<div class="outline-text-2" id="text-5">
<p>
In the previous Chapter we discretized the CH equation based on the two-grid method described by the authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) and we obtained a numerical scheme for \( \phi , \mu \). In this chapter we analyze the change in mass, change in total energy \( E^{bulk} \), the stability in time , space and during sub-iterations.
Since we do not have exact solutions for the initial values tested we evaluate our solvers with a Cauchy criterion. The  initial values we use, if not mentioned otherwise, where:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Variable:</td>
<td class="org-left">&epsilon;</td>
<td class="org-left">&Delta; t</td>
<td class="org-left">h</td>
</tr>

<tr>
<td class="org-left">Value:</td>
<td class="org-left">8 * 10<sup>-3</sup></td>
<td class="org-left">10<sup>-3</sup></td>
<td class="org-left">3*10<sup>-3</sup></td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-org6c3c4d9" class="outline-3">
<h3 id="org6c3c4d9"><span class="section-number-3">5.1.</span> Energy evaluations</h3>
<div class="outline-text-3" id="text-5-1">
<p>
The discrete energy measure we use:
</p>
\begin{equation}
\label{org1f02091}
\begin{aligned}
E^{\text{bulk}}_d(\phi_{ij}) &= \sum_{i,j \in \Omega} \frac{\varepsilon^2}{2} |G\nabla_d \phi_{ij} |^2 + W\left(\phi_{ij}\right)  \\
&= \sum_{i,j \in \Omega} \frac{\varepsilon^2}{2} G_{i+\frac{1}{2}j}(D_x\phi_{i+\frac{1}{2}j}) ^2 + G_{ij+\frac{1}{2}}(D_y\phi_{ij+\frac{1}{2}})^2  + W\left(\phi_{ij}\right)  .\\
\end{aligned}
\end{equation}
<p>
Since the continuous total energy <a href="eqref:eq:energy">eqref:eq:energy</a> decreases over time, we expect it&rsquo;s discrete counterpart to exhibit the same behaviour. Them numerical implementation for the bulk energy can be found in the Appendix.
</p>

<p>
In Fig.<a href="#orga6b3e60">6</a> we observe the discrete total energy going down with increasing number of time-steps, as we expect from a  CH based solver. Visually we observe the energy decrease as reduced surface curvature.
</p>

<div id="orga6b3e60" class="figure">
<p><img src="images/energy_balance.svg" alt="energy_balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 6: </span>Behaviour of energy \( E_{bulk} \) over time for one initial condition \( \phi_0 \).</p>
</div>
</div>
</div>
<div id="outline-container-orgbcaee81" class="outline-3">
<h3 id="orgbcaee81"><span class="section-number-3">5.2.</span> Numerical mass conservation</h3>
<div class="outline-text-3" id="text-5-2">
<p>
The analytical CH equation in <a href="eqref:eq:CH">eqref:eq:CH</a>  is mass conservative as shown in <a href="eqref:eq:mass-conservation">eqref:eq:mass-conservation</a>.
Instead of a physical mass we use the average of \(\phi\) over the domain \(\Omega\).
This yields a balance between both phases.  Since our implementation uses no-flow boundary conditions the balance between <i>phase 1</i> and <i>phase 2</i> stays the same. We therefore calculate a balance
</p>
\begin{align*}
b &= \frac{\sum_{i,j \in \Omega} \phi_{ij}}{N^2}
\end{align*}
<p>
such that \( b = 1 \) means there  only is phase 1, \( \phi \equiv 1 \), and \( b = -1 \) means there is only phase 2, \( \phi \equiv -1 \).
Ideally this value stays constant over time, for numerical mass conservation.
In practice we observe slight fluctuations in Figure <a href="#org9582daf">7</a>. Those however are close to machine precision and can therefore be ignored. The numerical implementation is  in appendix
</p>


<div id="org9582daf" class="figure">
<p><img src="images/mass_balance.svg" alt="mass_balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 7: </span>Behaviour of phase change over time for one initial condition \( \phi_0 \).</p>
</div>
</div>
</div>
<div id="outline-container-orgb81b0c3" class="outline-3">
<h3 id="orgb81b0c3"><span class="section-number-3">5.3.</span> Stability of a two-grid sub-iteration</h3>
<div class="outline-text-3" id="text-5-3">
<p>
We expect our solver to stay stable when increasing the number of two-grid sub-iterations. To validate this assumption we show convergence with the following Cauchy criterion.
</p>
\begin{equation}
\| \phi^{n+1,m-1} - \phi^{n+1,m} \|_{Fr}:= \sqrt{ \sum_{i,j \in \Omega_d} \left|   \phi^{n+1,m-1}_{ij} - \phi^{n+1,m}_{ij} \right|^2 }
\end{equation}
<p>
We use similar criteria in the following sub chapters to show convergence for different hyperparameters.
We expect sub-iterations to show Cauchy convergence, which is what we observe in Figure <a href="#orgc30b581">8</a>.
</p>

<div id="orgc30b581" class="figure">
<p><img src="images/convergence.svg" alt="convergence.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 8: </span>Stability of the original CH solver for increasing sub-iterations</p>
</div>

<p>
During sub-iterations the convergence is exponential , and is reached at about 16 sub-iterations. The bend is only observed in the first time-step, and is likely due to the sharp interface in the initial values which is diffused during the first few sub-iterations. Looking at the difference before, and after one time step, it is apparent , that change is largest in areas with high curvature, which are mainly corners in the interface. Testing showed, that the number of sub-iterations required for convergence is dependant on the number of Gauss-Seidel iterations on each two-grid cycle. Though the general exponential behaviour stayed the same.
</p>
</div>
</div>
<div id="outline-container-org71ff987" class="outline-3">
<h3 id="org71ff987"><span class="section-number-3">5.4.</span> Stability in time</h3>
<div class="outline-text-3" id="text-5-4">
<p>
We expect our numerical error to decrease when calculating with smaller time steps. To test this, we  successively subdivide the original time interval \( [0,T] \) in finer parts. We fix \( \Delta t \cdot n = T \) for \( T=10^{-2} \) and test different values of \( n \). In Figure <a href="#org671e06d">9</a>, as before, we employ a Cauchy criterion to compare the solution at \( T=10^{-2} \). We employ \( \|\phi^{n,64} - \phi^{n-1,64} \|_{Fr} \) as measure.
</p>

<div id="org671e06d" class="figure">
<p><img src="images/time-stability.svg" alt="time-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 9: </span>Behavior of the baseline solver while solving the time interval \( T = \left[ 0 , 10^{-2} \right] \) with increasing number of time-steps.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org00d912d" class="outline-2">
<h2 id="org00d912d"><span class="section-number-2">6.</span> Relaxed Cahn-Hilliard equation</h2>
<div class="outline-text-2" id="text-6">
<p>
In effort to decrease the order of complexity, from fourth order derivative to second order, we propose an elliptical relaxation approach, where the relaxation variable \( c \) is the solution of the following elliptical PDE:
</p>
\begin{align}
\label{orga239e90}
- \Delta c^\alpha  + \alpha c^a &= \alpha \phi ^\alpha, & \text{in} \quad \Omega
\end{align}
<p>
where \( \alpha \) is a relaxation parameter. We expect to approach the original solution of the CH equation <a href="eqref:eq:CH">eqref:eq:CH</a> as  \( \alpha \to \infty \).
This results in the following relaxation for the classical CH equation
</p>
\begin{equation}
\label{orgadababe}
\begin{aligned}
\partial_t \phi^\alpha  &= \Delta \mu \,, & \text{in} \quad \Omega \times (0,T) \\
\mu &= - \varepsilon ^2 \alpha(c^\alpha - \phi^\alpha) + W'(\phi). & \text{in} \quad \Omega \times (0,T)
\end{aligned}
\end{equation}
<p>
It requires solving the elliptical PDE for each time-step to calculate \(c\).
</p>
</div>
<div id="outline-container-org8fe4682" class="outline-3">
<h3 id="org8fe4682"><span class="section-number-3">6.1.</span> Relaxed initial value problem</h3>
<div class="outline-text-3" id="text-6-1">
<p>
In this Thesis, regarding the relaxed CH equation, we concern our self with the following initial value problem, and it&rsquo;s numerical solution.
</p>
\begin{equation}
\label{org06a24dd}
\begin{aligned}
\partial_{t}\phi(x,t) &=  \Delta\mu^{\alpha}\,, \\
\mu^{\alpha} &= - \varepsilon ^2 \alpha(c^\alpha - \phi^\alpha) + W'(\phi) \,, \\
- \Delta c^\alpha  + \alpha c^a &= \alpha \phi ^\alpha, & \text{in} \quad \Omega&\times(0,T\\
-\nabla\mu^{\alpha} \cdot \mathbf{n} &= 0 \,, \\
\nabla\phi^{\alpha} \cdot \mathbf{n} &= 0 \,, \\
\nabla c^{\alpha} \cdot \mathbf{n} &= 0 & \text{on} \, \partial\Omega &\times (0,T)\,, \\
\phi^{\alpha}(\vec{x},0) &= \phi^0(\vec{x}) \,, \\
c^{\alpha}(\vec{x},0) &= \phi^0(\vec{x}) \,, &\text{in} \quad \Omega
\end{aligned}
\end{equation}
</div>
</div>
<div id="outline-container-org5a4988c" class="outline-3">
<h3 id="org5a4988c"><span class="section-number-3">6.2.</span> Relaxed energy functional</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Let \(\phi_0 \in H^4(\Omega) \) and \(T>0\) be fixed. We assume, there exists a classical solution \(\phi^\alpha , c^\alpha : \Omega \times (0,1) \to \RR  \) of <a href="eqref:eq:relaxed-initial-value-problem">eqref:eq:relaxed-initial-value-problem</a>. Then the enregy functional for the relaxed CH equation for \(\forall t \in (0,1)\) can be written as:
</p>
\begin{equation}
 \frac{d}{dt} E_{rel}(\phi^{\alpha} , c^\alpha) :=
\frac{d}{dt} \int_{\Omega}  \frac{1}{2}\varepsilon^2 \alpha (c^\alpha - \phi^{\alpha})^2 + W(x) \ d \operatorname{\mathbf{x}}
\end{equation}
<p>
Which is derrived by a \(L_2\) inner product of <a href="eqref:eq:relaxed-cahn-hilliard">eqref:eq:relaxed-cahn-hilliard</a> with \(\mu^\alpha\).
</p>
\begin{equation}
\left< \phi_t^{\alpha} , \mu^{\alpha} \right> = \left< \Delta \mu^{\alpha} , \mu^{\alpha} \right>
\end{equation}
<p>
it then follows for the left hand side:
</p>
\begin{equation}
\begin{aligned}
\left< \phi^{\alpha}_t , \mu^{\alpha} \right> &= \left< \phi^{\alpha}_t , -  \varepsilon^2 \alpha (c^\alpha- \phi^{\alpha}) +  W'(\phi^{\alpha}) \right> \\
&= \int_{\Omega} -  \phi^{\alpha}_t \varepsilon^2 \alpha (c^\alpha - \phi^{\alpha})\ d \operatorname{\mathbf{x}} + \int_{\Omega} \phi^{\alpha}_t W'(\phi^{\alpha}) \ d \operatorname{\mathbf{x}} \\
&= \frac{d}{dt}  \int_{\Omega} \frac{1}{2}\varepsilon^2 \alpha (c^\alpha - \phi^{\alpha})^2\ d \operatorname{\mathbf{x}} + \frac{d}{dt} \int_{\Omega} W'(\phi^{\alpha}) \ d \operatorname{\mathbf{x}} \\
&= \frac{d}{dt} \int_{\Omega}  \frac{1}{2}\varepsilon^2 \alpha (c^\alpha - \phi^{\alpha})^2 + W(x) \ d \operatorname{\mathbf{x}}
= \frac{d}{dt} E_{rel}(\phi^{\alpha}, c^\alpha)
\end{aligned}
\end{equation}
<p>
and using the boundary condition \( \left( \nabla\mu \cdot \vec{n} \right) = 0 \) on the right hand side:
</p>
\begin{equation}
\begin{aligned}
\left< \Delta \mu^{\alpha} , \mu^{\alpha} \right> &= \int_{\Omega} \mu^{\alpha}\Delta\mu^{\alpha}  d \operatorname{\mathbf{x}} \\
&= - \int_{\Omega} \left|\nabla\mu^{\alpha} \right| d \operatorname{\mathbf{x}} + \int_{\partial\Omega} \mu^{\alpha} ( \nabla\mu^{\alpha} \cdot \vec{n})  d \operatorname{\mathbf{A}} \\
&= - \left\| \nabla \mu^{\alpha} \right\| \leq 0
\end{aligned}
\end{equation}
<p>
it therefore holds for a relaxed energy:
</p>
\begin{equation}
\frac{d}{dt} E_{rel}(\phi^\alpha , c^\alpha) = \frac{d}{dt} \int_{\Omega}  \frac{1}{2}\varepsilon^2 \alpha (c - \phi)^2 + W(x) \ d \operatorname{\mathbf{x}} \leq 0
\end{equation}
<p>
which gives a \(L_2\) bound for \( \Delta c =  \alpha(c-\phi)  \)  and  \(\nabla \mu^\alpha\), similar to the estimate for \( \nabla \mu \) given in the original CH equation.
</p>
</div>
</div>
<div id="outline-container-org4b8832a" class="outline-3">
<h3 id="org4b8832a"><span class="section-number-3">6.3.</span> Relaxed mass conservation</h3>
<div class="outline-text-3" id="text-6-3">
<p>
We use the same aproach as in <a href="eqref:eq:mass-conservation">eqref:eq:mass-conservation</a> to show that the CH equation <a href="eqref:eq:relaxed-cahn-hilliard">eqref:eq:relaxed-cahn-hilliard</a> is mass conservative.
</p>
\begin{equation}
\int_{\Omega}\partial_t \phi^{\alpha} \ d \operatorname{\mathbf{x}} = \int_{\Omega} \Delta \mu^{\alpha} \ d \operatorname{\mathbf{x}} = \int_{\partial\Omega} \nabla\mu^{\alpha} \cdot n \ d \operatorname{\mathbf{x}} =  0 \qquad \forall t\in (0,T)
\end{equation}
</div>
</div>
</div>
<div id="outline-container-orgcf7126c" class="outline-2">
<h2 id="orgcf7126c"><span class="section-number-2">7.</span> Discretization of the relaxed problem</h2>
<div class="outline-text-2" id="text-7">
<p>
As approach for the numerical solver for the CH equation we propose:
</p>
\begin{equation}
\label{org9520de4}
\begin{aligned}
\frac{\phi_{ij}^{n+1,\alpha} - \phi_{ij}^{n,\alpha}}{\Delta t}  &=  \nabla _d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2},\alpha} )  \,,\\
 \mu_{ij}^{n+\frac{1}{2},\alpha} &= 2\phi_{ij}^{n+1,\alpha} - \varepsilon^2 a(c_{ij}^{n+1,\alpha} - \phi_{ij}^{n+1,\alpha})  + W'(\phi_{ij}^{n,\alpha}) - 2\phi _{ij}^{n,\alpha} \,. & i,j &\in \{2, \dots , N+1\}
\end{aligned}
\end{equation}
<p>
This approach is inspired by <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> and adapted to the relaxed CH equation <a href="eqref:eq:discrete-relaxed-cahn-hilliard">eqref:eq:discrete-relaxed-cahn-hilliard</a>.
We then apply the multi-grid method proposed in <a href="#orgfc468b0">4.2</a> to the relaxed problem by replacing the differential operators with their discrete counterparts, as defined in <a href="eqref:eq:discretization">eqref:eq:discretization</a>,
and expand them.
To solve the additional elliptical system, we propose a simple implicit finite difference scheme similar to what we use for the baseline solver.
</p>
\begin{align*}
- \nabla_d \cdot  (G_{ij} \nabla_d c_{ij}^{n+1,\alpha}) + \alpha  c_{ij}^{n+1,\alpha} &= \alpha \phi_{ij}^{n+1,\alpha} \,, & i,j &\in \{2, \dots , N+1\}
\end{align*}
</div>
<div id="outline-container-orgb275d32" class="outline-3">
<h3 id="orgb275d32"><span class="section-number-3">7.1.</span> Elliptical PDE</h3>
<div class="outline-text-3" id="text-7-1">
<p>
We then use the finite differences defined in <a href="eqref:eq:discretization">eqref:eq:discretization</a> to derive the corresponding linear system.
</p>
\begin{align*}
- \frac{1}{h^2} ( G_{i+\frac{1}{2}j}(c_{i+1j}^{n+1,\alpha} - c_{ij}^{n+1,\alpha}) & \\
+G_{ij+\frac{1}{2}}(c_{ij+1}^{n+1,\alpha} - c_{ij}^{n+1,\alpha}) & \\
+G_{i-\frac{1}{2}j}(c_{i-1j}^{n+1,\alpha} - c_{ij}^{n+1,\alpha})& \\
+G_{ij-\frac{1}{2}}(c_{ij-1}^{n+1,\alpha} - c_{ij}^{n+1,\alpha})) + \alpha  c_{ij}^{n+1\alpha} &=\alpha  \phi_{ij}^{n+1,\alpha} \,, & i,j \in \{2, \dots , N+1\}
\end{align*}

<p>
We abbreviate \(  \Sigma_G c^{n+1,\alpha}_{ij} = G_{i+\frac{1}{2}j} c^{n+1,\alpha}_{i+1j} +  G_{i-\frac{1}{2}j} c^{n+1,\alpha}_{i-1j} + G_{ij+\frac{1}{2}}  c^{n+1,\alpha}_{ij+1} + G_{ij-\frac{1}{2}} c^{n+1,\alpha}_{ij-1}  \) and \(  \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \). Then the discrete elliptical PDE can be stated as:
</p>
\begin{align}
\label{org9bf7745}
-\frac{ \Sigma_G c^{n+1,\alpha}_{ij}}{h^2} + \frac{\Sigma_G}{h^2} c^{n+1,\alpha}_{ij} + \alpha c^{n+1,\alpha}_{ij} &= \alpha\phi^{n+1,\alpha}_{ij} \,. & i,j&\in \{2, \dots , N+1\} , \alpha \in \RR^{+}
\end{align}
<p>
this constitutes a linear system with \( N\times N \) equations
</p>
</div>
</div>
<div id="outline-container-org5962109" class="outline-3">
<h3 id="org5962109"><span class="section-number-3">7.2.</span> Gauss Seidel solver for the elliptical system</h3>
<div class="outline-text-3" id="text-7-2">
<p>
To solve the elliptical system we introduce a Gauss-Seidel solver similar to the Gauss-Seidel Solver used for the smoothing step in the two-grid method.
We define this iteration in terms of \( s \),
For the Gauss-Seidel Iterative solver, we define the abbreviations
 \[  \Sigma_G c^{n+1,\alpha , s+\frac{1}{2}}_{ij} = G_{i+\frac{1}{2}j} c^{n+1,\alpha,s}_{i+1j} +  G_{i-\frac{1}{2}j} c^{n+1,\alpha,s+1}_{i-1j} + G_{ij+\frac{1}{2}}  c^{n+1,\alpha, s}_{ij+1} + G_{ij-\frac{1}{2}} c^{n+1,\alpha ,s+1}_{ij-1}  \]
We then define the Gaus-Seidel iteration by the following, and solve algebraically for \( c_{ij}^{n+1,\alpha,s+1} \)
</p>
\begin{align*}
\left( \frac{\Sigma_{Gij}}{h^2} + \alpha \right)c_{ij}^{n+1,\alpha,s+1} = \alpha\phi^{n+1,\alpha}_{ij} + \frac{\Sigma_G c_{ij}^{n+1,\alpha,s+\frac{1}{2}}}{h^2}\\
c_{ij}^{n+1,\alpha,s+1} = \frac{\alpha\phi^{n+1,\alpha}_{ij} + \frac{\Sigma_G c_{ij}^{n+1,\alpha, s+\frac{1}{2}}}{h^2}}{\frac{\Sigma_{G}}{h^2} + \alpha}\\
c_{ij}^{n+1,\alpha, s+1} = \frac{\alpha h^2 \phi^{n+1,\alpha}_{ij}}{\Sigma_{Gij} + \alpha h^2} + \frac{\Sigma_G c_{ij}^{n+1,\alpha , s+\frac{1}{2}}}{\Sigma_{Gij} + \alpha h^{2}}
\end{align*}
<p>
We the Gaus-Seidel solver for <b>1000</b> iterations to ensure convergence.
Furthermore we denote the solution of the iterative solver with \( c_{ij}^{n+1,\alpha} \). We implement the corresponding iteration as follows:
</p>
<div class="org-src-container">
<pre class="src src-julia" id="orgfdb3131"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">n</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span>  <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">n</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
            <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #83a598;">bordernumber</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span>
                    <span style="color: #ebdbb2; background-color: #282828;">(</span>
                        <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">+</span>
                        <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
                    <span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">bordernumber</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

            <span style="color: #fb4934;">end</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org603d9d9" class="outline-3">
<h3 id="org603d9d9"><span class="section-number-3">7.3.</span> Relaxed system</h3>
<div class="outline-text-3" id="text-7-3">
<p>
We use the same discretization approach, as for the baseline system.
We reformulate the discretization <a href="eqref:eq:discrete-relaxed-cahn-hilliard">eqref:eq:discrete-relaxed-cahn-hilliard</a> in terms of the relaxed function \(L_r\) as follows:
</p>
\begin{align*}
L_r
\begin{pmatrix}
\phi ^{n+1,\alpha}_{ij} \\
\mu^{n+\frac{1}{2},\alpha}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi^{n+1,m,\alpha}_{ij}}{\Delta t} - \nabla _d \cdot (G_{ji} \nabla _d \mu^{n + \frac{1}{2},m,\alpha}_{ji}) \\
\varepsilon ^2 \alpha (c^\alpha_{ij} - \phi^{n+1,m,\alpha}_{ij}) - 2\phi ^{n+1,m,\alpha}_{ij} -\mu^{n + \frac{1}{2},m,\alpha}_{ji}
\end{pmatrix}
& \forall i,j &\in\{2, \dots , N+1\}
\end{align*}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">phi</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">mu</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">xi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span>
         <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
          <span style="color: #fabd2f;">-</span>
          <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">mu</span> <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #83a598;">psi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #fabd2f;">*</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">phi</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
and its Jacobian:
</p>
\begin{align*}
DL_r\begin{pmatrix}
\phi^{n+1,\alpha, m}_{ij} \\
\mu^{n+\frac{1}{2},m,\alpha}_{ij}
\end{pmatrix} &= \begin{pmatrix}
\frac{1}{\Delta t} & \frac{1}{h^2}\Sigma_{G}  \\
- \varepsilon^2 \alpha  - 2 & 1
\end{pmatrix}
& \forall i,j &\in\{2, \dots , N+1\}
\end{align*}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">*</span><span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">;</span>
             <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span>  <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
Much like the original solver, where in <a href="eqref:eq:explicit-smooth">eqref:eq:explicit-smooth</a> we wrote the initial approach as a LES, we write the LES for the relaxed system as
</p>
\begin{align}
L_r
\begin{pmatrix}
\phi ^{n+1,\alpha}_{ij} \\
\mu^{n+\frac{1}{2},\alpha}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\zeta^n_{ij}
 \\
\psi^n_{ij}
\end{pmatrix},
& \forall i,j &\in\{2, \dots , N+1\}
\end{align}
<p>
where \( \left( \zeta_{ij}^n  , \psi_{ij}^n \right) \) are the same in the original and relaxed solvers.
Since the relaxed CH equation is no longer second order in both directions the resulting LES is simpler. To take advantage of this, we resolve the system algebraically for each grid-point \( \left( i.j \right) \in \{2, \dots , N+1\} \).
</p>
\begin{align}
\label{org323ab69}
  -\frac{\Sigma_{Gij}}{h^2}\mu^{n + \frac{1}{2},m,\alpha}_{ji} &= \frac{\phi ^{n+1,m,\alpha}_{ij}}{\Delta t} - \zeta^{n,\alpha}_{ij} - \frac{\Sigma_G\mu_{ij}}{h^2} \,,\\
\label{discrete-relaxed-smooth2}
 \varepsilon ^2 \alpha \phi ^{n+1,m,\alpha}_{ij} + 2 \phi ^{n+1,m,\alpha}_{ij} &= \varepsilon ^2 \alpha c^{n,\alpha}_{ij}  -\mu^{n + \frac{1}{2},m,\alpha}_{ji}  - \psi_{ij}^{n,\alpha} \,,
\end{align}
<p>
where
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \mu_{ij} = G_{i+\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i+1j} +  G_{i-\frac{1}{2}j} \mu^{n + \frac{1}{2},m}_{i-1j} + G_{ij+\frac{1}{2}}  \mu^{n + \frac{1}{2},m}_{ij+1} + G_{ij-\frac{1}{2}} \mu^{n + \frac{1}{2},m}_{ij-1}  \),</li>
</ul>
<p>
We simplify <a href="eqref:eq:discrete-relaxed-smooth">eqref:eq:discrete-relaxed-smooth</a> by substituting \( \mu_{ij}^{n+1,\alpha} \) from the first line into the second.
</p>
\begin{align*}
\varepsilon^2 \alpha(\phi_{ij}^{n+1,m,\alpha}) + 2\phi_{ij}^{n+1,m,\alpha} &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G} (\frac{\phi_{ij}^{n+1,m,\alpha}}{\Delta t} - \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij}) - \psi_{ij}
\end{align*}
<p>
We solve this system for \( \phi_{ij}^{n+1,m,\alpha} \). This results in the following system
</p>
\begin{equation}
\label{org57280ea}
\begin{aligned}
 \phi_{ij}^{n+1,m,\alpha} &= \left(\varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G}(- \zeta^n_{ij} - \frac{\Sigma_G \mu_{ij}}{h^2} ) -\psi_{ij}\right)\left(\varepsilon^2 \alpha + 2 + \frac{h^2}{\Sigma_G \Delta t}\right)^{-1} \\
\mu_{ij}^{n+\frac{1}{2} ,m , \alpha} &= \frac{h^2}{\Sigma_G} (\frac{\phi_{ij}^{n+1,m,\alpha}}{\Delta t} - \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij})
& \forall i,j &\in\{2, \dots , N+1\}
\end{aligned}
\end{equation}
</div>
</div>
<div id="outline-container-org392054a" class="outline-3">
<h3 id="org392054a"><span class="section-number-3">7.4.</span> Relaxed Gauss-Seidel iteration</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Similar to <a href="eqref:eq:gauss-seidel">eqref:eq:gauss-seidel</a>, we derive a Gauss-Seidel iteration for the relaxed problem from <a href="eqref:eq:relaxed-les">eqref:eq:relaxed-les</a>.
</p>
\begin{equation}
\begin{aligned}
 \phi_{ij}^{n+1,\alpha,s+1} &= \left(\varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G}(- \zeta^n_{ij} - \frac{\Sigma_G \mu_{ij}^{n+\frac{1}{2},\alpha,s+\frac{1}{2}}}{h^2} ) -\psi_{ij}^n\right)\left(\varepsilon^2 \alpha + 2 + \frac{h^2}{\Sigma_G \Delta t}\right)^{-1} \\
\mu_{ij}^{n+\frac{1}{2} , \alpha , s+1} &= \frac{h^2}{\Sigma_G} (\frac{\phi_{ij}^{n+1,\alpha , s+1}}{\Delta t} - \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij}^{n+\frac{1}{2},\alpha,s+\frac{1}{2}})
\end{aligned}
\end{equation}
<p>
where
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \mu_{ij}^{n+\frac{1}{2},\alpha,s+\frac{1}{2}} = G_{i+\frac{1}{2}j} \mu^{n + \frac{1}{2},s}_{i+1j} +  G_{i-\frac{1}{2}j} \mu^{n + \frac{1}{2},s+1}_{i-1j} + G_{ij+\frac{1}{2}}  \mu^{n + \frac{1}{2},s}_{ij+1} + G_{ij-\frac{1}{2}} \mu^{n + \frac{1}{2},s+1}_{ij-1}  \),</li>
</ul>
<p>
Contrary to the Gauss Seidel iteration in the baseline solver, this iteration is a significantly cheaper to calculate, since it no longer requires solving a 2x2 LES for each grid-point.
We implement the iteration as:
</p>
<div class="org-src-container">
<pre class="src src-julia" id="org4ebc378"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">iterations</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">adaptive</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">iterations</span>
        <span style="color: #928374;"># old_phase = copy(solver.phase)</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
            <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">solve</span><span style="color: #fabd2f;">-</span>for<span style="color: #fabd2f;">-</span><span style="color: #83a598;">phi</span><span style="color: #fabd2f;">&gt;&gt;</span>
            <span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">update</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">potential</span><span style="color: #fabd2f;">&gt;&gt;</span>
        <span style="color: #fb4934;">end</span>

        <span style="color: #928374;">#if adaptive &amp;&amp; LinearAlgebra.norm(old_phase - solver.phase) &lt; 1e-10</span>
            <span style="color: #928374;">##println("SMOOTH terminated at $(k) succesfully")</span>
            <span style="color: #928374;">#break</span>
        <span style="color: #928374;">#end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgab9d306" class="outline-3">
<h3 id="orgab9d306"><span class="section-number-3">7.5.</span> The relaxed two-grid method</h3>
<div class="outline-text-3" id="text-7-5">
<p>
As the difference between both methods is abstracted away in the operators, the relaxed V-cycle the replaces the original operators with their relaxed counterparts. Due to julias multiple dispatch feature this changes nothing in the implementation Therefore we reuse the original V-cycle in the <a href="#orgfc468b0">4.2</a>.
In the executions for each time step, we add the elliptic solver in the sub-iteration. The iterative solver is then defined as:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">timesteps</span>

    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>

    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">subiterations</span>

        <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solvers</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5c7f2ab" class="outline-2">
<h2 id="org5c7f2ab"><span class="section-number-2">8.</span> Discrete mass conservation</h2>
<div class="outline-text-2" id="text-8">
<p>
Since both the CH equation <a href="eqref:eq:CH">eqref:eq:CH</a> and the baseline solver from Fig.<a href="#org9582daf">7</a> are mass conservative, the relaxed solver should be as well.
Mass conservation for the CH equation is given as
</p>
\begin{equation}
\int_{\Omega} \partial_t\phi = 0
\end{equation}
<p>
We show a discrete analogue for both the baseline and the relaxed approach
</p>
\begin{equation}
\sum_{i,j \in \Omega_d} \frac{1}{\Delta t} (\phi_{ij}^{n+1} - \phi_{ij}^{n}) = 0.
\end{equation}
<p>
We show this for a square domain \( \Omega_d \) using the first line of  <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a> and <a href="eqref:eq:discrete-relaxed-cahn-hilliard">eqref:eq:discrete-relaxed-cahn-hilliard</a> respectively.
</p>
\begin{equation}
\begin{aligned}
\sum_{i=2}^{N+1} \sum_{j=2}^{N+1} \frac{1}{\Delta t} \left( \phi_{ij}^{n+1} - \phi_{ij}^{n} \right) &= \sum_{i=2}^{N+1}\sum_{j=2}^{N+1} \nabla_d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2}}) \\
\end{aligned}
\end{equation}
<p>
We split the right double sum into three parts. We consider them separately. The first part consists of the inner sum, where \( G_{i+\frac{1}{2}j} = G_{i+\frac{1}{2}j} = G_{ij+\frac{1}{2}} = G_{ij-\frac{1}{2}} = 0 \). The inner sum can therefore be written as such:
</p>
\begin{equation}
\begin{aligned}
&= \sum_{i=3}^{N}\sum_{j=3}^{N} \frac{1}{h^2} \left( \mu^{n+\frac{1}{2}}_{i+1j} + \mu^{n+\frac{1}{2}}_{i-1j} + \mu^{n+\frac{1}{2}}_{ij+1} + \mu^{n+\frac{1}{2}}_{ij-1} - 4 \mu^{n+\frac{1}{2}}_{ij} \right) \\
\end{aligned}
\end{equation}
<p>
The second part consists of the sums over the edges excluding the corners.
</p>
\begin{equation}
\begin{aligned}
&+ \sum_{i=3}^{N} \frac{\Sigma_G\mu_{i2}^{n+\frac{1}{2}} - \Sigma_{Gi2}\cdot \mu_{i2}^{n+\frac{1}{2}}}{h^2} \\
&+ \sum_{i=3}^{N} \frac{\Sigma_G\mu_{iN+1}^{n+\frac{1}{2}} - \Sigma_{GiN+1}\cdot \mu_{iN+1}^{n+\frac{1}{2}}}{h^2} \\
&+ \sum_{j=3}^{N} \frac{\Sigma_G\mu_{i2}^{n+\frac{1}{2}} - \Sigma_{Gi2}\cdot \mu_{i2}^{n+\frac{1}{2}}}{h^2} \\
&+ \sum_{j=3}^{N} \frac{\Sigma_G\mu_{N+1j}^{n+\frac{1}{2}} - \Sigma_{GN+1j}\cdot \mu_{N+1j}^{n+\frac{1}{2}}}{h^2}\\
\end{aligned}
\end{equation}
<p>
And the third part consists of the corners.
</p>
\begin{equation}
\begin{aligned}
&+ \frac{\Sigma_G\mu_{N+1N+1}^{n+\frac{1}{2}} - \Sigma_{GN+1,N+1}\cdot \mu_{N+1,N+1}^{n+\frac{1}{2}}}{h^2}\\
&+  \frac{\Sigma_G\mu_{N+1,2}^{n+\frac{1}{2}} - \Sigma_{GN+1,2}\cdot \mu_{N+1,2}^{n+\frac{1}{2}}}{h^2}\\
&+  \frac{\Sigma_G\mu_{2,N+1}^{n+\frac{1}{2}} - \Sigma_{G2,N+1}\cdot \mu_{2,N+1}^{n+\frac{1}{2}}}{h^2}\\
&+  \frac{\Sigma_G\mu_{2,2}^{n+\frac{1}{2}} - \Sigma_{G 2,2}\cdot \mu_{2,2}^{n+\frac{1}{2}}}{h^2}
\end{aligned}
\end{equation}
<p>
The first double sum is a telescopic sum, and contracts to the following:
</p>
\begin{equation}
\begin{aligned}
\sum_{i=3}^{N}\sum_{j=3}^{N} \frac{1}{h^2} \left( \mu^{n+\frac{1}{2}}_{i+1j} + \mu^{n+\frac{1}{2}}_{i-1j} + \mu^{n+\frac{1}{2}}_{ij+1} + \mu^{n+\frac{1}{2}}_{ij-1} - 4 \mu^{n+\frac{1}{2}}_{ij} \right) &=
 \sum_{i=3}^{N} \mu_{i2}^{n+\frac{1}{2}} - \mu_{i3}^{n+\frac{1}{2}}\\
& + \sum_{i=3}^{N} \mu_{iN+1}^{n+\frac{1}{2}} - \mu_{iN}^{n+\frac{1}{2}}\\
& + \sum_{j=3}^{N} \mu_{2j}^{n+\frac{1}{2}} - \mu_{3j}^{n+\frac{1}{2}}\\
& + \sum_{j=3}^{N} \mu_{N+1j}^{n+\frac{1}{2}} - \mu_{Nj}^{n+\frac{1}{2}}
\end{aligned}
\end{equation}
<p>
Additionally, we simplify each of the sums in the second part, since the values of \( G \) are known on the boundary. On the right boundary ,for \( 2 < i < N+1 \),  \( G_{iN+\frac{3}{2}} = 0 \) and \( G_{iN+\frac{1}{2}}  = G_{i+\frac{1}{2}N+1}= 1 \)  it therefore follows:
</p>
\begin{equation}
\begin{aligned}
\sum_{i=3}^{N} \frac{\Sigma_G\mu_{iN+1}^{n+\frac{1}{2}} - \Sigma_{GiN+1}\cdot \mu_{iN+1}^{n+\frac{1}{2}}}{h^2} &=
\frac{1}{h^2}\sum_{i=3}^{N} G_{i+\frac{1}{2}N+1} \mu^{n + \frac{1}{2}}_{i+1N+1} +  G_{i-\frac{1}{2}N+1} \mu^{n + \frac{1}{2}}_{i-1N+1} \\
& \qquad+ G_{iN+\frac{3}{2}}  \mu^{n + \frac{1}{2}}_{iN+2} + G_{iN-\frac{3}{2}} \mu^{n + \frac{1}{2}}_{iN} \\
&\qquad- (G_{iN+\frac{3}{2}}+G_{iN+\frac{1}{2}}+G_{i+\frac{1}{2}N+1}+G_{i-\frac{1}{2}N+1}) \mu^{n+\frac{1}{2}}_{iN+1} \\
&= \frac{1}{h^2} \sum_{i=3}^{N} \mu^{n+\frac{1}{2}}_{i+1N+1} +  \mu^{n+\frac{1}{2}}_{i-1N+1} + \mu^{n+\frac{1}{2}}_{iN} - 3\mu^{n+\frac{1}{2}}_{iN+1}
\end{aligned}
\end{equation}
<p>
this sum, as it it is telescopic simplify further to
</p>
\begin{equation}
\begin{aligned}
\sum_{i=3}^{N} \frac{\Sigma_G\mu_{iN+1}^{n+\frac{1}{2}} - \Sigma_{GiN+1}\cdot \mu_{iN+1}^{n+\frac{1}{2}}}{h^2} &=  (\mu_{NN+1}+\mu_{3N+1})-(\mu_{N+1N+1}+\mu_{2N+1}) \\
&-  \sum_{i=3}^{N} \mu^{n+\frac{1}{2}}_{i1N} - \mu^{n+\frac{1}{2}}_{iN+1}
\end{aligned}
\end{equation}
<p>
similar the other three sums on the boundary simplify to
</p>
\begin{equation}
\begin{aligned}
\sum_{i=3}^{N} \frac{\Sigma_G\mu_{i2}^{n+\frac{1}{2}} - \Sigma_{Gi2}\cdot \mu_{i2}^{n+\frac{1}{2}}}{h^2} &= (\mu_{N,2}+\mu_{3,2}) - (\mu_{N+1,2}+\mu_{2,2}) - \sum_{i=3}^{N} \mu^{n+\frac{1}{2}}_{i1N} - \mu^{n+\frac{1}{2}}_{iN+1}  \\
\sum_{j=3}^{N} \frac{\Sigma_G \mu_{2j}^{n+\frac{1}{2},\alpha} - \Sigma_{G2j}\cdot \mu_{2j}^{n+\frac{1}{2}}}{h^2} &= (\mu_{2,3}+\mu_{2,N}) - (\mu_{2,N+1}+ \mu_{2,2}) - \sum_{j=3}^{N} \mu^{n+\frac{1}{2}}_{2j} - \mu^{n+\frac{1}{2}}_{3j} \\
\sum_{j=3}^{N} \frac{\Sigma_G\mu_{N+1j}^{n+\frac{1}{2}} - \Sigma_{GN+1j}\cdot \mu_{N+1j}^{n+\frac{1}{2}}}{h^2} &= (\mu_{N+1,N}+\mu_{N+1,3}) - (\mu_{N+1,N+1}+\mu_{N+1,2}) -  \sum_{j=3}^{N} \mu^{n+\frac{1}{2}}_{N+1,j} - \mu^{n+\frac{1}{2}}_{N,j}
\end{aligned}
\end{equation}
<p>
we observe that the resulting sums are equal and oposite to the result from the first sum. They therefore cancel each other and we are left with the corner therms. Those therms sum up to
</p>
\begin{equation}
\mu_{N+1,N}+\mu_{N+1,3} - 2\mu_{N+1,N+1} ++\mu_{2,3}+\mu_{2,N} - 2\mu_{2,2} + \mu_{N,2}+\mu_{N+1,3} - 2\mu_{2,N+1} + \mu_{N,N+1}+\mu_{3,N+1} - 2\mu_{N+1,2}
\end{equation}
<p>
The third sum, on the corners, can be simplified the same way as the other two
</p>
\begin{equation}
\begin{aligned}
\frac{\Sigma_G\mu_{N+1N+1}^{n+\frac{1}{2}} - \Sigma_{GN+1,N+1}\cdot \mu_{N+1,N+1}^{n+\frac{1}{2}}}{h^2} &= \frac{1}{h^2} (\mu^{n+\frac{1}{2}}_{NN+1} + \mu^{n+\frac{1}{2}}_{N+1N} - 2 \mu^{n+\frac{1}{2}}_{N+1N})\\
\frac{\Sigma_G\mu_{2,2}^{n+\frac{1}{2}} - \Sigma_{G2,2}\cdot \mu_{2,2}^{n+\frac{1}{2}}}{h^2} &= \frac{1}{h^2} (\mu^{n+\frac{1}{2}}_{3,2} + \mu^{n+\frac{1}{2}}_{2,3} - 2 \mu^{n+\frac{1}{2}}_{2,2})\\
\frac{\Sigma_G\mu_{2N+1}^{n+\frac{1}{2}} - \Sigma_{G2,N+1}\cdot \mu_{2,N+1}^{n+\frac{1}{2}}}{h^2} &= \frac{1}{h^2} (\mu^{n+\frac{1}{2}}_{3N+1} + \mu^{n+\frac{1}{2}}_{2N} - 2 \mu^{n+\frac{1}{2}}_{2N+1})\\
\frac{\Sigma_G\mu_{N+1,2}^{n+\frac{1}{2}} - \Sigma_{GN+1,2}\cdot \mu_{N+1,2}^{n+\frac{1}{2}}}{h^2} &= \frac{1}{h^2} (\mu^{n+\frac{1}{2}}_{N+1,3} + \mu^{n+\frac{1}{2}}_{N,2} - 2 \mu^{n+\frac{1}{2}}_{N+1,2})
\end{aligned}
\end{equation}
<p>
Those terms cancel out with what remains in the second sum. We therefore conclude
</p>
\begin{equation}
\sum_{i=2}^{N+1} \sum_{j=2}^{N+1} \frac{1}{\Delta t} \left( \phi_{ij}^{n+1} - \phi_{ij}^{n}\right) = 0
\end{equation}
<p>
Which gives a discrete equivalent to the mass conservation shown in the analytical equations.
</p>
</div>
</div>
<div id="outline-container-org01022bb" class="outline-2">
<h2 id="org01022bb"><span class="section-number-2">9.</span> Numerical experiments for the relaxed system</h2>
<div class="outline-text-2" id="text-9">
<p>
We expect the relaxed solver to behave the same as the baseline method for all test cases that we have introduced in Chapter <a href="#org13c5b27">5</a>. Therefore we run the same experiments for our relaxed solver. If not mentioned otherwise, we use the following hyper-parameters
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Variable:</td>
<td class="org-left">&epsilon;</td>
<td class="org-left">&Delta; t</td>
<td class="org-left">h</td>
</tr>

<tr>
<td class="org-left">Value:</td>
<td class="org-left">8 * 10<sup>-3</sup></td>
<td class="org-left">10<sup>-3</sup></td>
<td class="org-left">3*10<sup>-3</sup></td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-org2d9ee89" class="outline-3">
<h3 id="org2d9ee89"><span class="section-number-3">9.1.</span> explicit and implicit solution of the elliptical problem</h3>
<div class="outline-text-3" id="text-9-1">
<p>
Initially we experimented with solving the elliptical problem explicitly at the beginning of each time-step. This resulted in inconsistent behavior. We show the extend of this in correlation to \( \alpha \) and \(\varepsilon\) in <a href="#orgcc531c1">10</a> where we run 100 elliptical Gauss-Seidel iterations  followed by 1000 Gauss-Seidel iterations for the relaxed problem. We observe difficulty in developing the diffuse interface of the CH equation.Furthermore, comparing the results for \( \alpha = 10000 , \varepsilon \in \{0.05 , 0.025\} \) with the result of the original solver for \( \varepsilon=0.01 \) might suggest to use a lower value of \( \varepsilon \) to mitigate this. However this resulted in unpredictable interface with in further time steps.
</p>


<div id="orgcc531c1" class="figure">
<p><img src="images/explicit-elips-smooth.svg" alt="explicit-elips-smooth.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 10: </span>Effect of the relaxed SMOOTH operator for different values of \(\alpha\) and \(\varepsilon\)</p>
</div>

<p>
Since explicit solving  <a href="eqref:eq:discrete_elyps">eqref:eq:discrete_elyps</a> at the beginning of a time-step did not yield a predictable solver we experiment with solving <a href="eqref:eq:discrete_elyps">eqref:eq:discrete_elyps</a> and <a href="eqref:eq:discrete-relaxed-smooth">eqref:eq:discrete-relaxed-smooth</a> in an alternating manner. For <a href="ref:fig:alternating-elips-smooth">ref:fig:alternating-elips-smooth</a> we run 100 elliptical then 100 relaxed iterations and repeat both 10 times. For this experiment we observe the relaxed solver to be significantly better in developing the same interface as the baseline solver for a fixed value of \( \varepsilon \).
</p>


<div id="org8339aab" class="figure">
<p><img src="images/alternating-elips-smooth.svg" alt="alternating-elips-smooth.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 11: </span>Effect of the relaxed SMOOTH operator, and additional solving of the elliptical problem, for different values of \(\alpha\) and \(\varepsilon\)</p>
</div>

<p>
The experimentation shows that  \( \alpha \) has an effect similar to \( \varepsilon \), where it changes the boundary thickness in the phase-field \( \phi \). Therefore \( \varepsilon \) and \( \alpha \) might be correlated. To test this hypothesis we use a simple Monte Carlo optimizer for \( \alpha,\varepsilon \).
</p>
</div>
</div>
<div id="outline-container-org19bac6d" class="outline-3">
<h3 id="org19bac6d"><span class="section-number-3">9.2.</span> optimizer for alpha</h3>
<div class="outline-text-3" id="text-9-2">
<p>
In addition to the experiments in Fig.<a href="#org8c866e4">12</a> we have experimented with a Monte Carlo Optimizer to optimize \( \alpha \) in conjunction with \( \varepsilon \), to best approximate the baseline solver after one time-step. This resulted in a optimal \( \varepsilon \) found that was very close to the actual \( \varepsilon \) used. (9e-3 compared to 8e-3). This gives us confidence that the relaxed method solves the same problem, as the baseline. Optimal values for \( \alpha \) varied , however stayed fairly large around \( 10^5 \to 10^{6} \).
</p>

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Distributions</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">DataFrames</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/solvers.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/adapted_solvers.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/utils.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/multisolver.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/multi_relaxed.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/testgrids.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">include</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">pwd</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #fabd2f;">*</span> <span style="color: #b8bb26;">"/src/elypssolver.jl"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">Plots</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">LaTeXStrings</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">LinearAlgebra</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">Printf</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">ProgressBars</span>
<span style="color: #83a598; font-weight: bold;">default</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">fontfamily</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"computer modern"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">titlefontsize</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">32</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">guidefontsize</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">22</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">tickfontsize</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">22</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">legendfontsize</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">22</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">pgfplotsx</span><span style="color: #ebdbb2; background-color: #282828;">()</span>
<span style="color: #83a598;">layout2x2</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">grid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">layout3x1</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">layout</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #83a598;">b</span>  <span style="color: #83a598;">c</span> <span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">a</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">size3x1</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1600</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1600</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">SIZE</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">64</span>
<span style="color: #83a598;">M</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testdata</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">SIZE</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">SIZE</span> &#247; <span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">SIZE</span> <span style="color: #fabd2f;">/</span><span style="color: #d3869b;">5</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>


<span style="color: #fb4934;">function</span> <span style="color: #83a598;">test_values</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha_distribution</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon_distribution</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">alpha</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha_distribution</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">eps</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">max</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">epsilon_distribution</span><span style="color: #ebdbb2; background-color: #282828;">)</span>  <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1e-10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">relaxed_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testgrid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">eps</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #928374;">#SMOOTH!(relaxed_solver[1], 100, false)</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">64</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">alt_v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
    <span style="color: #83a598;">error</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">original_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #fb4934;">*</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #ebdbb2; background-color: #282828;">;</span><span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">alpha</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">eps</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">error</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">error</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>

<span style="color: #83a598;">original_solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testgrid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">64</span>
<span style="color: #83a598; font-weight: bold;">alt_v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #928374;">#SMOOTH!(original_solver[1], 100, false);</span>
<span style="color: #83a598;">eps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">3e-3</span>
<span style="color: #928374;">#M = testdata(64, div(64,3), 64/5 , 2)</span>
<span style="color: #83a598;">alpha0</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10000</span>
<span style="color: #83a598;">epsilon0</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1e-2</span>
<span style="color: #83a598;">best_alpha</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">alpha0</span> <span style="color: #fabd2f;">/</span> <span style="color: #d3869b;">10</span>
<span style="color: #83a598;">best_epsilon</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">epsilon0</span> <span style="color: #fabd2f;">/</span> <span style="color: #d3869b;">10</span>
<span style="color: #83a598;">best_error</span>  <span style="color: #fb4934;">=</span> <span style="color: #83a598;">Inf</span>
<span style="color: #83a598;">results</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">DataFrame</span><span style="color: #ebdbb2; background-color: #282828;">()</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">n</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">1000</span>
    <span style="color: #83a598;">searchradius</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span>
    <span style="color: #83a598;">alpha_distribution</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">Normal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">best_alpha</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">searchradius</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">alpha0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">epsilon_distribution</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">Normal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">best_epsilon</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">searchradius</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">epsilon0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">result</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">test_values</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha_distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">epsilon_distribution</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">if</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">error</span> <span style="color: #fabd2f;">&lt;</span> <span style="color: #83a598;">best_error</span>
        <span style="color: #83a598;">global</span> <span style="color: #83a598;">best_error</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">error</span>
        <span style="color: #83a598;">global</span> <span style="color: #83a598;">best_alpha</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span>
        <span style="color: #83a598;">global</span> <span style="color: #83a598;">best_epsilon</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span>
        <span style="color: #83a598; font-weight: bold;">println</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">push!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">result</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">jldsave</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"experiments/alpha-epsilon.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">result</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">println</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"Best alpha: $best_alpha , Best epsilon: $best_epsilon"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdf485be" class="outline-3">
<h3 id="orgdf485be"><span class="section-number-3">9.3.</span> effect of \( \alpha  \) on the Gauss-Seidel iteration</h3>
<div class="outline-text-3" id="text-9-3">
<p>
To see the impact of \( \alpha \) on our solver, we evaluate both solvers after one time-step , and then calculate the difference between \( \phi_{ij}^{n+1} \) and \( \phi_{ij}^{n+1,\alpha} \), for various values of \( \alpha \).
Since the solution of the relaxed solver should approach the original solver, we expect
</p>
\begin{equation}
||\phi^{n+1} - \phi^{n+1,\alpha}||_{Fr} \to 0.
\end{equation}
<p>
In Fig.<a href="#org8c866e4">12</a> we observe the following behaviour where in all cases the difference between the relaxed solver and the original solver is apparent. Furthermore we observe a optimal value of \( \alpha \) at approximately \( 7.5 * 10^5 \). We explain this with our observations done for the Smoothing operator, where for small and large values of \( \alpha \) the relaxed solver results in restricted behaviour, which we also expect. On the other hand, for large values of \( \alpha \) the elliptical equation approaches \( \phi \), however it does not converge to \( \phi \) for small values of \( \alpha \).
</p>

<div id="org8c866e4" class="figure">
<p><img src="images/alpha-error.svg" alt="alpha-error.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 12: </span>Difference between the original solver \( \phi^1_{ij} \) and the relaxed solver \( \phi^{1,\alpha}_{ij} \) for different values of  \( \alpha \)</p>
</div>
</div>
</div>
<div id="outline-container-orgceaae5b" class="outline-3">
<h3 id="orgceaae5b"><span class="section-number-3">9.4.</span> Direct comparison of the baseline solver with the relaxed solver</h3>
<div class="outline-text-3" id="text-9-4">
<p>
We then show a comparison of both solvers we plot the phase-fields after 64 time-steps, and the difference \(\|\phi^{n+1} - \phi^{n+1,\alpha}\|_{Fr}\) over the time-steps \( n \in \{0 , \dots , 63 \}\) .
We can observe slight differences between the original solver and the relaxed solver. To quantify those, we run the relaxed solver for a fixed value of \( \alpha=7700 \) , as it is in the interval where \( \alpha \) is minimal in Fig.<a href="#org8c866e4">12</a>. We then  show the numerical difference between \( \phi_{ij}^n \) and \( \phi_{ij}^{n,\alpha} \) in Fig.<a href="#org0ed7d15">13</a>. The observed difference is mainly in areas with high curvature and inclusions of small segments of one phase in the other.
</p>
[[file:images/relaxed-comparison.gif]]



<div id="org0ed7d15" class="figure">
<p><img src="images/relaxed-comparison.svg" alt="relaxed-comparison.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 13: </span>Comparison between the original and the relaxed CH solvers.</p>
</div>
</div>
</div>
<div id="outline-container-orgb6e48c6" class="outline-3">
<h3 id="orgb6e48c6"><span class="section-number-3">9.5.</span> Relaxed energy evaluations</h3>
<div class="outline-text-3" id="text-9-5">
<p>
we do evaluate our relaxed method using the discrete energy defined in <a href="eqref:eq:discrete-energy">eqref:eq:discrete-energy</a>. On the same initial data, and with the same values for \( \varepsilon , h , dt \) as in the Chapter.<a href="#org6c3c4d9">5.1</a>. Since we expect the relaxed approach to solve the same initial value problem  <a href="eqref:eq:initial-value-problem">eqref:eq:initial-value-problem</a>, we expect both solvers to behave the same. In Figure.<a href="#org122c451">14</a> we then observe the energy decay we expected. Our relaxed approach closely follows the baseline, although it consistently decayes slightly faster. Both solvers decay in a simmilar manner and both solvers show a slight bend after a few iterations. However the bend in the relaxed solver is noticeably more pronounced. Additionally, in later iterations the relaxed solver shows faster energy decay than the original. We explain these differences with the observations taken in later experiments, where we observe mass-loss and slower convergence. We suspect the relaxed solver to therefore be more aggressive when minimizing energy.
</p>

<div id="org122c451" class="figure">
<p><img src="images/relaxed-energy-balance.svg" alt="relaxed-energy-balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 14: </span>Energy decay of the relaxed solver compared to the original solver.</p>
</div>
</div>
</div>
<div id="outline-container-org3e732ab" class="outline-3">
<h3 id="org3e732ab"><span class="section-number-3">9.6.</span> Stability of a relaxed multigrid sub-iteration</h3>
<div class="outline-text-3" id="text-9-6">
<p>
We use the same Cauchy criterion we used for the baseline solver.
Furthermore, we compare the subiteration behaviour of the relaxed solver to the original we therefore plot \( \|\phi_{ij}^{n+1,m} - \phi_{ij}^{n+2,m-1} \|_{Fr} \) against \( \| \phi_{ij}^{n+1,m,\alpha} - \phi_{ij}^{n+1,m-1,\alpha} \| \) for \( m \in \{2, \dots , 64\} \). The  sub-iterations in Fig.<a href="#orgd53228b">15</a> are stable. However, the relaxed solver shows significantly slower convergence compared to the baseline solver. Which is why whithout the log log scale employed, the behavior of both solvers would not be visible in the same plot. This behaviour suggests that the relaxed solver does not converge towards the solution of <a href="eqref:eq:relaxed-les">eqref:eq:relaxed-les</a>. Further experiments on mass conservation confirm this suspicion. During further experiments with different initial conditions and number of Gauss-Seidel steps, we where not able to change the slow convergence behaviour.
</p>

<div id="orgd53228b" class="figure">
<p><img src="images/relaxed-convergence.svg" alt="relaxed-convergence.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 15: </span>Cauchy convergence of the basline and relaxed solver, during sub-iteration V-cycles.</p>
</div>
</div>
</div>
<div id="outline-container-org444954e" class="outline-3">
<h3 id="org444954e"><span class="section-number-3">9.7.</span> Relaxed numerical mass balance</h3>
<div class="outline-text-3" id="text-9-7">
<p>
As already mentioned the relaxed solver is not mass conservative.
Our relaxed solver shows significant mass loss as seen in Fig.<a href="#orgbbcb1ac">16</a>, especially when compared to the original solver in Fig.<a href="#org9582daf">7</a>. Both the original approach and the relaxed one exhibit a discrete equivalent of mass conservation, therefore their difference has to be explained by the numerical solver. Which is consistent with the observations made with sub-iteration convergence. We therefore conclude that our relaxed solver does not properly converge. This, most likely, is due to our choice of alternating the solution of \( c \) and \( \phi \). because we intend to solve them both implicitly. Coupling the elliptical and relaxed CH equation might alleviate this, however the resulting system would be of similar complexity to <a href="eqref:eq:LES">eqref:eq:LES</a>, which is what we intend to prevent with the relaxation approach. Alternatively, solving \( c \) explicitly leads to an unstable solver with the initial conditions used by us. We did not test different initial conditions due to a lack of computational resources and time.
</p>

<div id="orgbbcb1ac" class="figure">
<p><img src="images/relaxed-mass-balance.svg" alt="relaxed-mass-balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 16: </span>Mass loss in the relaxed solver</p>
</div>
</div>
</div>
<div id="outline-container-orgfb9b397" class="outline-3">
<h3 id="orgfb9b397"><span class="section-number-3">9.8.</span> Relaxed stability in time</h3>
<div class="outline-text-3" id="text-9-8">
<p>
We test the behaviour under refinement in time by successive subdividing of the original time interval \( [0,T] \) into finer parts. Then, in <a href="ref:fig:relaxed-stability-in-time">ref:fig:relaxed-stability-in-time</a>, we observe the stability of the relaxed solver in time, wich is similar  to the original solver. We compare  \( \| \phi^{n+1,\alpha}_{\Delta t = \frac{10^{-2}}{n+1}} - \phi^{n,\alpha}_{\Delta t = \frac{10^{-2}}{n}} \|_{Fr} \) at \( t=10^{-2} \), for wich the relaxed solver is consistently lower than the original solver. This might suggest a more consistent method over time. More likely however, this is due to the more aggressive energy decay, and non mass conservation.
</p>
</div>
</div>
<div id="outline-container-orgb1f1e86" class="outline-3">
<h3 id="orgb1f1e86"><span class="section-number-3">9.9.</span> additional considerations</h3>
<div class="outline-text-3" id="text-9-9">
<p>
The approach for the relaxed solver was in our tests significantly faster than the baseline implementation. The run-time in practice is highly dependant on the amount of V-cycle iterations, for the baseline and relaxed solver respectively, as well as the number of Gauss-Seidel iterations for the elliptical problem.  When using similar number of V-cycles and sufficiently small number of elliptical iterations, the relaxed solver is several time faster. When we let both solvers iterate until convergence, the relaxed solver still is slightly faster. However, as we will show in our experiments, the relaxed solver has problems with convergence and never converges to the solution of the baseline. Because of this, and due to potential improvements in our implementation, the previous statements are to be taken as a qualitative guide, and not as a quantitative statement, which would require further research.
</p>
</div>
</div>
</div>
<div id="outline-container-org9e25bd2" class="outline-2">
<h2 id="org9e25bd2"><span class="section-number-2">10.</span> Conclusion</h2>
<div class="outline-text-2" id="text-10">
<p>
In this thesis we have presented a simple introduction to the CH equation and have shown two numerical solvers for it.
We have presented a baseline method implemented from the authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>), and have shown how to derive it from their initial approach.
We have done the derivations in a way, that enables a simple adaptation to a modified version of the discrete CH equation <a href="eqref:eq:discrete-cahn-hilliard">eqref:eq:discrete-cahn-hilliard</a>, as introduced in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
We have introduced measures to evaluate the stability of both solvers in regard to time and mass conservation as well as their sub-iteration behaviour.
We have observed the baseline to be mass conservative, in a numerical sense, and we have shown it to be stable in all tested measures.
We have shown our relaxed solver to approach the baseline, during sub-iterations it converges significantly slower than the baseline solver. Additionally it is not mass conservative, unlike the original solver.
We intentionally didn&rsquo;t evaluate run-time since numerical experiments have shown both solvers to be dependant on the amount of sub-iterations, hyperparameters such as \( \varepsilon \) as well as the number off smoothing iterations.
It would therefore be unfair to evaluate one solver on a set of parameters tweaked for the other.
As example for this dilemma we recall runs where the relaxed solver was around 10x faster than the baseline with the same parameters.
The baseline solver was able to run with 10x less smoothing iterations than the relaxed one.
A fair comparison would hence require to find the optimal number of smoothing for each solver.
</p>
</div>
<div id="outline-container-orgc926d98" class="outline-3">
<h3 id="orgc926d98"><span class="section-number-3">10.1.</span> Outlook</h3>
<div class="outline-text-3" id="text-10-1">
<p>
This thesis leaves a lot of room for further research. We have already mentioned runtime evaluations, which require more optimizations, and additional experiments to test the number of smoothing iterations. Here it would be beneficial if both solvers are made adaptive, to ensure fair evaluations.
Furthermore, we initially considered a machine learning approach to replace the elliptical system. We didn&rsquo;t follow this idea mostly due to time constraints, as we had already collected trainings data during our numerical experiments. Our choice of programming language would have been of benefit here, as it would enable more advanced techniques, such as integrating the numerical solver in the trainings loop since julia offers automatic differentiation of arbitrary functions, and therefore enables back-propagation (gradient descent) through the entire solver. Interesting would also have been different discretisations of the relaxed CH equation, and different method for solving it, such as a finite volume or finite element method. Those bring the challenge of beeing harder to compare to our baseline.
</p>
</div>
</div>
</div>
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Shin, Jaemin, Darae Jeong, and Junseok Kim. 2011. â€œA Conservative Numerical Method for the Cahnâ€“Hilliard Equation in Complex Domains.â€ <i>Journal of Computational Physics</i> 230 (19): 7441â€“55. <a href="https://doi.org/https://doi.org/10.1016/j.jcp.2011.06.009">https://doi.org/https://doi.org/10.1016/j.jcp.2011.06.009</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Wu, Hao. 2022. â€œA Review on the Cahnhilliard Equation: Classical Results and Recent Advances in Dynamic Boundary Conditions.â€ <i>Electronic Research Archive</i> 30 (8): 2788â€“2832. <a href="https://doi.org/10.3934/era.2022143">https://doi.org/10.3934/era.2022143</a>.</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
This solver uses a two dimensional version with 2 second order terms instead of the full fourth order  equation.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Jonathan Ulmer</p>
<p class="date">Created: 2024-08-16 Fri 13:07</p>
</div>
</body>
</html>
