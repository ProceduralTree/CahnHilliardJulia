<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-05-15 Wed 11:52 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bachelor Thesis</title>
<meta name="author" content="Jonathan Ulmer" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  pre.src-C\+\+:before { content: 'C++'; }
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://gongzhitaao.org/orgcss/org.css"/>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Bachelor Thesis</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org2a0eeee">1. The Cahn-Hilliard equation</a></li>
<li><a href="#orgdb10c2c">2. Baseline multi-grid solver</a></li>
<li><a href="#org3921479">3. Numerical evaluation</a></li>
<li><a href="#orgb532ab5">4. Relaxed problem</a></li>
<li><a href="#org6b0833b">5. AI</a></li>
<li><a href="#org11533f2">6. References</a></li>
</ul>
</div>
</div>
<p>
This thesis follows reproducible research philosophy, in that we provide all relevant code in the same file as the writing itself. We then use this file to generate exports to html and PDF, as well as extract the code to be used independently. Further details on execution and reading of the original source provided in org-mode format,
</p>
<div id="outline-container-org2a0eeee" class="outline-2">
<h2 id="org2a0eeee"><span class="section-number-2">1.</span> The Cahn-Hilliard equation</h2>
<div class="outline-text-2" id="text-1">
<p>
The Cahn-Hilliard(CH) equation is a partial differential equation (PDE) solving the state of a two-phase fluid(<a href="#citeproc_bib_item_2">Wu 2022</a>). The form of the CH equation used in this thesis is
</p>
\begin{equation}
\label{orgaf3610b}
\begin{aligned}
\partial_{t}\phi(x,t) &=  \nabla \cdot(M(\phi)\nabla\mu) \\
\mu &= - \varepsilon^2 \Delta\phi  + W'(\phi)
\end{aligned}
\end{equation}
<p>
where, \( \phi\) is a phase-field variable representing the different states of the fluids through an interval \(I=[-1,1] \)
</p>
\begin{align*}
\phi &=
\begin{cases}
1 &\,, \phi = \text{phase 1} \\
-1 &\,, \phi =\text{ phase 2}
\end{cases}
\end{align*}

<p>
\(\varepsilon\) is a positive constant correlated with boundary thickness and \(\mu\) is the chemical potential(<a href="#citeproc_bib_item_2">Wu 2022</a>).
</p>

<p>
In this thesis we assume \(M(\phi) \equiv 1 \), simplifying the CH equation used in (<a href="#citeproc_bib_item_2">Wu 2022</a>) (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
</p>

<p>
The advantages of the CH approach, as compared to traditional boundary coupling, are for example: &ldquo;explicit tracking of the interface&rdquo; (<a href="#citeproc_bib_item_2">Wu 2022</a>), as well as &ldquo;evolution of complex geometries and topological changes [&#x2026;] in a natural way&rdquo; (<a href="#citeproc_bib_item_2">Wu 2022</a>).
In practice it enables linear interpolation between different formulas on different phases.
</p>
</div>
<div id="outline-container-org07d8799" class="outline-3">
<h3 id="org07d8799"><span class="section-number-3">1.1.</span> Derivation from paper</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orgcb35fff" class="outline-4">
<h4 id="orgcb35fff"><span class="section-number-4">1.1.1.</span> The free energy</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
The authors in (<a href="#citeproc_bib_item_2">Wu 2022</a>) define the CH equation using the <b>Ginzburg-Landau</b> free energy equation:
</p>
\begin{align}
\label{orga0fb2ce}
E^{\text{bulk}} &= \int_{\Omega} \frac{\varepsilon^2}{2} |\nabla \phi |^2 + W(\phi) \, dx
\end{align}
<p>
where \(W(\phi) \) denotes the Helmholtz free energy density of mixing (<a href="#citeproc_bib_item_2">Wu 2022</a>) that we approximate it in further calculations with \(W(\phi) = \frac{(1-\phi ^2)^2}{4}\) as in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>). Additionally \( \nabla\phi \) represents the change in phase-field.
</p>

<p>
The chemical potential, \( \mu \), then follows as the variational derivation of the free energy \eqref{orga0fb2ce}.
</p>
\begin{align*}
 \mu &= \frac{\delta E_{bulk}(\phi)}{\delta \phi} = -\varepsilon^2 \Delta \phi + W'(\phi)
\end{align*}
</div>
</div>
<div id="outline-container-org3d329b4" class="outline-4">
<h4 id="org3d329b4"><span class="section-number-4">1.1.2.</span> Derivation of the CH equation from mass balance</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
The paper (<a href="#citeproc_bib_item_2">Wu 2022</a>)  motivates us to derive the CH equation as follows:
</p>
\begin{equation}
\label{org8ff20b8}
    \partial_t \phi + \nabla \cdot J = 0
\end{equation}
<p>
where \( J \) is mass flux. The equation \eqref{org8ff20b8} then ensures continuity of mass
Using the no-flux boundary conditions:
</p>
\begin{align}
J \cdot n &= 0 & \partial\Omega &\times (0,T)\\
\partial_n\phi &= 0 & \partial\Omega &\times (0,T)
\end{align}
<p>
conservation of mass follows see(<a href="#citeproc_bib_item_2">Wu 2022</a>).
</p>
\begin{equation}
\label{org9b0f3ba}
\begin{aligned}
\frac{d}{dt}\int_{\Omega}\phi&=\int_{\Omega}\frac{\partial \phi}{\partial t} dV \\
&= - \int_{\Omega} \nabla \cdot J \ dV\\
&=  \int_{\partial\Omega}  J \cdot n  \ dA \\
&= 0
\end{aligned}
\end{equation}
<p>
Therefore mass is conserved over time, as shown in \eqref{org9b0f3ba}.
We define the mass flux, \( J \), as the gradient in chemical potential as follows
</p>
\begin{align}
J &= - \nabla \mu
\end{align}
<p>
This results in the CH equation as stated in \eqref{orgaf3610b}.
</p>
\begin{equation}
\label{org657255d}
\begin{aligned}
 - \nabla \mu &= 0 \\
\partial_n \phi &= 0
\end{aligned}
\end{equation}
<p>
i.e. no flow leaves and potential on the border doesn&rsquo;t change.
In order to show the CH equation&rsquo;s consistency with thermodynamics we take the time derivation of the free energy \eqref{orga0fb2ce} and we show that it decreases in time.
</p>
\begin{align*}
\frac{d}{dt}E^{bulk}(\phi(t)) &= \int_{\Omega} ( \varepsilon^2 \nabla \phi \cdot \nabla \partial_t \phi + W'(\phi) \partial_t \phi) \ d x \\
&=\int_{\Omega} (\varepsilon^2\nabla\phi + W'(\phi))\partial_t\phi \ dx\\
&=\int_{\Omega} \mu \partial_t \phi \ dx\\
&= \int_{\Omega} \mu \cdot \Delta\mu \ dx \\
&= -\int_{\Omega} \nabla\mu \cdot \nabla\mu \ dx + \int_{\partial\Omega} \mu \nabla\phi_t \cdot n \ dS \\
&\stackrel{\partial_n\phi = 0}{=} - \int_{ \Omega } |\nabla \mu|^2 \ d x, & \forall t \in [0,T)
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-orgdb10c2c" class="outline-2">
<h2 id="orgdb10c2c"><span class="section-number-2">2.</span> Baseline multi-grid solver</h2>
<div class="outline-text-2" id="text-2">
<p>
As baseline for numerical experiments we use a two-grid method based on the finite difference method defined in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
</p>
</div>
<div id="outline-container-orgd5e0c35" class="outline-3">
<h3 id="orgd5e0c35"><span class="section-number-3">2.1.</span> The discretization of the CH equation:</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Our discretization closely resembles the one taken by the authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
We discretize our domain \( \Omega \) to be a Cartesian-grid on a square with side-length \( N\cdot h \), where N is the number of grid-points in one direction, and \( h \) is the distance between grid-points. In all our initial data \( h \) is \( 3\cdot10^{-3}\) and \( N=32 \) for all, but in the stability tests in space.
We discretize the phase-field ,\( \phi \), and chemical potential ,\( \mu \), into grid-wise functions \(\phi_{ij}, \mu_{ij} \), where \( \phi_{ij} \) represents the evaluation of \( \phi \) at index \( ij \) , and at coordinates \( (i\cdot h -1 , j\cdot h - 1) \).
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) use the characteristic function \( G \) of the  domain \( \Omega \) to enforce no-flux boundary conditions.
</p>
\begin{align*}
G(x,y) &=
\begin{cases}
1, & (x,y) \in  \Omega \\
0, & (x,y) \not\in  \Omega
\end{cases}
\end{align*}
<p>
We implement the discretized function on our square domain as follows.
</p>
\begin{align*}
G_{ij} &=
\begin{cases}
1, & (i,j) \in  [2,N+1]^2 \\
0, & \text{else}
\end{cases}
\end{align*}
<p>
the domain we calculate on is therefore a square starting at \( (2,2) \) and ending at \( (N+1,N+1) \). We use this shifted square to accommodate for zero padding in our numerical implementation.
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">if</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">i</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">len</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">1</span> <span style="color: #fabd2f;">&amp;&amp;</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">&lt;=</span> <span style="color: #83a598;">width</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">1</span>
        <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">1.0</span>
    <span style="color: #fb4934;">else</span>
        <span style="color: #fb4934;">return</span> <span style="color: #d3869b;">0.0</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
We then define the partial derivatives \( D_x\phi_{ij}, \ D_y\phi_{ij} \) using centred differences:
</p>
\begin{align}
D_x\phi_{i+\frac{1}{2} j} &= \frac{\phi_{i+1j} - \phi_{ij}}{h} & D_y\phi_{ij+\frac{1}{2}} &= \frac{\phi_{ij+1} - \phi_{ij}}{h}
\end{align}
<p>
For \( \nabla_d \phi_{ij}, \nabla_d \cdot (G_{ij} \nabla_d \phi_{ij} )\) then follows:
</p>
\begin{align}
\label{org824d0dd}
\nabla_d \phi_{ij} &= (D_x \phi_{i+1j} , \ D_y \phi_{ij+1}) \\
 \nabla_d \cdot (G_{ij} \nabla_d \phi_{ij}) &= \frac{D_x \phi_{i+\frac{1}{2}j} -  D_x \phi_{i-\frac{1}{2}j} + D_y \phi_{ij+\frac{1}{2}} - D_y \phi_{ij-\frac{1}{2}}}{h},
\end{align}
<p>
where \( \nabla_d \phi_{ij} \) is a discrete gradient, and \( \nabla_d \cdot (G_{ij}\nabla_d\phi_{ij}) \) is a discrete version of the Laplace operator \( \Delta \) that takes no-flux boundary conditions into account. The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) show this to be the case by expanding \( \nabla_d \cdot (G_{ij} \nabla_d\phi_{ij}) \). In one dimension this expands to:
</p>
\begin{equation}
 \nabla_d \cdot (G_{i} \nabla_d\phi_{i}) = \frac{G_{i+\frac{1}{2}}\phi_{i+1} + G_{i-\frac{1}{2}}\phi_{i-1} - G_{i+\frac{1}{2}}\phi_i - G_{i-\frac{1}{2}}\phi_i}{h^2}
\end{equation}
<p>
notably, when one point lies outside the domain, then \( G_{i\frac{\pm1}{2}} = 0 \)  and therefore the corresponding discrete gradient \( \frac{\phi_{i\pm\frac{1}{2}} - \phi_i}{h}  \) is weighted by 0. This corresponds the discrete version of \( \partial_n\phi = 0 \).
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)
</p>

<p>
To simplify the notation for discretized derivatives we use the following abbreviations:
Math:
</p>
<ul class="org-ul">
<li>\(  \Sigma_G \phi_{ij} = G_{i+\frac{1}{2}j} \phi^{n + \frac{1}{2},m}_{i+1j} +  G_{i-\frac{1}{2}j} \phi^{n + \frac{1}{2},m}_{i-1j} + G_{ij+\frac{1}{2}}  \phi^{n + \frac{1}{2},m}_{ij+1} + G_{ij-\frac{1}{2}} \phi^{n + \frac{1}{2},m}_{ij-1}  \)</li>
<li>\(  \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \)</li>
</ul>
<p>
Code:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">(</span>
        <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">)</span>

<span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">function</span> <span style="color: #83a598;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #ebdbb2; background-color: #282828;">(</span>
        <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
We can then write the modified Laplacian \( \nabla_d (G \nabla_df_{ij}) \) as:
</p>
\begin{align*}
\nabla_{d} \cdot(G \nabla_df_{ij}) &= \frac{\Sigma_Gf_{ij} - \Sigma_G\cdot f_{ij}}{h^2}
\end{align*}
<p>
We use this modified Laplacian to deal with boundary conditions. Our abbreviations simplify separating implicit and explicit terms in the discretization.
</p>
</div>
</div>
<div id="outline-container-org6c1774a" class="outline-3">
<h3 id="org6c1774a"><span class="section-number-3">2.2.</span> Initial data</h3>
<div class="outline-text-3" id="text-2-2">
<p>
For testing we use initial phase-fields defined by the following equations:
</p>


\begin{equation}
\phi_{ij} =
\begin{cases}
1 &\,, \|(i,j) - (\frac{N}{2} , \frac{N}{2})\|_p < \frac{N}{3}\\
-1 &\,,else
\end{cases}
\end{equation}
<p>
where \( p \in \{2,\infty\} \)
</p>
\begin{equation}
\phi_{ij} =
\begin{cases}
1 &\,,  i < \frac{N}{2} \\
-1 &\,,else
\end{cases}
\end{equation}

\begin{equation}
\phi_{ij} =
\begin{cases}
1 &\,, \|(i,j) - (\frac{N}{2} , 2)\|_2 < \frac{N}{3} \\
-1 &\,,else
\end{cases}
\end{equation}

\begin{equation}
\phi_{ij} =
\begin{cases}
1 &\,, \| (i,j) - q_k \|_p < \frac{N}{3}  p \in \{1,2, \infty\} , q_k \in Q \\
-1 &\,,else
\end{cases}
\end{equation}
<p>
where \( q_k \) are random points inside my domain. Those we generate those using
</p>
<pre class="example">
2×8 Matrix{Int64}:
 24  20  10   1  32  25   4  30
  9   7  28  26   8   5  15   7
</pre>



<div class="org-src-container">
<pre class="src src-julia" id="orgf70cfc1"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Random</span>
<span style="color: #fb4934;">function</span> <span style="color: #83a598;">testdata</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">gridsize</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">blobs</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">radius</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">norm</span><span style="color: #ebdbb2; background-color: #282828;">;</span><span style="color: #83a598;">rng</span><span style="color: #fb4934;">=</span><span style="color: #83a598; font-weight: bold;">MersenneTwister</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">42</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
<span style="color: #83a598;">rngpoints</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">rand</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">rng</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">gridsize</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">blobs</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">M</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">gridsize</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">gridsize</span><span style="color: #ebdbb2; background-color: #282828;">)</span> .<span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">1</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">p</span> in <span style="color: #83a598; font-weight: bold;">axes</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">rngpoints</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">point</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">rngpoints</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">p</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fb4934;">if</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">LinearAlgebra</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">point</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>  <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">norm</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">&lt;</span> <span style="color: #83a598;">radius</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
            <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598;">M</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>



<div id="org7979bf1" class="figure">
<p><img src="images/testdata.svg" alt="testdata.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 1: </span>Examples of different phase-fields used as the initial condition in this work.</p>
</div>
</div>
</div>
<div id="outline-container-org6c0284c" class="outline-3">
<h3 id="org6c0284c"><span class="section-number-3">2.3.</span> Numerical ansatz</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) then define the discrete CH equation adapted for the domain as:
</p>
\begin{equation}
\label{orgd4d6b52}
\begin{aligned}
\frac{\phi_{ij}^{n+1} - \phi_{ij}^n}{\Delta t}  &=  \nabla _d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2}} )  \\
 \mu_{ij}^{n+\frac{1}{2}} &= 2\phi_{ij}^{n+1} - \varepsilon^2  \nabla_d \cdot  (G_{ij} \nabla _d \phi_{ij}^{n+1} ) + W'(\phi_{ij}^n) - 2\phi _{ij}^n
\end{aligned}
\end{equation}
<p>
and derive a numerical scheme from this implicit equation.
</p>
</div>
</div>
<div id="outline-container-org0197808" class="outline-3">
<h3 id="org0197808"><span class="section-number-3">2.4.</span> PDE as operator \( L \)</h3>
<div class="outline-text-3" id="text-2-4">
<p>
The authors in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) derive their method by seperating \eqref{orgd4d6b52} into implicit and linear terms, and explicit non-linear terms. Linear terms are collected in an Operator \( L \), and the explicit terms in \( (\zeta^n_{ij} , \psi^n_{ij})^T \).
We derive the iteration operator \( L(\phi^{n+1}_{ij} , \mu^{n+\frac{1}{2}}_{ij}) = (\zeta^n_{ij} ,\psi^n_{ij}) \)as in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>).
</p>
\begin{align*}
L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi^{n+1}_{ij}}{\Delta t} - \nabla _d \cdot  ( G_{ij} \nabla _d \mu^{n+\frac{1}{2}}_{ij} ) \\
\varepsilon^2 \nabla _d \cdot  (G \nabla_d \phi_{ij}^{n+1}) - 2\phi_{ij}^{n+1} + \mu_{ij}^{n+\frac{1}{2}}
\end{pmatrix}
\end{align*}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">phi</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">mu</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">xi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span>
         <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
          <span style="color: #fabd2f;">-</span>
          <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">mu</span> <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #83a598;">psi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span>
          <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
           <span style="color: #fabd2f;">-</span>
           <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">phi</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">phi</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">mu</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
This operator follows from \eqref{orgd4d6b52} by separating implicit and explicit terms \( L \) and   \( (\zeta^n_{ij} , \psi^n_{ij})^T \), respectively.
</p>
\begin{align*}
\begin{pmatrix}
\zeta^n_{ij}
 \\
\psi^n_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi_{ij}^{n}}{\Delta t}\\
W'(\phi_{ij}^n) - 2\phi_{ij}^n
\end{pmatrix}
\end{align*}
<p>
Due to being explicit, we know everything needed to calculate \( (\zeta^n_{ij} , \psi^n_{ij})^T \) at the beginning of each time step. We compute those values  once and store them in the solver.
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #83a598; font-weight: bold;">xi_init</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">x</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span>
    <span style="color: #83a598; font-weight: bold;">psi_init</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598; font-weight: bold;">W_prime</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">x</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">xi_init</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">psi_init</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">return</span> <span style="color: #83a598;">nothing</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<p>
Furthermore, as it enables a Newton iteration, we derive its Jacobian with respect to the current grid point \( (\phi^{n+1}_{ij} , \mu^{n+\frac{1}{2}}_{ij})^{T} \):
</p>

\begin{align*}
DL\begin{pmatrix}
\phi_{ij} \\
\mu_{ij}
\end{pmatrix} &= \begin{pmatrix}
\frac{1}{\Delta t} & \frac{1}{h^2}\Sigma_{Gij}  \\
-\frac{\varepsilon^2}{h^2}\Sigma_{Gij} - 2 & 1
\end{pmatrix}
\end{align*}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">*</span><span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">;</span>
             <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
<div id="outline-container-orgd95f70d" class="outline-4">
<h4 id="orgd95f70d"><span class="section-number-4">2.4.1.</span> one dimensional operator</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
to gain a better understanding for the method, we derive the one dinensional for of \( L \) in matrix form
</p>

\begin{align*}
L
\begin{pmatrix}
\phi^{n+1}_{i} \\
\mu^{n+\frac{1}{2}}_{i}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi^{n+1}_{i}}{\Delta t} - \nabla _d \cdot  ( G_{i} \nabla _d \mu^{n+\frac{1}{2}}_{i} ) \\
\varepsilon^2 \nabla _d \cdot  (G \nabla_d \phi_{i}^{n+1}) - 2\phi_{i}^{n+1} + \mu_{i}^{n+\frac{1}{2}}
\end{pmatrix}\\
&=\begin{pmatrix}
\frac{\phi^{n+1}_{i}}{\Delta t} -  \frac{G_{i+\frac{1}{2}}\mu_{i+1}^{n+\frac{1}{2}} + G_{i-\frac{1}{2}}\mu_{i-1}^{n+\frac{1}{2}} - G_{i+\frac{1}{2}}\mu^{n+\frac{1}{2}}_i - G_{i-\frac{1}{2}}\mu^{n+\frac{1}{2}}_i}{h^2}\\
\varepsilon^2 \nabla _d \cdot  (G \nabla_d \phi_{i}^{n+1}) - 2\phi_{i}^{n+1} + \mu_{i}^{n+\frac{1}{2}}
\end{pmatrix}\\
\end{align*}
</div>
</div>
</div>
<div id="outline-container-orgec1ee1b" class="outline-3">
<h3 id="orgec1ee1b"><span class="section-number-3">2.5.</span> SMOOTH operator</h3>
<div class="outline-text-3" id="text-2-5">
<p>
The authors (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)derived Gauss-Seidel Smoothing from:
</p>
\begin{align}
\label{orgfe19c7f}
L
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
&=
\begin{pmatrix}
\zeta^n_{ij} \\
\psi^n_{ij}
\end{pmatrix}
\end{align}
<p>
SMOOTH consists of point-wise Gauss-Seidel relaxation, by solving \eqref{orgfe19c7f} for all \( i,j \) with the initial guess for \( \zeta^n_{ij} , \psi^n_{ij} \). Since \( L \) is linear we can write \eqref{orgfe19c7f} as
</p>
 \begin{equation}
\begin{aligned}
\begin{pmatrix}
  \zeta_{ij}^n\\
\psi_{ij}^n
\end{pmatrix}
&=
DL\begin{pmatrix}
\phi_{ij}^{n+1} \\
\mu_{ij}^{n+\frac{1}{2}}
\end{pmatrix}
\cdot
\begin{pmatrix}
\phi^{n+1}_{ij} \\
\mu^{n+\frac{1}{2}}_{ij}
\end{pmatrix}
+
\begin{pmatrix}
 - \frac{1}{h^2} \Sigma_{Gij}\mu_{ij}^{n+\frac{1}{2}} \\
+ \frac{\varepsilon^2}{h^2} \Sigma_{Gij}\phi_{ij}^{n+1} \\
\end{pmatrix}
\end{aligned}
\end{equation}
<p>
and solve for \( \phi_{ij}^{n+1} , \mu^{n+\frac{1}{2}}_{ij} \).
</p>
<div class="org-src-container">
<pre class="src src-julia" id="org318e631"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">iterations</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">adaptive</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">gradient_boundary_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">iterations</span>
        <span style="color: #83a598;">old_phase</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">copy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
            <span style="color: #83a598;">bordernumber</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

            <span style="color: #83a598;">coefmatrix</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>

            <span style="color: #83a598;">b</span> <span style="color: #fb4934;">=</span>
                <span style="color: #ebdbb2; background-color: #282828;">[</span>
                    <span style="color: #ebdbb2; background-color: #282828;">(</span>
                        <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
                        <span style="color: #fb4934;">+</span>
                        <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
                            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span>
                        <span style="color: #ebdbb2; background-color: #282828;">)</span>
                        <span style="color: #fb4934;">/</span>
                        <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
                    <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
                    <span style="color: #ebdbb2; background-color: #282828;">(</span>
                        <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
                        <span style="color: #fabd2f;">-</span>
                        <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                        <span style="color: #fb4934;">*</span>
                        <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
                            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span>
                        <span style="color: #ebdbb2; background-color: #282828;">)</span>
                    <span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #ebdbb2; background-color: #282828;">]</span>

            <span style="color: #83a598;">res</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">coefmatrix</span> <span style="color: #fabd2f;">\</span> <span style="color: #83a598;">b</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">]</span>

        <span style="color: #fb4934;">end</span>

        <span style="color: #928374;">#if adaptive &amp;&amp; LinearAlgebra.norm(old_phase - solver.phase) &lt; 1e-8</span>
        <span style="color: #928374;">#    #println("SMOOTH terminated at $(k) succesfully")</span>
        <span style="color: #928374;">#    break</span>
        <span style="color: #928374;">#end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>


<div id="org939bded" class="figure">
<p><img src="images/smooth.svg" alt="smooth.svg" class="org-svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-org079313f" class="outline-3">
<h3 id="org079313f"><span class="section-number-3">2.6.</span> V-cycle approach</h3>
<div class="outline-text-3" id="text-2-6">
<p>
The numerical method proposed in (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) consists of a V-cycle multi-grid method derived from previously stated operators. Specificly we use a two-grid implementation consisting of
</p>
<ol class="org-ol">
<li>a Gauss-Seidel relaxation for smoothing <a href="#org6e28d67">4.3</a>.</li>
<li>restriction and prolongation methods between grids \(  h \leftrightarrow H  \).</li>
<li>a Newton iteration to solve \( L(x,y)_H = L(\bar{x} , \bar{y}) + (d_h , r_h) \).</li>
</ol>

<p>
The V-cycle of a two-grid method using pre and post smoothing is then stated by:
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Array</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">}</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">solver</span>
    <span style="color: #83a598;">solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #928374;">#pre SMOOTHing:</span>
    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">40</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">true</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">d</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598;">r</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #928374;"># calculate error between L and expected values</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">d</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #fb4934;">end</span>

    <span style="color: #83a598; font-weight: bold;">restrict_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598;">solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #83a598;">solution</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">deepcopy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">d_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">restrict</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">d</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">r_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">restrict</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">r</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>


    <span style="color: #83a598;">u_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598;">v_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #928374;">#Newton Iteration for solving smallgrid</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">300</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>

            <span style="color: #83a598;">diffrence</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span> .<span style="color: #fabd2f;">-</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">d_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">r_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]]</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
            <span style="color: #928374;">#diffrence = collect(L(solution, I.I...)) .- collect(L(solver, I.I...))</span>
            <span style="color: #928374;">#diffrence = [d_large[I] , r_large[I]]</span>

            <span style="color: #83a598;">local</span> <span style="color: #83a598;">ret</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">\</span> <span style="color: #83a598;">diffrence</span>

            <span style="color: #83a598;">u_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">ret</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">v_large</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">ret</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #fb4934;">end</span>
        <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-=</span> <span style="color: #83a598;">u_large</span>
        <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">-=</span> <span style="color: #83a598;">v_large</span>
    <span style="color: #fb4934;">end</span>
    <span style="color: #83a598;">u_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span>
    <span style="color: #83a598;">v_large</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span>

    <span style="color: #83a598;">solver</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">level</span><span style="color: #ebdbb2; background-color: #282828;">]</span>

    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> .<span style="color: #fabd2f;">+=</span> <span style="color: #83a598; font-weight: bold;">prolong</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">u_large</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> .<span style="color: #fabd2f;">+=</span> <span style="color: #83a598; font-weight: bold;">prolong</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">v_large</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">80</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">true</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
So let&rsquo;s take a closer look at the internals, namely the phase field after pre-SMOOTHing \( \bar{\phi} \), the phase residuals of \( \left[ L(\bar{\phi_{ij}}, \bar{\mu_{ij}}) - (\zeta_{ij} , \psi_{ij}) \right]_{ij \in \Omega} \) and the result of the Newton iteration on coarsest level.
</p>

<div id="orgca9fd81" class="figure">
<p><img src="images/v_cycle.svg" alt="v_cycle.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 2: </span>internal state during one V-cyclce</p>
</div>

<p>
After a few iterations, V-cycle exhibits the following behavior:
</p>

<div class="org-src-container">
<pre class="src src-julia-vterm" id="org2136383"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">init</span><span style="color: #fabd2f;">&gt;&gt;</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">DataFrames</span>
<span style="color: #83a598;">var</span><span style="color: #b8bb26;">"W_prime#61"</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #fabd2f;">-</span><span style="color: #83a598;">x</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">x</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">results</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">jldopen</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"experiments/iteration.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #b8bb26;">"result"</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">anim</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">animate</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">res</span> in <span style="color: #83a598; font-weight: bold;">eachrow</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">xlims</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">ylim</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">aspectratio</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">equal</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">gif</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">anim</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/iteration.gif"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">fps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>


<div id="org5cffed6" class="figure">
<p><img src="images/iteration.gif" alt="iteration.gif" />
</p>
<p><span class="figure-number">Figure 3: </span>a fex timesteps of the solver for different initial contitions as shown in <a href="#org6c1774a">2.2</a></p>
</div>
</div>
</div>
</div>
<div id="outline-container-org3921479" class="outline-2">
<h2 id="org3921479"><span class="section-number-2">3.</span> Numerical evaluation</h2>
<div class="outline-text-2" id="text-3">
<p>
The analytical CH equation conserves mass \eqref{org8ff20b8} and the free energy ,\( E_{bulk} \), \eqref{orga0fb2ce}  decreases in time, i.e. consistence with the second law of thermodynamics. Therefore, we use discrete variants of those concepts as necessary conditions for a &ldquo;good&rdquo; solution. Furthermore, since \( E_{bulk} \) is closely correlated with chemical potential, \( \mu \), we evaluate this difference as quality of convergence.
</p>
</div>
<div id="outline-container-org6b1ca52" class="outline-3">
<h3 id="org6b1ca52"><span class="section-number-3">3.1.</span> Experiments</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org72372fd" class="outline-4">
<h4 id="org72372fd"><span class="section-number-4">3.1.1.</span> iteration</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">
<pre class="src src-julia-vterm" id="org153ed61"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">init</span><span style="color: #fabd2f;">&gt;&gt;</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">DataFrames</span>
<span style="color: #83a598;">var</span><span style="color: #b8bb26;">"W_prime#61"</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #fabd2f;">-</span><span style="color: #83a598;">x</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">x</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">results</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">jldopen</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"experiments/iteration.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #b8bb26;">"result"</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">n</span>  <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">pbar</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">ProgressBar</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">total</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">n</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">energy</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">massbalance</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

<span style="color: #83a598;">anim</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">animate</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">res</span> in <span style="color: #83a598; font-weight: bold;">eachrow</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">push!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">energy</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598; font-weight: bold;">bulk_energy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
    <span style="color: #83a598; font-weight: bold;">push!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">massbalance</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598; font-weight: bold;">massbal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

    <span style="color: #83a598;">p0</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">clim</span> <span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">legend</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">true</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">lims</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">))</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">aspect_ratio</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">equal</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span>  <span style="color: #fb4934;">=</span> <span style="color: #b8bb26;">"phasefield"</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>
   <span style="color: #83a598;">p1</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">legend</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">true</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">lims</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">aspect_ratio</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">equal</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span>  <span style="color: #fb4934;">=</span> <span style="color: #b8bb26;">"potential"</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>

    <span style="color: #83a598;">current_range</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">experiment</span> <span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">*</span><span style="color: #d3869b;">64</span> <span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span>

    <span style="color: #83a598;">p3</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">plot</span><span style="color: #ebdbb2; background-color: #282828;">(</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">iteration</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">massbalance</span> .<span style="color: #fabd2f;">-</span><span style="color: #83a598;">massbalance</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">current_range</span><span style="color: #ebdbb2; background-color: #282828;">])[</span><span style="color: #83a598;">current_range</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">current_range</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">iteration</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">xlim</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">64</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #ebdbb2; background-color: #282828;">,</span>  <span style="color: #83a598;">title</span> <span style="color: #fb4934;">=</span> <span style="color: #b8bb26;">"Mass change"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">p2</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">plot</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">iteration</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">energy</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">current_range</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">current_range</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">iteration</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">xlim</span><span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">64</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #ebdbb2; background-color: #282828;">,</span>  <span style="color: #83a598;">title</span> <span style="color: #fb4934;">=</span> <span style="color: #b8bb26;">"Bulk energy"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">plot</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">p0</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">p1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">p2</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">p3</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">gif</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">anim</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/behaviour.gif"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">fps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>


<div id="org375652f" class="figure">
<p><img src="images/behaviour.gif" alt="behaviour.gif" />
</p>
<p><span class="figure-number">Figure 4: </span>behaviour of bulk energy \( E_{bulk} \) and amount of fluid changing phase, for different initial conditions</p>
</div>
</div>
</div>
<div id="outline-container-org50be25a" class="outline-4">
<h4 id="org50be25a"><span class="section-number-4">3.1.2.</span> subiteration</h4>
</div>
<div id="outline-container-orge5c2d94" class="outline-4">
<h4 id="orge5c2d94"><span class="section-number-4">3.1.3.</span> time</h4>
</div>
<div id="outline-container-orga5bed77" class="outline-4">
<h4 id="orga5bed77"><span class="section-number-4">3.1.4.</span> space</h4>
</div>
</div>
<div id="outline-container-orgd0884e3" class="outline-3">
<h3 id="orgd0884e3"><span class="section-number-3">3.2.</span> Energy evaluations</h3>
<div class="outline-text-3" id="text-3-2">
<p>
As discrete energy measure we use:
</p>
\begin{align*}
E^{\text{bulk}} &= \sum_{i,j \in \Omega} \frac{\varepsilon^2}{2} |G\nabla \phi_{ij} |^2 + W\left(\phi_{ij}\right) \, dx \\
&= \sum_{i,j \in \Omega} \frac{\varepsilon^2}{2} G_{i+\frac{1}{2}j}(D_x\phi_{i+\frac{1}{2}j}) ^2 + G_{ij+\frac{1}{2}}(D_y\phi_{ij+\frac{1}{2}})^2  + W\left(\phi_{ij}\right) \, dx \\
\end{align*}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">bulk_energy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #83a598;">energy</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">0</span>
    <span style="color: #83a598;">dx</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndex</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">dy</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndex</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">W</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #d3869b;">4</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">x</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
        <span style="color: #83a598;">energy</span> <span style="color: #fabd2f;">+=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">/</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">dx</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">dy</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">W</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
        <span style="color: #fb4934;">end</span>
   <span style="color: #fb4934;">return</span> <span style="color: #83a598;">energy</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>



<div id="orga21f41f" class="figure">
<p><img src="images/energy_balance.svg" alt="energy_balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 5: </span>behaviour of energy \( E_{bulk} \) over time for one initial condition \( \phi_0 \)</p>
</div>
</div>
</div>
<div id="outline-container-org98d2d46" class="outline-3">
<h3 id="org98d2d46"><span class="section-number-3">3.3.</span> Mass balance</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Instead of a physical mass we use the average of \(\phi\) over the domain \(\Omega\) written as:
</p>
\begin{equation}
\begin{aligned}
\frac{1}{|\Omega|}\int_{\Omega}\phi \ dx
\end{aligned}
\end{equation}
<p>
We calculate this balance as:
</p>
\begin{align*}
b &= \frac{\sum_{i,j \in \Omega} \phi_{ij}}{|\{(i,j) \in \Omega\}|}
\end{align*}
<p>
such that \( b = 1 \) means there is only phase 1, \( \phi \equiv 1 \), and \( b = -1 \) means there is only phase 2, \( \phi \equiv -1 \).
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">massbal</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">num_cells</span><span style="color: #fb4934;">=</span> <span style="color: #fb4934;">*</span><span style="color: #ebdbb2; background-color: #282828;">((</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">)</span>.<span style="color: #fabd2f;">-</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fb4934;">...</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #83a598; font-weight: bold;">sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">arr</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">num_cells</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>


<div id="org68ced44" class="figure">
<p><img src="images/mass_balance.svg" alt="mass_balance.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 6: </span>behaviour of phase change over time for one initial condition \( \phi_0 \)</p>
</div>
</div>
</div>
<div id="outline-container-org95e81c4" class="outline-3">
<h3 id="org95e81c4"><span class="section-number-3">3.4.</span> <span class="todo TODO">TODO</span> stability</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-orgb2e89c5" class="outline-4">
<h4 id="orgb2e89c5"><span class="section-number-4">3.4.1.</span> stability of a sub iteration v-cycle</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
in order to evaluate convergence we observe the change in phase
</p>
\begin{equation}
\| \phi^n - \phi^{n+1,m} \|_{Fr}
\end{equation}
<p>
where \( \|\cdot\|_{Fr} \) represents a Frobenious norm over the tensors representing \( \phi.^n,\phi^{n+1,m} \).
In addition we track the change of bulk energy:
</p>

\begin{equation}
\frac{d}{dt} E^{bulk} = - \int_{\Omega} |\nabla\mu|^2 \ dx
\end{equation}
<p>
discetized as follows:
</p>
\begin{equation}
\Delta E^{bulk} = - \sum_{ij \in \Omega} |\nabla_d\mu|^2
\end{equation}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">bulk_energy_potential</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">solver</span>
    <span style="color: #83a598;">energy</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">0</span>
    <span style="color: #83a598;">dx</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndex</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">dy</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndex</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">0</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">W</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #d3869b;">4</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">x</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
        <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
        <span style="color: #83a598;">energy</span> <span style="color: #fabd2f;">+=</span>  <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">dx</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598; font-weight: bold;">G</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">0.5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #fabd2f;">+</span><span style="color: #83a598;">dy</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
        <span style="color: #fb4934;">end</span>
   <span style="color: #fb4934;">return</span> <span style="color: #83a598;">energy</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>




<p>
we expect our solver to converge if we do more sub-iterations. To test this we compare the phase-field \( \phi_{ij}^{n+1,m-1} \) after \( m-1 \) sub-iterations with the phase-field \( \phi_{ij}^{n+1,m} \) after m sub-iterations. As sub-iterations increase , \( m\to\infty \) we expect the difference between both phase-fields to go to zero \( \|\phi^{n+1,m} - \phi^{n+1,m-1}\|_{Fr} \to 0 \)
</p>

<div id="orge4d1d65" class="figure">
<p><img src="images/convergence.svg" alt="convergence.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 7: </span>stability of the original CH solver for increasing sub-iterations</p>
</div>


<div id="org4eef8bc" class="figure">
<p><img src="images/subiteration.svg" alt="subiteration.svg" class="org-svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-orge57cfbf" class="outline-4">
<h4 id="orge57cfbf"><span class="section-number-4">3.4.2.</span> stability under refinment in time</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
we test the bahaviour unter refinement in time by succesivly subdeviding the original time interval \( [0,T] \) in finer parts
</p>



<div id="org7a496e7" class="figure">
<p><img src="images/time-stability.svg" alt="time-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 8: </span>behavior of the baseline solver while solving the time interval \( T = \left[ 0 , 10^{-2} \right] \) with increasing number of time-steps</p>
</div>
</div>
</div>
<div id="outline-container-org0ce64e6" class="outline-4">
<h4 id="org0ce64e6"><span class="section-number-4">3.4.3.</span> stability under refinement in space</h4>
<div class="outline-text-4" id="text-3-4-3">
<p>
We expect our methods to be stable in space. Therefore we expect
</p>

<div id="orgda02177" class="figure">
<p><img src="images/space-stability.svg" alt="space-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 9: </span>behavior of the baseline solver while solving on successively finer grids</p>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb532ab5" class="outline-2">
<h2 id="orgb532ab5"><span class="section-number-2">4.</span> Relaxed problem</h2>
<div class="outline-text-2" id="text-4">
<p>
In effort to decrease the order of complexity, from fourth order derivative to second order, we propose an elliptical relaxation approach, where the relaxation variable \( c \) is the solution of the following elliptical PDE:
</p>
\begin{align}
\label{org4ccdc94}
- \Delta c^\alpha  + \alpha c^a &= \alpha \phi ^\alpha,
\end{align}
<p>
where \( \alpha \) is a relaxation parameter. We expect to approach the original solution of the CH equation \eqref{orgaf3610b} as  \( \alpha \to \infty \).
This results in the following relaxation for the classical CH equation \eqref{orgaf3610b}:
</p>
\begin{equation}
\label{org76e69d5}
\begin{aligned}
\partial_t \phi^\alpha  &= \Delta \mu \\
\mu &= \varepsilon ^2 \alpha(c^\alpha - \phi^\alpha) + W'(\phi)
\end{aligned}
\end{equation}
<p>
It requires solving the elliptical PDE each time-step to calculate \(c\).
</p>

<p>
As ansatz for the numerical solver we propose:
</p>
\begin{equation}
\label{org7e9f7c7}
\begin{aligned}
\frac{\phi_{ij}^{n+1,\alpha} - \phi_{ij}^{n,\alpha}}{\Delta t}  &=  \nabla _d \cdot (G_{ij} \nabla_d \mu_{ij}^{n+\frac{1}{2},\alpha} )  \\
 \mu_{ij}^{n+\frac{1}{2},\alpha} &= 2\phi_{ij}^{n+1,\alpha} - \varepsilon^2 a(c_{ij}^{n+1,\alpha} - \phi_{ij}^{n+1,\alpha})  + W'(\phi_{ij}^{n,\alpha}) - 2\phi _{ij}^{n,\alpha}
\end{aligned}
\end{equation}
<p>
This approach is inspired by \eqref{orgd4d6b52} adapted to the relaxed CH equation \eqref{org7e9f7c7}.
We then adapt the multi-grid solver proposed in <a href="#orgdb10c2c">2</a> to the relaxed problem by replacing the differential operators by their discrete counterparts as defined in \eqref{org824d0dd},
and expand them .
</p>
</div>
<div id="outline-container-org4688773" class="outline-3">
<h3 id="org4688773"><span class="section-number-3">4.1.</span> Elliptical PDE:</h3>
<div class="outline-text-3" id="text-4-1">
<p>
In order to solve the relaxed CH equation we solve the following PDE in each  time step:
</p>
\begin{align*}
- \nabla \cdot  (G \nabla c^\alpha) + \alpha c^\alpha  = \alpha \phi ^\alpha
\end{align*}

<p>
Similarly to the first solver we solve this PDE  with a finite difference scheme using the same discretization as before.
</p>
</div>
<div id="outline-container-orgb9895c1" class="outline-4">
<h4 id="orgb9895c1"><span class="section-number-4">4.1.1.</span> Discretization</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
The discretization of the PDE expands the differential operators in the same way and proposes an equivalent scheme for solving the elliptical equation \eqref{org4ccdc94}.
</p>
\begin{align*}
- \nabla_d \cdot  (G_{ij} \nabla_d c_{ij}^\alpha) + \alpha  c_{ij}^\alpha &= \alpha \phi_{ij}^\alpha
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
- (\frac{1}{h}(G_{i+\frac{1}{2}j} \nabla c^\alpha_{i+\frac{1}{2}j} + G_{ij+\frac{1}{2}} \nabla c^\alpha_{ij+\frac{1}{2}}) &  \\
- (G_{i-\frac{1}{2}j} \nabla c^\alpha_{i-\frac{1}{2}j} + G_{ij-\frac{1}{2}} \nabla c^\alpha_{ij-\frac{1}{2}})) + \alpha  c_{ij}^\alpha   &= \alpha  \phi_{ij}^\alpha
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
- \frac{1}{h^2} ( G_{i+\frac{1}{2}j}(c_{i+1j}^\alpha - c_{ij}^\alpha) & \\
+G_{ij+\frac{1}{2}}(c_{ij+1}^\alpha - c_{ij}^\alpha) & \\
+G_{i-\frac{1}{2}j}(c_{i-1j}^\alpha - c_{ij}^\alpha)& \\
+G_{ij-\frac{1}{2}}(c_{ij-1}^\alpha - c_{ij}^\alpha)) + \alpha  c_{ij}^\alpha &=\alpha  \phi_{ij}^\alpha
\end{align*}


<p>
As before we abbreviate \(  \Sigma_G c^\alpha_{ij} = G_{i+\frac{1}{2}j} c^\alpha_{i+1j} +  G_{i-\frac{1}{2}j} c^\alpha_{i-1j} + G_{ij+\frac{1}{2}}  c^\alpha_{ij+1} + G_{ij-\frac{1}{2}} c^\alpha_{ij-1}  \) and \(  \Sigma_{Gij} = G_{i+\frac{1}{2}j} + G_{i-\frac{1}{2}j} + G_{ij+\frac{1}{2}} + G_{ij-\frac{1}{2}}  \). Then the discrete elliptical PDE can be stated as:
</p>
\begin{align}
\label{org90de68c}
-\frac{ \Sigma_G c^\alpha_{ij}}{h^2} + \frac{\Sigma_G}{h^2} c^\alpha_{ij} + \alpha c^\alpha_{ij} &= \alpha\phi^\alpha_{ij}
\end{align}

<p>
solving \eqref{org90de68c} for \(c_{ij}^\alpha \) then results in.
</p>
\begin{align*}
\left( \frac{\Sigma_{Gij}}{h^2} + \alpha \right)c_{ij}^{\alpha} = \alpha\phi^{\alpha}_{ij} + \frac{\Sigma_G c_{ij}^{\alpha}}{h^2}\\
c_{ij}^{\alpha} = \frac{\alpha\phi^{\alpha}_{ij} + \frac{\Sigma_G c_{ij}^{\alpha}}{h^2}}{\frac{\Sigma_{G}}{h^2} + \alpha}\\
c_{ij}^{\alpha} = \frac{\alpha h^2 \phi^{\alpha}_{ij}}{\Sigma_{Gij} + \alpha h^2} + \frac{\Sigma_G c_{ij}^{\alpha}}{\Sigma_{Gij} + \alpha h^{2}}
\end{align*}
<p>
and can be translated to code as follows
</p>
<div class="org-src-container">
<pre class="src src-julia" id="orgbf4c5ce"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">n</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span>  <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">n</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
            <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #fabd2f;">+</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #83a598;">bordernumber</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
                <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span>
                    <span style="color: #ebdbb2; background-color: #282828;">(</span>
                        <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">+</span>
                        <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
                    <span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">bordernumber</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

            <span style="color: #fb4934;">end</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org5df86c6" class="outline-3">
<h3 id="org5df86c6"><span class="section-number-3">4.2.</span> Relaxed PDE as operator L</h3>
<div class="outline-text-3" id="text-4-2">
<p>
We reformulate the discretization \eqref{org7e9f7c7} in terms of the relaxed operator \(L\) as follows:
</p>
\begin{align*}
L
\begin{pmatrix}
\phi ^{n+1,\alpha} \\
\mu^{n+\frac{1}{2},\alpha}
\end{pmatrix}
&=
\begin{pmatrix}
\frac{\phi^{n+1,m,\alpha}_{ij}}{\Delta t} - \nabla _d \cdot (G_{ji} \nabla _d \mu^{n + \frac{1}{2},m,\alpha}_{ji}) \\
\varepsilon ^2 \alpha (c^\alpha - \phi^{n+1,m,\alpha}_{ij}) - 2\phi ^{n+1,m,\alpha}_{ij} -\mu^{n + \frac{1}{2},m,\alpha}_{ji}
\end{pmatrix}
\end{align*}

<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">L</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">phi</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">mu</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">xi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span>
         <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
          <span style="color: #fabd2f;">-</span>
          <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">mu</span> <span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #83a598;">psi</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #fabd2f;">*</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">phi</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>
<p>
and its Jacobian:
</p>
\begin{align*}
DL\begin{pmatrix}
\phi \\
\mu
\end{pmatrix} &= \begin{pmatrix}
\frac{1}{\Delta t} & \frac{1}{h^2}\Sigma_{G}  \\
- \varepsilon^2 \alpha  - 2 & 1
\end{pmatrix}
\end{align*}
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">dL</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">i</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">return</span> <span style="color: #ebdbb2; background-color: #282828;">[</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">*</span><span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">))</span><span style="color: #ebdbb2; background-color: #282828;">;</span>
             <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span>  <span style="color: #fabd2f;">-</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
    <span style="color: #fb4934;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org6e28d67" class="outline-3">
<h3 id="org6e28d67"><span class="section-number-3">4.3.</span> SMOOTH operator</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Correspondingly the SMOOTH operation expands to:
</p>
\begin{align*}
SMOOTH( \phi^{n+1,m,\alpha}_{ij}, \mu^{n + \frac{1}{2},m,\alpha}_{ji}, L_h , \zeta^{n,\alpha} , \psi^{n,\alpha} )
\end{align*}

\begin{equation}
\label{orgeea659a}
\begin{aligned}
  -\frac{\Sigma_G}{h^2}\overline{\mu^{n + \frac{1}{2},m,\alpha}_{ji}} &= \frac{\phi ^{n+1,m,\alpha}_{ij}}{\Delta t} - \zeta^{n,\alpha}_{ij} - \frac{\Sigma_G\mu_{ij}}{h^2} \\
 \varepsilon ^2 \alpha \overline{\phi ^{n+1,m,\alpha}_{ij}} + 2 \phi ^{n+1,m,\alpha}_{ij} &= \varepsilon ^2 \alpha c^{n,\alpha}_{ij}  -\overline{\mu^{n + \frac{1}{2},m,\alpha}_{ji}}  - \psi_{ij}^{n,\alpha}
\end{aligned}
\end{equation}
<p>
We then solve directly for the smoothed variables, \( \overline{\mu_{ij}^{n+1,m,\alpha}} \) and \( \overline{\phi_{ij}^{n+1,m,\alpha}} \). This was not done in the original paper (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>) because the required system of linear equations in the paper (<a href="#citeproc_bib_item_1">Shin, Jeong, and Kim 2011</a>)  was solved numerically. We simplify the relaxed system in one-dimension, and solve explicitly:
</p>
\begin{align*}
\varepsilon^2 \alpha(\phi^\alpha) + 2\phi^\alpha &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G} (\frac{\phi^\alpha}{\Delta t} - \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij}) - \psi_{ij}
\end{align*}
<p>
in terms of a mass matrix
\( \implies \)
</p>
\begin{align*}
\varepsilon^2\alpha (\phi^\alpha_{ij}) + 2\phi^\alpha + \frac{h^2}{\Sigma_{Gij}}\frac{\phi^\alpha_{ij}}{\Delta t} &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G} (- \zeta^n_{ij} - \frac{1}{h^2} \Sigma_G \mu_{ij}) - \psi_{ij}
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
(\varepsilon^2 \alpha + 2 + \frac{h^2}{\Sigma_G \Delta t}) \phi^\alpha &= \varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G}(- \zeta^n_{ij} - \frac{\Sigma_G \mu_{ij}}{h^2} ) -\psi_{ij}
\end{align*}
<p>
\( \implies \)
</p>
\begin{align*}
 \phi^\alpha &= \left(\varepsilon^2 \alpha c^\alpha - \frac{h^2}{\Sigma_G}(- \zeta^n_{ij} - \frac{\Sigma_G \mu_{ij}}{h^2} ) -\psi_{ij}\right)\left(\varepsilon^2 \alpha + 2 + \frac{h^2}{\Sigma_G \Delta t}\right)^{-1}
\end{align*}
<div class="org-src-container">
<pre class="src src-julia" id="org9e8cade"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">SMOOTH!</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">iterations</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598;">adaptive</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">Union</span><span style="color: #ebdbb2; background-color: #282828;">{</span><span style="color: #83a598;">relaxed_multi_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">adapted_relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">}</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">k</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">iterations</span>
        <span style="color: #83a598;">old_phase</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">copy</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">end</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
            <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
            <span style="color: #83a598;">bordernumber</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>


            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">c</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">bordernumber</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span> <span style="color: #fabd2f;">-</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span>  <span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">psi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span> <span style="color: #fabd2f;">/</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">epsilon</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span>  <span style="color: #fabd2f;">+</span> <span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span> <span style="color: #fabd2f;">/</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">bordernumber</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

            <span style="color: #928374;">#since the solver still needs the potetential we calculate it as well</span>
            <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">dt</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">xi</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">potential</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">G</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span><span style="color: #fabd2f;">/</span><span style="color: #83a598;">bordernumber</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fb4934;">end</span>

        <span style="color: #fb4934;">if</span> <span style="color: #83a598;">adaptive</span> <span style="color: #fabd2f;">&amp;&amp;</span> <span style="color: #83a598;">LinearAlgebra</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">old_phase</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">&lt;</span> <span style="color: #d3869b;">1e-10</span>
            <span style="color: #928374;">#println("SMOOTH terminated at $(k) succesfully")</span>
            break
        <span style="color: #fb4934;">end</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>


<div id="org4bff71d" class="figure">
<p><img src="images/smooth_relaxed.svg" alt="smooth_relaxed.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 10: </span>effect of the relaxed SMOOTH operator, and additional solving of the elliptical problem, for different values of alpha</p>
</div>
</div>
</div>
<div id="outline-container-org0d49b74" class="outline-3">
<h3 id="org0d49b74"><span class="section-number-3">4.4.</span> The relaxed V-cycle approach</h3>
<div class="outline-text-3" id="text-4-4">
<p>
As the difference between both methods is abstracted away in the operators, the relaxed V-cycle is identical to the original counterpart. Therefore we reuse the original V-cycle in the <a href="#org079313f">2.6</a>. The only additional step is solving the elliptical equation as following:
</p>
<div class="org-src-container">
<pre class="src src-julia-vterm"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">setup</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">relaxed</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">grid</span><span style="color: #fabd2f;">&gt;&gt;</span>

<span style="color: #83a598;">pbar</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">ProgressBar</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">total</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

<span style="color: #83a598;">anim</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">animate</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">t</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">100</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">testgrd</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">10</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">testgrd</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">update</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">pbar</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">testgrd</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">clim</span> <span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">gif</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">anim</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/iteration_relaxed2.gif"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">fps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcbd6590" class="outline-3">
<h3 id="orgcbd6590"><span class="section-number-3">4.5.</span> Test</h3>
</div>
<div id="outline-container-orgdbbeccb" class="outline-3">
<h3 id="orgdbbeccb"><span class="section-number-3">4.6.</span> rate of stability</h3>
<div class="outline-text-3" id="text-4-6">
</div>
<div id="outline-container-org6268cb6" class="outline-4">
<h4 id="org6268cb6"><span class="section-number-4">4.6.1.</span> massbal</h4>
<div class="outline-text-4" id="text-4-6-1">

<div id="orgee98725" class="figure">
<p><img src="images/relaxed-mass-balance.svg" alt="relaxed-mass-balance.svg" class="org-svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-orga8f2fbf" class="outline-4">
<h4 id="orga8f2fbf"><span class="section-number-4">4.6.2.</span> convergence of a sub iteration v-cycle</h4>
<div class="outline-text-4" id="text-4-6-2">

<div id="org7e53260" class="figure">
<p><img src="images/relaxed-convergence.svg" alt="relaxed-convergence.svg" class="org-svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-org7f80265" class="outline-4">
<h4 id="org7f80265"><span class="section-number-4">4.6.3.</span> convergence unter refinment in time</h4>
<div class="outline-text-4" id="text-4-6-3">
<p>
we test the bahaviour unter refinement in time by succesivly subdeviding the original time interval \( [0,T] \) in finer parts
</p>

<div id="org4e98174" class="figure">
<p><img src="images/relaxed-time-stability.svg" alt="relaxed-time-stability.svg" class="org-svg" />
</p>
<p><span class="figure-number">Figure 11: </span>behavior of the baseline solver while solving the time interval \( T = \left[ 0 , 10^{-2} \right] \) with increasing number of timesteps</p>
</div>
</div>
</div>
<div id="outline-container-org9d38a7a" class="outline-4">
<h4 id="org9d38a7a"><span class="section-number-4">4.6.4.</span> convergence under refinement in space</h4>
<div class="outline-text-4" id="text-4-6-4">
<p>
we test convergence in space by succesivly subdividing our grid into finer meshes
</p>



<div id="org3629146" class="figure">
<p><img src="images/relaxed-space-stability.svg" alt="relaxed-space-stability.svg" class="org-svg" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc643055" class="outline-3">
<h3 id="orgc643055"><span class="section-number-3">4.7.</span> Comparison</h3>
<div class="outline-text-3" id="text-4-7">
<div class="org-src-container">
<pre class="src src-julia-vterm" id="orgd1d8672"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">setup</span><span style="color: #fabd2f;">-</span><span style="color: #83a598;">comparison</span><span style="color: #fabd2f;">&gt;&gt;</span>
<span style="color: #83a598;">n</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">100</span>
<span style="color: #83a598;">m</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">100</span>
<span style="color: #83a598;">pbar</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">ProgressBar</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">total</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">n</span><span style="color: #fabd2f;">*</span><span style="color: #83a598;">m</span><span style="color: #ebdbb2; background-color: #282828;">)</span>

<span style="color: #83a598;">anim</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">animate</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">i</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">n</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid1</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid2</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid3</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid1</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid2</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid3</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #83a598;">m</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_grid</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid1</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid2</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid3</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #83a598; font-weight: bold;">update</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">pbar</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
        <span style="color: #fb4934;">end</span>
    <span style="color: #83a598;">p0</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">clim</span> <span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"Original"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">p1</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid1</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">clim</span> <span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"alpha=1e3"</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">p2</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid2</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">clim</span> <span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"alpha=1e4"</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">p3</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">heatmap</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_grid3</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">clim</span> <span style="color: #fb4934;">=</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #fabd2f;">-</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">framestyle</span><span style="color: #fb4934;">=</span>:<span style="color: #83a598;">none</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">title</span><span style="color: #fb4934;">=</span><span style="color: #b8bb26;">"alpha=1e5"</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">plot</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">p0</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">p1</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">p2</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">p3</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">gif</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">anim</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/comparison.gif"</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">fps</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">10</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>


<div id="org2cb9144" class="figure">
<p><img src="images/comparison.gif" alt="comparison.gif" />
</p>
<p><span class="figure-number">Figure 12: </span>relaxed solver with different ralaxation values \( \alpha \) compared to the original approach</p>
</div>

<p>
Furthermore we expect the approximation for \( \phi_{ij}^{n+1} \) to converge.
</p>
\begin{equation}
||\phi_{ij}^{n+1} - \phi_{ij}^{n+1,\alpha}|| \to 0
\end{equation}
<p>
In practice we observe the following behaviour:
</p>
<div class="org-src-container">
<pre class="src src-julia-vterm"><span style="color: #fabd2f;">&lt;&lt;</span><span style="color: #83a598;">init</span><span style="color: #fabd2f;">&gt;&gt;</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">JLD2</span>
<span style="color: #fb4934;">using</span> <span style="color: #83a598;">Distributed</span>
<span style="color: #83a598;">JULIA_NUM_THREADS</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">24</span>
<span style="color: #83a598;">M</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">jldopen</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"data/test-phasefield.jld2"</span><span style="color: #ebdbb2; background-color: #282828;">)[</span><span style="color: #b8bb26;">"M"</span><span style="color: #ebdbb2; background-color: #282828;">]</span>

<span style="color: #83a598;">original_grid</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testgrid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">alphas</span> <span style="color: #fb4934;">=</span> <span style="color: #d3869b;">0</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">1e3</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">2e5</span>

<span style="color: #fb4934;">function</span> <span style="color: #83a598;">alpha_error</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Number</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">Array</span> <span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">test_solver</span>  <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">testgrid</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">relaxed_multi_solver</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">M</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">2</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">&#945;</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">test_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
    <span style="color: #83a598; font-weight: bold;">elyps_solver!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">test_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1000</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">100</span>
        <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">test_solver</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">return</span> <span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">test_solver</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">solution</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">set_xi_and_psi!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">])</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">j</span> in <span style="color: #d3869b;">1</span><span style="color: #fb4934;">:</span><span style="color: #d3869b;">100</span>
    <span style="color: #83a598; font-weight: bold;">v_cycle!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">original_grid</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598; font-weight: bold;">print</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #b8bb26;">"finished original v_cycle"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">tasks</span> <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; background-color: #282828;">[]</span>
<span style="color: #fb4934;">for</span> <span style="color: #83a598;">alpha</span> in <span style="color: #83a598;">alphas</span>
    <span style="color: #83a598;">t</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">Threads</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">spawn</span> <span style="color: #83a598; font-weight: bold;">alpha_error</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">original_grid</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">]</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">phase</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598; font-weight: bold;">push!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">tasks</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">alpha</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">task</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">t</span><span style="color: #ebdbb2; background-color: #282828;">))</span>
<span style="color: #fb4934;">end</span>
<span style="color: #83a598;">results</span>  <span style="color: #fb4934;">=</span> <span style="color: #ebdbb2; font-weight: bold;">@</span><span style="color: #83a598; font-weight: bold;">show</span> <span style="color: #ebdbb2; background-color: #282828;">[(</span><span style="color: #83a598;">alpha</span><span style="color: #fb4934;">=</span><span style="color: #83a598;">t</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">alpha</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">error</span><span style="color: #fb4934;">=</span><span style="color: #83a598; font-weight: bold;">fetch</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">t</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">task</span><span style="color: #ebdbb2; background-color: #282828;">))</span> <span style="color: #fb4934;">for</span> <span style="color: #83a598;">t</span> in <span style="color: #83a598;">tasks</span><span style="color: #ebdbb2; background-color: #282828;">]</span>
<span style="color: #83a598;">p</span><span style="color: #fb4934;">=</span><span style="color: #83a598; font-weight: bold;">plot</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">results</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">savefig</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">p</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #b8bb26;">"images/alpha-error.svg"</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>

<p>
<img src="images/alpha-error.svg" alt="alpha-error.svg" class="org-svg" />
in all cases the difference to the original solver is apparent. Furthermore we observe a optimal value of \( \alpha \) at approximately \( 7.5 * 10^5 \) we explain this with our observations done for the Smoothing operator, where for small and large values of \( \alpha \) the relaxed approach ironically results in restricted behaviour. Empirical this is to be expected as. for large values of alpha the elliptical equation approaches \( \phi \)  and for small values the elliptical solver does not converge.
</p>
</div>
</div>
</div>
<div id="outline-container-org6b0833b" class="outline-2">
<h2 id="org6b0833b"><span class="section-number-2">5.</span> AI</h2>
<div class="outline-text-2" id="text-5">
<p>
We propose a data motivated alternative to the elliptical PDE in the  relaxed CH equation \eqref{org7e9f7c7}. We propose there to be a better solution then the discrete result of \eqref{org4ccdc94}. We define &ldquo;better&rdquo; as minimizing:
</p>
\begin{equation}
\label{orga7a4de4}
||\phi^{n+1} + \frac{1}{\alpha}\nabla\cdot(G\nabla\phi^{n+1}) - c ||_{Fr}
\end{equation}
<p>
in the Frobenious norm \(||\cdot||_{Fr}\) and implement our loss function accordingly
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #83a598; font-weight: bold;">lossfn</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">y_hat</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">y</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">y</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">y_hat</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
</pre>
</div>
<p>
We calculate the expected value \( \phi^{n+1} + \frac{1}{\alpha} \nabla \cdot (G\nabla\phi^{n+1}) \) before training and use it as \( \hat{y} \)
</p>
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">function</span> <span style="color: #83a598;">ggrad</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">AbstractArray</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">::</span><span style="color: #83a598;">T</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #83a598;">where</span> <span style="color: #83a598;">T</span> <span style="color: #fabd2f;">&lt;:</span> <span style="color: #83a598;">solver</span>
<span style="color: #83a598;">Indices</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">CartesianIndices</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">Ifirst</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">Ilast</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">first</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">Indices</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598; font-weight: bold;">last</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">Indices</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">padding</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">oneunit</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">Ifirst</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">res</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">zeros</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">size</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">))</span>

<span style="color: #fb4934;">for</span> <span style="color: #83a598;">I</span> in <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">Ifirst</span> <span style="color: #fabd2f;">+</span> <span style="color: #83a598;">padding</span><span style="color: #ebdbb2; background-color: #282828;">)</span><span style="color: #fb4934;">:</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">Ilast</span> <span style="color: #fabd2f;">-</span> <span style="color: #83a598;">padding</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
    <span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">I</span>
   <span style="color: #83a598;">res</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">]</span> <span style="color: #fabd2f;">+</span>  <span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">discrete_G_weigted_neigbour_sum</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
             <span style="color: #fabd2f;">-</span> <span style="color: #83a598; font-weight: bold;">neighbours_in_domain</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">i</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">j</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #83a598;">G</span><span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">len</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">width</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">*</span> <span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">[</span><span style="color: #83a598;">I</span><span style="color: #ebdbb2; background-color: #282828;">])</span><span style="color: #fabd2f;">/</span> <span style="color: #83a598;">solver</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">h</span><span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
    <span style="color: #fb4934;">end</span>
<span style="color: #fb4934;">return</span> <span style="color: #83a598;">res</span>
<span style="color: #fb4934;">end</span>
</pre>
</div>

<pre class="example">
Executing... 64f93dab
</pre>
</div>
<div id="outline-container-org372ec53" class="outline-3">
<h3 id="org372ec53"><span class="section-number-3">5.1.</span> proposal CNN</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Flux</span>

<span style="color: #83a598;">model</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">Chain</span><span style="color: #ebdbb2; background-color: #282828;">(</span>
    <span style="color: #83a598; font-weight: bold;">Conv</span><span style="color: #ebdbb2; background-color: #282828;">((</span><span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">1</span><span style="color: #fabd2f;">=&gt;</span><span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">stride</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">pad</span><span style="color: #fb4934;">=</span><span style="color: #83a598; font-weight: bold;">SamePad</span><span style="color: #ebdbb2; background-color: #282828;">())</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
    <span style="color: #83a598; font-weight: bold;">Conv</span><span style="color: #ebdbb2; background-color: #282828;">((</span><span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">,</span><span style="color: #d3869b;">5</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #d3869b;">5</span><span style="color: #fabd2f;">=&gt;</span><span style="color: #d3869b;">1</span><span style="color: #ebdbb2; background-color: #282828;">;</span> <span style="color: #83a598;">stride</span><span style="color: #fb4934;">=</span><span style="color: #d3869b;">1</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">pad</span><span style="color: #fb4934;">=</span><span style="color: #83a598; font-weight: bold;">SamePad</span><span style="color: #ebdbb2; background-color: #282828;">())</span><span style="color: #ebdbb2; background-color: #282828;">,</span>
<span style="color: #ebdbb2; background-color: #282828;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge24d1e9" class="outline-3">
<h3 id="orge24d1e9"><span class="section-number-3">5.2.</span> training</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-julia"><span style="color: #fb4934;">using</span> <span style="color: #83a598;">Flux</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598;">Optimize</span>
<span style="color: #83a598; font-weight: bold;">loss</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">model</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">x</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">y</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">model</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">y</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598;">opt_state</span> <span style="color: #fb4934;">=</span> <span style="color: #83a598;">Flux</span><span style="color: #ebdbb2; background-color: #282828;">.</span><span style="color: #83a598; font-weight: bold;">setup</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">Adam</span><span style="color: #ebdbb2; background-color: #282828;">()</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">model</span><span style="color: #ebdbb2; background-color: #282828;">)</span>
<span style="color: #83a598; font-weight: bold;">train!</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">model</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">train_set</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">opt_state</span><span style="color: #ebdbb2; background-color: #282828;">)</span> do <span style="color: #83a598;">m</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">x</span> <span style="color: #ebdbb2; background-color: #282828;">,</span> <span style="color: #83a598;">y</span>
   <span style="color: #fb4934;">return</span> <span style="color: #83a598; font-weight: bold;">norm</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598; font-weight: bold;">m</span><span style="color: #ebdbb2; background-color: #282828;">(</span><span style="color: #83a598;">x</span><span style="color: #ebdbb2; background-color: #282828;">)</span> .<span style="color: #fabd2f;">-</span> <span style="color: #83a598;">y</span><span style="color: #ebdbb2; background-color: #282828;">)</span> <span style="color: #fabd2f;">^</span><span style="color: #d3869b;">2</span>
end

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org11533f2" class="outline-2">
<h2 id="org11533f2"><span class="section-number-2">6.</span> References</h2>
<div class="outline-text-2" id="text-6">
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Shin, Jaemin, Darae Jeong, and Junseok Kim. 2011. “A Conservative Numerical Method for the Cahn–Hilliard Equation in Complex Domains.” <i>Journal of Computational Physics</i> 230 (19): 7441–55. <a href="https://doi.org/https://doi.org/10.1016/j.jcp.2011.06.009">https://doi.org/https://doi.org/10.1016/j.jcp.2011.06.009</a>.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>Wu, Hao. 2022. “A Review on the Cahnhilliard Equation: Classical Results and Recent Advances in Dynamic Boundary Conditions.” <i>Electronic Research Archive</i> 30 (8): 2788–2832. <a href="https://doi.org/10.3934/era.2022143">https://doi.org/10.3934/era.2022143</a>.</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jonathan Ulmer</p>
<p class="date">Created: 2024-05-15 Wed 11:52</p>
</div>
</body>
</html>
